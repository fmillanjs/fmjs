---
phase: 25-personality-effects
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/components/portfolio/dot-grid-spotlight.tsx
  - apps/web/app/globals.css
  - apps/web/app/(portfolio)/layout.tsx
autonomous: true
requirements:
  - FX-04

must_haves:
  truths:
    - "A subtle dot-grid pattern is visible in the background of all portfolio pages on hover-capable devices"
    - "A green spotlight circle follows the mouse cursor in real time with no visible lag — the spotlight illuminates the dot-grid beneath it"
    - "On touch devices or any device where any-hover: none applies, neither the dot-grid nor the spotlight are visible — no broken layout, no residual element"
    - "The spotlight overlay never blocks clicks on links, cards, or buttons — pointer-events: none is always active on the overlay"
    - "Under prefers-reduced-motion, the component returns null and no spotlight is rendered"
  artifacts:
    - path: "apps/web/components/portfolio/dot-grid-spotlight.tsx"
      provides: "'use client' DotGridSpotlight component with CSS custom property cursor tracking"
      exports: ["DotGridSpotlight"]
      contains: "mousemove"
    - path: "apps/web/app/globals.css"
      provides: ".dot-grid-spotlight CSS class scoped inside @media (any-hover: hover)"
      contains: "dot-grid-spotlight"
    - path: "apps/web/app/(portfolio)/layout.tsx"
      provides: "Modified portfolio layout with DotGridSpotlight rendered as background layer"
      contains: "DotGridSpotlight"
  key_links:
    - from: "apps/web/app/(portfolio)/layout.tsx"
      to: "apps/web/components/portfolio/dot-grid-spotlight.tsx"
      via: "import { DotGridSpotlight }"
      pattern: "DotGridSpotlight"
    - from: "apps/web/components/portfolio/dot-grid-spotlight.tsx"
      to: "apps/web/app/globals.css"
      via: ".dot-grid-spotlight CSS class + CSS custom properties --cursor-x, --cursor-y"
      pattern: "dot-grid-spotlight"
    - from: "JavaScript mousemove listener"
      to: "CSS --cursor-x / --cursor-y custom properties"
      via: "element.style.setProperty — zero React re-renders per frame"
      pattern: "setProperty"
---

<objective>
Implement FX-04: a dark dot-grid background with a green spotlight that follows the mouse cursor across all portfolio pages — built as a paired unit (CSS dot-grid + JS spotlight tracker).

Purpose: Completes the Matrix aesthetic with environmental depth — every page has a subtle living background that responds to the visitor's presence. FX-04 is a paired unit per the architecture decision in STATE.md.
Output: `DotGridSpotlight` component added to the portfolio layout, CSS in globals.css, zero new npm dependencies.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/app/(portfolio)/layout.tsx
@apps/web/app/globals.css
@.planning/phases/25-personality-effects/25-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DotGridSpotlight component + add CSS to globals.css</name>
  <files>
    apps/web/components/portfolio/dot-grid-spotlight.tsx
    apps/web/app/globals.css
  </files>
  <action>
**Step A — Create `apps/web/components/portfolio/dot-grid-spotlight.tsx`:**

Use the pattern from 25-RESEARCH.md Pattern 4. CSS custom properties (`--cursor-x`, `--cursor-y`) are updated via `element.style.setProperty` — this produces ZERO React re-renders per mousemove event.

```typescript
'use client'

import { useEffect, useRef } from 'react'
import { useReducedMotion } from 'motion/react'

export function DotGridSpotlight() {
  const containerRef = useRef<HTMLDivElement>(null)
  const prefersReducedMotion = useReducedMotion()

  useEffect(() => {
    // Belt-and-suspenders: CSS media query hides element on touch devices,
    // but also skip the event listener for those devices
    if (prefersReducedMotion) return
    const canHover = window.matchMedia('(any-hover: hover)').matches
    if (!canHover) return

    const el = containerRef.current
    if (!el) return

    function onMouseMove(e: MouseEvent) {
      el!.style.setProperty('--cursor-x', `${e.clientX}px`)
      el!.style.setProperty('--cursor-y', `${e.clientY}px`)
    }

    // passive: true — never blocks scroll performance
    document.addEventListener('mousemove', onMouseMove, { passive: true })
    return () => document.removeEventListener('mousemove', onMouseMove)
  }, [prefersReducedMotion])

  // Under reduced motion — render nothing at all
  if (prefersReducedMotion) return null

  return (
    <div
      ref={containerRef}
      aria-hidden="true"
      className="dot-grid-spotlight"
      style={
        {
          '--cursor-x': '-9999px',
          '--cursor-y': '-9999px',
        } as React.CSSProperties
      }
    />
  )
}
```

Initial `--cursor-x: -9999px` positions the spotlight far off-screen so no spotlight glow is visible before the first mouse move.

**Step B — Add `.dot-grid-spotlight` CSS to `apps/web/app/globals.css`:**

Append the following block AFTER the existing `/* UX-01: Matrix green border glow */` section and BEFORE the `/* THEME-04: Stop all animations */` section:

```css
/* FX-04: Dot grid background + green spotlight cursor */
/* Hidden entirely on touch / coarse-pointer / no-hover devices via @media guard */
/* On hover-capable devices: dot grid is always visible; spotlight follows mouse */
@media (any-hover: hover) {
  .dot-grid-spotlight {
    position: fixed;
    inset: 0;
    z-index: 0;           /* behind content layers (content uses z-10+) */
    pointer-events: none; /* NEVER block clicks — mandatory */
    /* Three-layer background:
       1. Green radial spotlight at cursor position
       2+3. Offset dot grid (two patterns create a denser grid by offset) */
    background-image:
      radial-gradient(
        circle 250px at var(--cursor-x, -9999px) var(--cursor-y, -9999px),
        var(--matrix-green-ghost),
        transparent 80%
      ),
      radial-gradient(circle, var(--matrix-green-dim) 1px, transparent 1px),
      radial-gradient(circle, var(--matrix-green-dim) 1px, transparent 1px);
    background-size:
      100% 100%,
      28px 28px,
      28px 28px;
    background-position:
      0 0,
      0 0,
      14px 14px;   /* offset second pattern by half-step for denser grid */
    opacity: 0.08; /* subtle — visible but not distracting; content remains primary focus */
  }
}
```

CSS constraints:
- Use `@media (any-hover: hover)` — NOT `@media (pointer: fine)` — to correctly handle hybrid devices (a laptop with touch + mouse should show the spotlight; a pure touch device should not)
- `z-index: 0` keeps the overlay behind all content; content elements in the portfolio already use `relative z-10` or higher from Phase 23-24 layers
- `opacity: 0.08` is intentionally subtle — the effect should be an ambient atmosphere, not a distracting light show
- Never use purple (#800080, violet, purple) in any color value
  </action>
  <verify>
```bash
# Confirm component file exists with key patterns
grep -n "setProperty\|mousemove\|any-hover\|pointer-events" /home/doctor/fernandomillan/apps/web/components/portfolio/dot-grid-spotlight.tsx

# Confirm CSS block added to globals.css
grep -n "dot-grid-spotlight\|any-hover" /home/doctor/fernandomillan/apps/web/app/globals.css

# Confirm pointer-events: none in CSS
grep -A 20 "dot-grid-spotlight" /home/doctor/fernandomillan/apps/web/app/globals.css | grep "pointer-events"
```
  </verify>
  <done>`dot-grid-spotlight.tsx` exists with passive mousemove listener, `setProperty` calls, and `useReducedMotion` guard. `globals.css` has `.dot-grid-spotlight` CSS scoped inside `@media (any-hover: hover)` with `pointer-events: none`.</done>
</task>

<task type="auto">
  <name>Task 2: Add DotGridSpotlight to portfolio layout</name>
  <files>apps/web/app/(portfolio)/layout.tsx</files>
  <action>
Modify `apps/web/app/(portfolio)/layout.tsx` to render `DotGridSpotlight` as the first child of the `.matrix-theme` wrapper div, placing it behind all other content.

**Import to add:**
```tsx
import { DotGridSpotlight } from '@/components/portfolio/dot-grid-spotlight'
```

**Modified layout JSX:**
```tsx
export default function PortfolioLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <div className="matrix-theme min-h-screen flex flex-col">
      <DotGridSpotlight />
      <PortfolioNav />
      <MotionProvider><main className="flex-1">{children}</main></MotionProvider>
      <PortfolioFooter />
      <CommandPalette />
    </div>
  );
}
```

`DotGridSpotlight` is a `'use client'` component. `PortfolioLayout` is a Server Component — this is a valid RSC boundary (Server Component importing and rendering a Client Component).

The `position: fixed` CSS on `.dot-grid-spotlight` means DOM order does not affect visual stacking — the CSS `z-index: 0` controls layering relative to the content elements above it.

Do NOT add `'use client'` to `layout.tsx`. Metadata export (`export const metadata`) requires the layout to remain a Server Component.
  </action>
  <verify>
```bash
# Confirm DotGridSpotlight is in layout.tsx
grep -n "DotGridSpotlight" /home/doctor/fernandomillan/apps/web/app/\(portfolio\)/layout.tsx

# Confirm layout.tsx is still a Server Component
head -5 /home/doctor/fernandomillan/apps/web/app/\(portfolio\)/layout.tsx | grep "use client" && echo "ERROR: layout must be Server Component" || echo "OK: no use client directive"

# TypeScript check
cd /home/doctor/fernandomillan && npx tsc --noEmit -p apps/web/tsconfig.json 2>&1 | grep -E "layout|dot-grid|ERROR" | head -10
```
  </verify>
  <done>`layout.tsx` imports and renders `DotGridSpotlight` as the first child inside `.matrix-theme`. `layout.tsx` remains a Server Component. TypeScript has no errors.</done>
</task>

</tasks>

<verification>
```bash
# 1. TypeScript — no errors across all modified files
cd /home/doctor/fernandomillan && npx tsc --noEmit -p apps/web/tsconfig.json 2>&1 | tail -5

# 2. Component patterns
grep -n "passive.*true\|setProperty\|any-hover" apps/web/components/portfolio/dot-grid-spotlight.tsx

# 3. CSS scoped to any-hover media query
grep -B2 "dot-grid-spotlight {" apps/web/app/globals.css

# 4. Layout integration
grep -n "DotGridSpotlight" apps/web/app/\(portfolio\)/layout.tsx

# 5. layout.tsx still Server Component
! grep -q "'use client'" apps/web/app/\(portfolio\)/layout.tsx && echo "Server Component: OK" || echo "ERROR"

# 6. No purple color values anywhere in new files
grep -i "purple\|#800080\|violet" apps/web/components/portfolio/dot-grid-spotlight.tsx apps/web/app/globals.css | grep "dot-grid" && echo "ERROR: purple found" || echo "OK: no purple"
```
</verification>

<success_criteria>
- `DotGridSpotlight` component exists with zero-re-render CSS custom property cursor tracking and passive mousemove listener
- `.dot-grid-spotlight` CSS class in `globals.css` scoped to `@media (any-hover: hover)` with `pointer-events: none` and `z-index: 0`
- `layout.tsx` renders `DotGridSpotlight` as first child of `.matrix-theme` wrapper, remains a Server Component
- No new npm dependencies installed
- TypeScript reports zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/25-personality-effects/25-03-SUMMARY.md` with:
- What was built (component + CSS + layout integration)
- How the zero-re-render cursor tracking works (CSS custom properties via setProperty)
- The `any-hover: hover` media query choice and why (vs `pointer: fine`)
- Any deviations from the plan
</output>
