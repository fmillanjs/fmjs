---
phase: 25-personality-effects
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/components/portfolio/evervault-card.tsx
  - apps/web/app/(portfolio)/page.tsx
autonomous: true
requirements:
  - FX-03

must_haves:
  truths:
    - "Hovering over a project card reveals a radial spotlight of random noise characters (matrix ASCII + katakana subset) that follows the cursor inside the card boundary"
    - "Moving the cursor away from the card removes the noise overlay immediately — the effect does not loop or linger"
    - "Clicks on project cards still navigate correctly — the noise overlay never intercepts pointer events"
    - "Under prefers-reduced-motion, project cards render their content with no noise overlay whatsoever"
  artifacts:
    - path: "apps/web/components/portfolio/evervault-card.tsx"
      provides: "'use client' Evervault-style noise decryption wrapper using motion/react"
      exports: ["EvervaultCard"]
      contains: "useMotionValue"
    - path: "apps/web/app/(portfolio)/page.tsx"
      provides: "Modified home page wrapping featured project card titles in EvervaultCard"
      contains: "EvervaultCard"
  key_links:
    - from: "apps/web/app/(portfolio)/page.tsx"
      to: "apps/web/components/portfolio/evervault-card.tsx"
      via: "import { EvervaultCard }"
      pattern: "EvervaultCard"
    - from: "apps/web/components/portfolio/evervault-card.tsx"
      to: "motion/react"
      via: "useMotionValue, useMotionTemplate, useReducedMotion"
      pattern: "useMotionValue|useMotionTemplate"
    - from: "noise overlay div"
      to: "null click interception"
      via: "pointer-events-none on the overlay, handlers on the container"
      pattern: "pointer-events-none"
---

<objective>
Implement FX-03: project cards reveal an Evervault-style noise decryption effect on hover — a radial gradient spotlight follows the mouse inside the card and reveals a layer of random matrix characters beneath the card title area.

Purpose: Adds interactive personality to the portfolio's most important section — the project showcases. Uses only already-installed `motion/react` (framer-motion 12.34.2) — no new dependency.
Output: `EvervaultCard` wrapper component applied to the two featured project cards on the home page.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/app/(portfolio)/page.tsx
@apps/web/components/portfolio/animate-in.tsx
@.planning/phases/25-personality-effects/25-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EvervaultCard component</name>
  <files>apps/web/components/portfolio/evervault-card.tsx</files>
  <action>
Create `apps/web/components/portfolio/evervault-card.tsx` using the pattern from 25-RESEARCH.md Pattern 3. Use `motion/react` (already installed) — do NOT install any new package.

```typescript
'use client'

import { useState, useCallback } from 'react'
import { motion, useMotionTemplate, useMotionValue, useReducedMotion } from 'motion/react'

// Matrix-themed noise characters — ASCII operators + katakana subset
// No purple — per design constraint
const NOISE_CHARS = 'ｦｧｨｩｯｱｲｳｴｵ0123456789ABCDEF<>[]{}|/\\^~!@#$%&*'
const NOISE_LENGTH = 1500

function randomNoise(): string {
  return Array.from(
    { length: NOISE_LENGTH },
    () => NOISE_CHARS[Math.floor(Math.random() * NOISE_CHARS.length)]
  ).join('')
}

interface EvervaultCardProps {
  children: React.ReactNode
  className?: string
}

export function EvervaultCard({ children, className }: EvervaultCardProps) {
  const prefersReducedMotion = useReducedMotion()
  const mouseX = useMotionValue(0)
  const mouseY = useMotionValue(0)
  const [noise, setNoise] = useState('')
  const [isHovered, setIsHovered] = useState(false)

  // useMotionTemplate creates a reactive string outside React's render cycle
  const maskImage = useMotionTemplate`radial-gradient(250px at ${mouseX}px ${mouseY}px, white, transparent)`

  const handleMouseMove = useCallback((e: React.MouseEvent<HTMLDivElement>) => {
    const rect = e.currentTarget.getBoundingClientRect()
    mouseX.set(e.clientX - rect.left)
    mouseY.set(e.clientY - rect.top)
    setNoise(randomNoise())
  }, [mouseX, mouseY])

  const handleMouseEnter = useCallback(() => {
    setIsHovered(true)
    setNoise(randomNoise())
  }, [])

  const handleMouseLeave = useCallback(() => {
    setIsHovered(false)
    setNoise('')
  }, [])

  // Reduced motion: render children as-is with no wrapper overhead
  if (prefersReducedMotion) {
    return <div className={className}>{children}</div>
  }

  return (
    <div
      className={`relative overflow-hidden ${className ?? ''}`}
      onMouseMove={handleMouseMove}
      onMouseEnter={handleMouseEnter}
      onMouseLeave={handleMouseLeave}
    >
      {/* Noise overlay — pointer-events-none is MANDATORY to preserve card link navigation */}
      {isHovered && (
        <motion.div
          className="pointer-events-none absolute inset-0 z-10 font-mono text-[10px] leading-[1] text-[var(--matrix-green)] opacity-60 break-all overflow-hidden"
          style={{ maskImage, WebkitMaskImage: maskImage }}
          aria-hidden="true"
        >
          {noise}
        </motion.div>
      )}
      {children}
    </div>
  )
}
```

Key constraints:
- `pointer-events-none` on the noise overlay is NON-NEGOTIABLE — without it, card link clicks are intercepted
- Handlers go on the CONTAINER div, not the overlay
- `aria-hidden="true"` on noise overlay prevents screen readers from announcing random characters
- `useMotionValue` + `useMotionTemplate` update the mask CSS outside React's render cycle — do NOT use `useState` for cursor X/Y (would cause re-render on every mousemove)
- Never use purple (#800080, purple, violet) in the color scheme
  </action>
  <verify>
```bash
# Confirm pointer-events-none is on the overlay (not the container)
grep -n "pointer-events-none" /home/doctor/fernandomillan/apps/web/components/portfolio/evervault-card.tsx

# Confirm useMotionValue is imported from motion/react (not framer-motion)
grep -n "from 'motion/react'" /home/doctor/fernandomillan/apps/web/components/portfolio/evervault-card.tsx

# TypeScript check
cd /home/doctor/fernandomillan && npx tsc --noEmit -p apps/web/tsconfig.json 2>&1 | grep "evervault" | head -10
```
  </verify>
  <done>`apps/web/components/portfolio/evervault-card.tsx` exists, exports `EvervaultCard`, imports from `motion/react`, has `pointer-events-none` on the noise overlay, and has no TypeScript errors.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate EvervaultCard into home page project cards</name>
  <files>apps/web/app/(portfolio)/page.tsx</files>
  <action>
Modify `apps/web/app/(portfolio)/page.tsx` to wrap the project card content blocks in `EvervaultCard`. The cards are inline JSX blocks (not using `ProjectCard` component) — wrap the entire inner card content div.

**Import to add at top of page.tsx:**
```tsx
import { EvervaultCard } from '@/components/portfolio/evervault-card'
```

**Wrapping strategy:** The page.tsx cards are `<Link>` elements containing `<div>` children. Wrap the inner content div (the one with `mb-6`, `h3`, `p`, badges, etc.) with `<EvervaultCard>` — NOT the outer `<Link>`. This preserves the `card-glow-hover` behavior on `<Link>` and the Evervault effect on the card content.

For the TeamFlow card, the structure should become:
```tsx
<Link href="/projects/teamflow" className="card-glow-hover block border-2 border-primary rounded-lg p-8 bg-gradient-to-br from-primary/5 to-transparent">
  <EvervaultCard className="min-h-full">
    <div className="mb-6">
      <h3 className="text-2xl md:text-3xl font-bold text-foreground mb-2">TeamFlow</h3>
      ...
    </div>
    ...
  </EvervaultCard>
</Link>
```

Apply the same wrapping to the DevCollab card.

**Important:** `page.tsx` is a Server Component (no `'use client'` directive). `EvervaultCard` is `'use client'`. This is valid — a Server Component CAN import and render a Client Component. The RSC boundary is maintained correctly.

Do NOT add `'use client'` to `page.tsx` — it must remain a Server Component for metadata export to work.
  </action>
  <verify>
```bash
# Confirm EvervaultCard is used in page.tsx
grep -n "EvervaultCard" /home/doctor/fernandomillan/apps/web/app/\(portfolio\)/page.tsx

# Confirm page.tsx still has no 'use client' directive (must stay Server Component)
head -3 /home/doctor/fernandomillan/apps/web/app/\(portfolio\)/page.tsx | grep "use client" && echo "ERROR: page.tsx must not have use client" || echo "OK: no use client directive"

# TypeScript check
cd /home/doctor/fernandomillan && npx tsc --noEmit -p apps/web/tsconfig.json 2>&1 | grep -E "page\.tsx|ERROR" | head -10
```
  </verify>
  <done>`page.tsx` imports and uses `EvervaultCard` to wrap both project card content blocks. `page.tsx` remains a Server Component (no `'use client'` directive). TypeScript has no errors.</done>
</task>

</tasks>

<verification>
```bash
# 1. No TypeScript errors
cd /home/doctor/fernandomillan && npx tsc --noEmit -p apps/web/tsconfig.json 2>&1 | tail -5

# 2. pointer-events-none confirmed on overlay
grep -n "pointer-events-none" apps/web/components/portfolio/evervault-card.tsx

# 3. motion/react import (not framer-motion)
grep "from 'motion/react'" apps/web/components/portfolio/evervault-card.tsx

# 4. EvervaultCard in page.tsx twice (TeamFlow + DevCollab)
grep -c "EvervaultCard" apps/web/app/\(portfolio\)/page.tsx

# 5. page.tsx still a Server Component
! grep -q "'use client'" apps/web/app/\(portfolio\)/page.tsx && echo "Server Component: OK" || echo "ERROR: lost Server Component status"
```
</verification>

<success_criteria>
- `EvervaultCard` component exists with `useMotionValue`/`useMotionTemplate` from `motion/react`
- Noise overlay always has `pointer-events-none` and `aria-hidden="true"`
- Both featured project cards on home page are wrapped with `EvervaultCard`
- `page.tsx` remains a Server Component
- No new npm dependencies installed
- TypeScript reports zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/25-personality-effects/25-02-SUMMARY.md` with:
- What was built (component + integration)
- How the RSC boundary was handled (Server Component importing Client Component)
- Any deviations from the plan
</output>
