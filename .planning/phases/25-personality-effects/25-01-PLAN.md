---
phase: 25-personality-effects
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/hooks/use-text-scramble.ts
  - apps/web/components/portfolio/scramble-hero.tsx
  - apps/web/components/portfolio/hero-section.tsx
autonomous: true
requirements:
  - FX-01

must_haves:
  truths:
    - "On page load, the hero h1 'Fernando Millan' text cycles through random ASCII noise characters before resolving to the correct text"
    - "The scramble effect fires exactly once per mount — refreshing the page triggers it again, navigating away and back triggers it again, but it never loops after resolution"
    - "Under prefers-reduced-motion, the hero name renders immediately as plain text with no scramble animation"
  artifacts:
    - path: "apps/web/hooks/use-text-scramble.ts"
      provides: "Hand-rolled RAF-based text scramble hook (no new dependency)"
      contains: "requestAnimationFrame"
    - path: "apps/web/components/portfolio/scramble-hero.tsx"
      provides: "'use client' component wrapping the scramble hook for the hero h1"
      exports: ["ScrambleHero"]
    - path: "apps/web/components/portfolio/hero-section.tsx"
      provides: "Modified hero section importing ScrambleHero for the name span"
      contains: "ScrambleHero"
  key_links:
    - from: "apps/web/components/portfolio/hero-section.tsx"
      to: "apps/web/components/portfolio/scramble-hero.tsx"
      via: "import { ScrambleHero }"
      pattern: "ScrambleHero"
    - from: "apps/web/components/portfolio/scramble-hero.tsx"
      to: "apps/web/hooks/use-text-scramble.ts"
      via: "import { useTextScramble }"
      pattern: "useTextScramble"
    - from: "apps/web/hooks/use-text-scramble.ts"
      to: "browser RAF"
      via: "requestAnimationFrame loop with cancelAnimationFrame cleanup"
      pattern: "cancelAnimationFrame"
---

<objective>
Implement FX-01: the hero name "Fernando Millan" scrambles from random ASCII noise characters to readable text exactly once on page load.

Purpose: Create the signature "serious hacker" first impression — visitors see the name decode itself, establishing the Matrix engineer aesthetic immediately.
Output: A hand-rolled `useTextScramble` hook + `ScrambleHero` component integrated into the existing `HeroSection`.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/components/portfolio/hero-section.tsx
@apps/web/components/portfolio/animate-in.tsx
@.planning/phases/25-personality-effects/25-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useTextScramble hook (hand-rolled, no new dependency)</name>
  <files>apps/web/hooks/use-text-scramble.ts</files>
  <action>
Create `apps/web/hooks/use-text-scramble.ts` as a `'use client'`-compatible hook (no directive needed — it is a hook file, not a component). Use the hand-rolled pattern from 25-RESEARCH.md Pattern 2 — do NOT install `use-scramble`.

```typescript
import { useEffect, useRef, useState } from 'react'

// Visible ASCII range: 33–126 (excludes space/DEL)
const CHARS = Array.from({ length: 94 }, (_, i) => String.fromCharCode(i + 33)).join('')

/**
 * Scrambles `target` text from random ASCII noise to the correct string.
 * Fires exactly once when `enabled` is true. Never loops.
 * When `enabled` is false (reduced motion), returns `target` immediately.
 */
export function useTextScramble(target: string, enabled = true) {
  const [display, setDisplay] = useState(enabled ? '' : target)
  const frameRef = useRef<number>(0)
  const iterRef = useRef(0)

  useEffect(() => {
    if (!enabled) {
      setDisplay(target)
      return
    }

    iterRef.current = 0
    const totalFrames = target.length * 6  // ~6 frames per character at 60fps ≈ 100ms per char

    function step() {
      const progress = iterRef.current / totalFrames
      const resolved = Math.floor(progress * target.length)

      const output = target
        .split('')
        .map((char, i) => {
          if (i < resolved) return char
          // Keep spaces as spaces — do not replace with noise
          if (char === ' ') return ' '
          return CHARS[Math.floor(Math.random() * CHARS.length)]
        })
        .join('')

      setDisplay(output)
      iterRef.current++

      if (iterRef.current <= totalFrames) {
        frameRef.current = requestAnimationFrame(step)
      } else {
        setDisplay(target)  // guarantee exact final text, fires exactly once
      }
    }

    frameRef.current = requestAnimationFrame(step)
    return () => cancelAnimationFrame(frameRef.current)
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [target, enabled])

  return display
}
```

Key constraints:
- Space characters must remain spaces throughout the scramble (avoids jarring width changes in "Fernando Millan")
- `cancelAnimationFrame` in cleanup prevents the effect from continuing after unmount (prevents memory leak)
- Initial state is `''` (empty) when enabled=true so the scramble starts from nothing — this is intentional
- The hook MUST NOT call `replay()` or restart the effect — once `totalFrames` is reached, done
  </action>
  <verify>
```bash
# Confirm file exists and contains the key patterns
grep -n "cancelAnimationFrame\|requestAnimationFrame\|totalFrames" apps/web/hooks/use-text-scramble.ts
# Must output 3+ matches showing RAF usage, cleanup, and frame count
```
  </verify>
  <done>File exists at `apps/web/hooks/use-text-scramble.ts`, exports `useTextScramble`, uses `requestAnimationFrame` for animation, `cancelAnimationFrame` in cleanup return, and sets final state to `target` guaranteeing exact text after animation ends.</done>
</task>

<task type="auto">
  <name>Task 2: Create ScrambleHero component + integrate into HeroSection</name>
  <files>
    apps/web/components/portfolio/scramble-hero.tsx
    apps/web/components/portfolio/hero-section.tsx
  </files>
  <action>
**Step A — Create `apps/web/components/portfolio/scramble-hero.tsx`:**

```typescript
'use client'

import { useReducedMotion } from 'motion/react'
import { useTextScramble } from '@/hooks/use-text-scramble'

interface ScrambleHeroProps {
  text: string
  className?: string
}

export function ScrambleHero({ text, className }: ScrambleHeroProps) {
  const prefersReducedMotion = useReducedMotion()
  const display = useTextScramble(text, !prefersReducedMotion)

  return (
    // aria-label provides the correct name to screen readers even during scramble
    <span className={className} aria-label={text}>
      {display || '\u00A0'}
    </span>
  )
}
```

The `|| '\u00A0'` (non-breaking space) prevents layout collapse when `display` is `''` on the first frame. `aria-label={text}` ensures screen readers always announce the correct name, not scrambled characters.

**Step B — Modify `apps/web/components/portfolio/hero-section.tsx`:**

Replace the first `<span className="block mb-2">Fernando Millan</span>` with `<ScrambleHero>`. The component is already `'use client'` — no boundary change needed.

Change this:
```tsx
<h1 className="text-4xl md:text-5xl lg:text-6xl font-bold text-foreground mb-6">
  <span className="block mb-2">Fernando Millan</span>
```

To this:
```tsx
import { ScrambleHero } from '@/components/portfolio/scramble-hero'

// ...inside HeroSection return:
<h1 className="text-4xl md:text-5xl lg:text-6xl font-bold text-foreground mb-6">
  <ScrambleHero text="Fernando Millan" className="block mb-2" />
```

The second span (`Full-Stack Engineer Building Production-Ready SaaS`) remains a plain `<span>` — only the name scrambles (FX-01 scope).

Constraints:
- Do NOT wrap ScrambleHero in `next/dynamic` — it is already inside the `'use client'` HeroSection which is itself loaded via `next/dynamic({ ssr: false })` from the server page
- Do NOT add `'use client'` to page.tsx or layout.tsx — existing SSR boundary is sufficient
- Import `ScrambleHero` at the top of hero-section.tsx with other imports
  </action>
  <verify>
```bash
cd /home/doctor/fernandomillan && npx tsc --noEmit -p apps/web/tsconfig.json 2>&1 | grep -E "scramble|ERROR" | head -20
# Should output nothing (no TypeScript errors in scramble files)
```
  </verify>
  <done>`apps/web/components/portfolio/scramble-hero.tsx` exists and exports `ScrambleHero`. `hero-section.tsx` imports and uses `ScrambleHero` for the "Fernando Millan" text span. TypeScript compilation has no errors in these files.</done>
</task>

</tasks>

<verification>
```bash
# 1. TypeScript — no errors
cd /home/doctor/fernandomillan && npx tsc --noEmit -p apps/web/tsconfig.json 2>&1 | tail -5

# 2. Confirm ScrambleHero is in hero-section
grep -n "ScrambleHero" apps/web/components/portfolio/hero-section.tsx

# 3. Confirm hook cleanup pattern
grep -n "cancelAnimationFrame" apps/web/hooks/use-text-scramble.ts

# 4. Confirm aria-label accessibility attribute
grep -n "aria-label" apps/web/components/portfolio/scramble-hero.tsx

# 5. Dev build smoke-test (Next.js compiles without error)
cd apps/web && timeout 30 npx next build --experimental-build-mode compile 2>&1 | tail -10 || echo "compile mode not supported — skipping"
```
</verification>

<success_criteria>
- `useTextScramble` hook exists at `apps/web/hooks/use-text-scramble.ts` with RAF loop and `cancelAnimationFrame` cleanup
- `ScrambleHero` component exists at `apps/web/components/portfolio/scramble-hero.tsx` with `aria-label` and reduced-motion guard
- `hero-section.tsx` uses `ScrambleHero` for "Fernando Millan" text
- No new npm dependencies installed — hand-rolled hook only
- TypeScript reports zero errors across the modified files
</success_criteria>

<output>
After completion, create `.planning/phases/25-personality-effects/25-01-SUMMARY.md` with:
- What was built (hook + component + integration)
- Key decisions made during implementation
- Patterns established (e.g. hooks/ directory location, aria-label pattern for scramble)
- Any deviations from the plan
</output>
