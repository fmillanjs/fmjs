---
phase: 02-core-work-management
plan: 08
type: execute
wave: 7
depends_on: ["02-07"]
files_modified:
  - apps/web/components/tasks/task-filters.tsx
  - apps/web/components/tasks/task-search.tsx
  - apps/web/app/(dashboard)/teams/[teamId]/projects/[projectId]/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can filter tasks by status (multi-select)"
    - "User can filter tasks by priority (multi-select)"
    - "User can filter tasks by assignee"
    - "User can filter tasks by labels"
    - "User can search tasks by title and description"
    - "User can sort tasks by due date, priority, created date"
    - "Filter state persists in URL for shareable links"
  artifacts:
    - path: "apps/web/components/tasks/task-filters.tsx"
      provides: "Filter bar with status, priority, assignee, label dropdowns"
      contains: "useQueryStates"
    - path: "apps/web/components/tasks/task-search.tsx"
      provides: "Search input for tasks"
  key_links:
    - from: "apps/web/components/tasks/task-filters.tsx"
      to: "URL search params"
      via: "nuqs for URL state management"
      pattern: "useQueryStates|parseAsString|parseAsArrayOf"
    - from: "apps/web/app/(dashboard)/teams/[teamId]/projects/[projectId]/page.tsx"
      to: "/api"
      via: "passes filter params to API call"
      pattern: "status=|priority=|search="
---

<objective>
Add task filtering, search, and sort controls to the project page using nuqs for URL-based state management. Filter state in URL enables shareable filtered views and browser back/forward navigation.

Purpose: Filtering and search are essential for task management at scale. URL-based filter state is a professional pattern that impresses technical reviewers (shareable links, SSR-compatible).
Output: Fully functional filter bar, search, and sort integrated with Kanban and List views
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-work-management/02-RESEARCH.md
@.planning/phases/02-core-work-management/02-07-SUMMARY.md
@apps/web/components/tasks/kanban-board.tsx
@apps/web/components/tasks/task-list-view.tsx
@apps/web/app/(dashboard)/teams/[teamId]/projects/[projectId]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create filter bar and search components with nuqs URL state</name>
  <files>
    apps/web/components/tasks/task-filters.tsx
    apps/web/components/tasks/task-search.tsx
  </files>
  <action>
    **Create components/tasks/task-filters.tsx:**
    - Client component ('use client')
    - Uses nuqs for URL search param state management (following 02-RESEARCH.md pattern)
    - useQueryStates with:
      - `status`: parseAsArrayOf(parseAsString) — multi-select status filter
      - `priority`: parseAsArrayOf(parseAsString) — multi-select priority filter
      - `assignee`: parseAsString — single assignee filter
      - `labels`: parseAsArrayOf(parseAsString) — multi-select label filter
      - `sortBy`: parseAsString.withDefault('createdAt') — sort column
      - `sortOrder`: parseAsString.withDefault('desc') — sort direction
    - Wrap all state updates in useTransition for non-blocking UI

    **Filter UI layout:**
    - Horizontal filter bar below project header, above task views
    - Status filter: dropdown with checkboxes (TODO, IN_PROGRESS, DONE, BLOCKED) — show colored badges
    - Priority filter: dropdown with checkboxes (LOW, MEDIUM, HIGH, URGENT) — show colored badges
    - Assignee filter: dropdown of team members with avatars
    - Labels filter: dropdown with colored dots + label names
    - Sort: dropdown (Due Date, Priority, Created Date) with asc/desc toggle
    - "Clear all filters" button (appears when any filter is active)
    - Active filter count badge on filter bar

    **Props:** teamMembers (for assignee dropdown), labels (for label dropdown)

    **Create components/tasks/task-search.tsx:**
    - Client component
    - Search input with magnifying glass icon
    - Uses nuqs: `search: parseAsString.withDefault('')`
    - Debounced input (300ms) to avoid excessive API calls
    - Clear button (X) when search has value
    - Placeholder: "Search tasks..."
    - Wrapped in useTransition
  </action>
  <verify>
    1. Filter bar renders with all 4 filter dropdowns + sort
    2. Selecting a filter updates URL params (?status=TODO&priority=HIGH)
    3. Search input updates URL with debounce (?search=keyword)
    4. Clear all filters resets URL to clean state
    5. Browser back button restores previous filter state
  </verify>
  <done>Filter bar with multi-select status/priority/label filters, assignee dropdown, sort control, and debounced search. All state in URL via nuqs.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate filters with project page data fetching and both views</name>
  <files>
    apps/web/app/(dashboard)/teams/[teamId]/projects/[projectId]/page.tsx
  </files>
  <action>
    **Update projects/[projectId]/page.tsx:**

    This is a Server Component that receives searchParams. Update it to:

    1. Parse searchParams to extract filter values:
       - status (array), priority (array), assignee (string), labels (array), search (string), sortBy (string), sortOrder (string), view (string)

    2. Pass filter params to API call:
       - Build query string: GET /projects/:projectId/tasks?status=TODO,IN_PROGRESS&priority=HIGH&assigneeId=xxx&search=keyword&sortBy=dueDate&sortOrder=asc
       - API should support all these params (built in Plan 04)

    3. Render filter components ABOVE the view:
       ```
       <TaskSearch />
       <TaskFilters teamMembers={members} labels={labels} />
       <ViewToggle />
       <Suspense fallback={<TasksSkeleton />}>
         {view === 'board' ? <KanbanBoard tasks={filteredTasks} ... /> : <TaskListView tasks={filteredTasks} ... />}
       </Suspense>
       ```

    4. Both Kanban and List views receive the ALREADY FILTERED tasks from the server.
       - Kanban shows filtered tasks in columns (some columns may be empty if filtered out)
       - List view shows filtered and sorted tasks

    5. When filters change (URL updates), the Server Component re-fetches with new params (Next.js App Router handles this via searchParams).

    6. Add loading states: use Suspense boundary with skeleton loading for task views while data loads.

    **Edge case handling:**
    - Empty results: "No tasks match your filters. Try adjusting your criteria." with "Clear filters" link
    - Invalid filter values: ignore and show all tasks
    - Kanban with status filter: if user filters to only "TODO", only that column shows tasks; other columns show "No tasks" but remain visible as drop targets
  </action>
  <verify>
    Full integration test:
    1. Load project page — all tasks visible
    2. Select status filter "TODO" — only TODO tasks shown in both views
    3. Add priority filter "HIGH" — further narrows results
    4. Type in search — results filter by title/description
    5. Change sort to "Due Date" — list view reorders
    6. Copy URL and open in new tab — same filters applied
    7. Clear all — all tasks visible again
    8. Toggle between board/list with active filters — filters persist
  </verify>
  <done>Filters, search, and sort fully integrated with both task views. URL-based state enables shareable links. Server-side filtering for performance. Loading states with Suspense.</done>
</task>

</tasks>

<verification>
1. All filter types work: status, priority, assignee, labels
2. Search finds tasks by title and description
3. Sort works in list view (due date, priority, created date)
4. Filter state persists in URL
5. Browser back/forward works with filters
6. Both views (board/list) respect active filters
7. Clear filters button resets everything
8. Empty state shows when no tasks match
</verification>

<success_criteria>
- VIEW-04: User can filter tasks by status, priority, assignee, labels
- VIEW-05: User can search tasks by title and description
- VIEW-06: User can sort tasks by due date, priority, created date
- Filters shareable via URL
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-work-management/02-08-SUMMARY.md`
</output>
