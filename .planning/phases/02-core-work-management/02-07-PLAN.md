---
phase: 02-core-work-management
plan: 07
type: execute
wave: 6
depends_on: ["02-04", "02-06"]
files_modified:
  - apps/web/components/tasks/kanban-board.tsx
  - apps/web/components/tasks/kanban-column.tsx
  - apps/web/components/tasks/task-card.tsx
  - apps/web/components/tasks/task-list-view.tsx
  - apps/web/components/tasks/task-form.tsx
  - apps/web/components/tasks/view-toggle.tsx
  - apps/web/app/(dashboard)/teams/[teamId]/projects/[projectId]/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can view tasks in Kanban board with 4 status columns (To Do, In Progress, Done, Blocked)"
    - "User can drag and drop tasks between status columns"
    - "User can view tasks in list format with sortable columns"
    - "User can toggle between Kanban and List views"
    - "User can create a new task via modal form"
    - "User can edit a task via modal form"
    - "Drag-and-drop updates task status optimistically"
  artifacts:
    - path: "apps/web/components/tasks/kanban-board.tsx"
      provides: "Kanban board with dnd-kit drag-and-drop"
      contains: "DndContext"
    - path: "apps/web/components/tasks/task-list-view.tsx"
      provides: "List view with TanStack Table"
      contains: "useReactTable"
    - path: "apps/web/components/tasks/task-form.tsx"
      provides: "Task create/edit modal form"
    - path: "apps/web/components/tasks/task-card.tsx"
      provides: "Task card used in both Kanban and list"
  key_links:
    - from: "apps/web/components/tasks/kanban-board.tsx"
      to: "/api"
      via: "PATCH /tasks/:id/status on drag end"
      pattern: "updateTaskStatus|api\\.patch"
    - from: "apps/web/components/tasks/kanban-board.tsx"
      to: "@dnd-kit/core"
      via: "DndContext, DragOverlay"
      pattern: "DndContext"
    - from: "apps/web/components/tasks/task-list-view.tsx"
      to: "@tanstack/react-table"
      via: "useReactTable for data table"
      pattern: "useReactTable"
---

<objective>
Build the Kanban board with drag-and-drop using @dnd-kit, the list view with @tanstack/react-table, task creation/edit modal form, and view toggle. This is the core UI of TeamFlow — the primary interface recruiters will interact with.

Purpose: The Kanban board is the centerpiece of TeamFlow and the most visually impressive feature. Drag-and-drop with optimistic updates demonstrates React 19 and modern UX patterns.
Output: Working Kanban board and list view with task CRUD
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-work-management/02-RESEARCH.md
@.planning/phases/02-core-work-management/02-04-SUMMARY.md
@.planning/phases/02-core-work-management/02-06-SUMMARY.md
@apps/web/lib/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and create task card, task form, and view toggle components</name>
  <files>
    apps/web/components/tasks/task-card.tsx
    apps/web/components/tasks/task-form.tsx
    apps/web/components/tasks/view-toggle.tsx
  </files>
  <action>
    **Install dependencies:**
    ```
    npm install @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities --workspace=apps/web
    npm install @tanstack/react-table nuqs --workspace=apps/web
    npm install date-fns --workspace=apps/web  (if not already installed)
    ```

    **Create components/tasks/task-card.tsx:**
    - Client component
    - Props: task (TaskWithRelations), isDragging (boolean, optional), onClick (callback)
    - Display: title, priority badge (color-coded: URGENT=red, HIGH=orange, MEDIUM=yellow, LOW=slate), status badge, assignee avatar (or initials), due date (relative format via date-fns, red if overdue), label chips (colored dots), comment count icon
    - Priority colors: URGENT=#ef4444, HIGH=#f97316, MEDIUM=#eab308, LOW=#64748b
    - Compact card design suitable for Kanban columns
    - When isDragging=true, add opacity and shadow styling
    - onClick opens task detail/edit modal
    - Make card draggable-ready (will be wrapped by dnd-kit in Kanban)

    **Create components/tasks/task-form.tsx:**
    - Client component modal/dialog
    - Props: mode ('create' | 'edit'), task (optional, for edit), projectId, teamMembers (for assignee dropdown), labels (for label selection), onClose, onSuccess
    - Fields: title (required), description (textarea), status (dropdown: TODO/IN_PROGRESS/DONE/BLOCKED), priority (dropdown: LOW/MEDIUM/HIGH/URGENT), dueDate (date picker), assigneeId (dropdown of team members), labelIds (multi-select checkboxes of labels)
    - Validates with createTaskSchema or updateTaskSchema from @repo/shared
    - React Hook Form + Zod resolver
    - onSubmit: POST /projects/:projectId/tasks (create) or PATCH /tasks/:id (edit)
    - Loading state, success toast, close modal and refresh
    - Modal overlay with backdrop, close on Escape

    **Create components/tasks/view-toggle.tsx:**
    - Client component
    - Two buttons: "Board" (grid icon) and "List" (list icon)
    - Active state styling on selected view
    - Store preference in URL search param ?view=board|list (using nuqs or manual searchParams)
    - Emit onChange callback for parent to switch views
  </action>
  <verify>
    Components compile without TypeScript errors. Visual inspection of task card with mock data. Task form opens as modal with all fields.
  </verify>
  <done>Task card renders with all task metadata (priority, status, assignee, due date, labels). Task form validates and submits. View toggle switches between board and list.</done>
</task>

<task type="auto">
  <name>Task 2: Build Kanban board with dnd-kit drag-and-drop and optimistic updates</name>
  <files>
    apps/web/components/tasks/kanban-board.tsx
    apps/web/components/tasks/kanban-column.tsx
  </files>
  <action>
    **Create components/tasks/kanban-column.tsx:**
    - Droppable column using @dnd-kit/sortable SortableContext
    - Props: id (status string), title, tasks, count
    - Header: column title with task count badge
    - Render TaskCards inside sortable container
    - Min-height for empty columns (drop target)
    - Styled: rounded border, dashed when empty, bg-muted/50

    **Create components/tasks/kanban-board.tsx:**
    - Client component ('use client')
    - Props: initialTasks (TaskWithRelations[]), projectId, teamMembers, labels
    - Uses React 19 useOptimistic for instant status updates on drag
    - 4 columns: TODO ("To Do"), IN_PROGRESS ("In Progress"), DONE ("Done"), BLOCKED ("Blocked")

    **DndContext setup (following 02-RESEARCH.md pattern):**
    - Sensors: PointerSensor (activationConstraint distance: 8 to prevent accidental drags), KeyboardSensor for accessibility
    - CollisionDetection: closestCorners
    - onDragStart: set activeId for overlay
    - onDragEnd: determine target column from over.id or over.data, call setOptimisticTasks to update status instantly, then call API PATCH /tasks/:id/status. On API error, the optimistic state reverts automatically.
    - DragOverlay: renders TaskCard with isDragging=true for visual feedback during drag

    **Column layout:**
    - `grid grid-cols-4 gap-4` on desktop
    - Horizontal scroll on mobile (overflow-x-auto with min-width per column)
    - Each column: flex-col, min-h-[400px]

    **"Add Task" button** at bottom of each column (or top of board) that opens TaskForm modal in create mode with status pre-filled to that column's status.

    **Key implementation details:**
    - Filter tasks by status to populate each column
    - When dragging between columns, the task appears in the new column immediately (optimistic)
    - DragOverlay shows the card being dragged above all columns
    - Accessible: keyboard users can use Tab to focus a card, Enter to pick up, Arrow keys to move between columns, Enter to drop
  </action>
  <verify>
    1. Kanban board renders 4 columns with tasks distributed by status
    2. Drag a task from "To Do" to "In Progress" — card moves instantly
    3. API call fires on drop (check network tab)
    4. DragOverlay visible during drag
    5. "Add Task" opens form with correct status
    6. Keyboard navigation works (Tab, Enter, Arrow keys)
  </verify>
  <done>Kanban board with dnd-kit drag-and-drop between 4 status columns. Optimistic UI updates with React 19 useOptimistic. Keyboard accessible. Add task per column.</done>
</task>

<task type="auto">
  <name>Task 3: Build list view with TanStack Table and integrate both views into project page</name>
  <files>
    apps/web/components/tasks/task-list-view.tsx
    apps/web/app/(dashboard)/teams/[teamId]/projects/[projectId]/page.tsx
  </files>
  <action>
    **Create components/tasks/task-list-view.tsx:**
    - Client component using @tanstack/react-table
    - Columns: checkbox (select), title, status (badge), priority (badge with color), assignee (avatar + name), due date (formatted, red if overdue), labels (color dots), comments (count icon)
    - Sortable columns: click header to sort by that column (title, status, priority, dueDate, createdAt)
    - Row click opens task detail/edit
    - Hover highlight on rows
    - Responsive: hide some columns on mobile (labels, comments)
    - Empty state: "No tasks yet. Create your first task."
    - Table styling: bordered rows, alternating row colors (subtle), sticky header

    **Update projects/[projectId]/page.tsx:**
    - Replace placeholder content with actual task views
    - Server Component that fetches:
      - Project details: GET /projects/:projectId
      - Tasks: GET /projects/:projectId/tasks
      - Team members: GET /teams/:teamId/members (for assignee dropdown in forms)
      - Labels: GET /teams/:teamId/labels (for label selection)
    - Render:
      - Project header (name, description, settings link)
      - ViewToggle component (board/list)
      - Conditionally render KanbanBoard or TaskListView based on view state
      - "New Task" button that opens TaskForm modal
    - Pass tasks, teamMembers, labels to child components
    - URL state for view preference: ?view=board (default) or ?view=list
  </action>
  <verify>
    1. /teams/[teamId]/projects/[projectId] shows task views
    2. Default view is Kanban board
    3. Toggle to list view shows table with sortable columns
    4. Click column header sorts tasks
    5. "New Task" button opens form, creates task, refreshes view
    6. Both views show same tasks
    7. Toggle persists in URL (?view=board or ?view=list)
  </verify>
  <done>Both Kanban and List views integrated into project page with view toggle. Tasks display correctly in both formats. New task creation works from both views. Sort works in list view.</done>
</task>

</tasks>

<verification>
1. Kanban board renders with drag-and-drop between columns
2. List view renders with sortable columns
3. View toggle switches between board and list
4. Task creation via modal form works
5. Task edit via clicking card/row works
6. Optimistic updates on drag-drop
7. Keyboard accessibility for drag-and-drop
8. Mobile responsive layout
</verification>

<success_criteria>
- VIEW-01: User can view tasks in list format
- VIEW-02: User can view tasks in Kanban board format
- VIEW-03: User can drag and drop tasks between status columns
- Task creation and editing UI functional
- VIEW-06 (partial): Sorting works in list view
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-work-management/02-07-SUMMARY.md`
</output>
