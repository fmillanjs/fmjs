---
phase: 02-core-work-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/database/prisma/schema.prisma
  - packages/shared/src/types/team.ts
  - packages/shared/src/types/project.ts
  - packages/shared/src/types/task.ts
  - packages/shared/src/types/index.ts
  - packages/shared/src/validators/team.schema.ts
  - packages/shared/src/validators/project.schema.ts
  - packages/shared/src/validators/task.schema.ts
  - packages/shared/src/validators/index.ts
  - packages/shared/src/types/enums.ts
autonomous: true

must_haves:
  truths:
    - "Organization, Membership, Project, Task, Label, Comment models exist in database"
    - "Shared TypeScript types for teams, projects, tasks are importable from @repo/shared"
    - "Zod validation schemas for team, project, task CRUD exist and validate correctly"
    - "Database indexes exist on all foreign keys and filter columns"
  artifacts:
    - path: "packages/database/prisma/schema.prisma"
      provides: "Organization, Membership, Project, Task, Label, Comment models with enums"
      contains: "model Organization"
    - path: "packages/shared/src/types/team.ts"
      provides: "TeamBase, MembershipBase types"
    - path: "packages/shared/src/types/project.ts"
      provides: "ProjectBase type"
    - path: "packages/shared/src/types/task.ts"
      provides: "TaskBase, CommentBase, LabelBase types"
    - path: "packages/shared/src/validators/team.schema.ts"
      provides: "createTeamSchema, inviteMemberSchema"
    - path: "packages/shared/src/validators/project.schema.ts"
      provides: "createProjectSchema, updateProjectSchema"
    - path: "packages/shared/src/validators/task.schema.ts"
      provides: "createTaskSchema, updateTaskSchema, createCommentSchema"
  key_links:
    - from: "packages/shared/src/types/enums.ts"
      to: "packages/database/prisma/schema.prisma"
      via: "enum values must match"
      pattern: "ProjectStatus|TaskStatus|TaskPriority"
---

<objective>
Add Organization, Membership, Project, Task, Label, and Comment models to Prisma schema with proper enums, indexes, and composite unique constraints. Create shared TypeScript types and Zod validation schemas for all Phase 2 entities.

Purpose: Establish the data foundation that all Phase 2 backend and frontend plans depend on. Without these models, no API endpoints or UI components can be built.
Output: Updated schema.prisma, new shared types, new Zod validators
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-work-management/02-RESEARCH.md
@.planning/phases/01-foundation-authentication/01-02-SUMMARY.md
@packages/database/prisma/schema.prisma
@packages/shared/src/types/enums.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Organization, Membership, Project, Task, Label, Comment models to Prisma schema</name>
  <files>
    packages/database/prisma/schema.prisma
  </files>
  <action>
    Add the following models to the existing schema.prisma (keep all existing models: User, Account, Session, VerificationToken, AuditLog):

    **Enums to add:**
    - `ProjectStatus { ACTIVE, ARCHIVED }`
    - `TaskStatus { TODO, IN_PROGRESS, DONE, BLOCKED }`
    - `TaskPriority { LOW, MEDIUM, HIGH, URGENT }`

    **Models to add (following patterns from 02-RESEARCH.md):**

    1. `Organization` — id (cuid), name, slug (@unique, @index), createdAt, updatedAt. Relations: members (Membership[]), projects (Project[]), labels (Label[]).

    2. `Membership` — id (cuid), role (UserRole), userId, organizationId, joinedAt. Relations: user → User, organization → Organization. @@unique([userId, organizationId]), @@index([userId]), @@index([organizationId]).

    3. `Project` — id (cuid), name, description (@db.Text, optional), status (ProjectStatus, default ACTIVE), organizationId, createdAt, updatedAt. Relations: organization → Organization, tasks (Task[]). @@unique([organizationId, name]), @@index([organizationId]), @@index([status]).

    4. `Task` — id (cuid), title, description (@db.Text, optional), status (TaskStatus, default TODO), priority (TaskPriority, default MEDIUM), dueDate (optional), position (Int, default 0 for ordering within status columns), projectId, assigneeId (optional), createdById, createdAt, updatedAt. Relations: project → Project (onDelete Cascade), assignee → User (relation name "TaskAssignee", onDelete SetNull), createdBy → User (relation name "TaskCreator"), labels → Label[] (implicit m2m), comments → Comment[]. @@index on: projectId, assigneeId, createdById, status, priority, dueDate, createdAt. Composite: @@index([projectId, status]) for Kanban queries.

    5. `Label` — id (cuid), name, color (String, default "#64748b"), organizationId. Relations: organization → Organization (onDelete Cascade), tasks → Task[] (implicit m2m). @@unique([organizationId, name]), @@index([organizationId]).

    6. `Comment` — id (cuid), content (@db.Text), taskId, authorId, createdAt, updatedAt. Relations: task → Task (onDelete Cascade), author → User. @@index([taskId]), @@index([authorId]), @@index([createdAt]).

    **Update User model** to add relations:
    - `memberships Membership[]`
    - `assignedTasks Task[] @relation("TaskAssignee")`
    - `createdTasks Task[] @relation("TaskCreator")`
    - `comments Comment[]`

    After updating schema, run `npx prisma db push` to sync database.

    IMPORTANT: Do NOT remove any existing models or relations. Only ADD new models and update User with new relations.
  </action>
  <verify>
    Run `npx prisma db push --skip-generate && npx prisma generate` from packages/database. Should succeed with no errors. Verify tables exist: `npx prisma db execute --stdin <<< "SELECT tablename FROM pg_tables WHERE schemaname='public' ORDER BY tablename;"` should show Organization, Membership, Project, Task, Label, Comment, _LabelToTask (implicit m2m join table).
  </verify>
  <done>All 6 new models exist in database with proper enums, indexes, composite unique constraints, and foreign key relations. User model updated with new relations. Prisma client regenerated.</done>
</task>

<task type="auto">
  <name>Task 2: Create shared TypeScript types and Zod validation schemas for Phase 2 entities</name>
  <files>
    packages/shared/src/types/team.ts
    packages/shared/src/types/project.ts
    packages/shared/src/types/task.ts
    packages/shared/src/types/enums.ts
    packages/shared/src/types/index.ts
    packages/shared/src/validators/team.schema.ts
    packages/shared/src/validators/project.schema.ts
    packages/shared/src/validators/task.schema.ts
    packages/shared/src/validators/index.ts
  </files>
  <action>
    **Update enums.ts** to add:
    - `ProjectStatus` as const object: { ACTIVE: 'ACTIVE', ARCHIVED: 'ARCHIVED' }
    - `TaskStatus` as const object: { TODO: 'TODO', IN_PROGRESS: 'IN_PROGRESS', DONE: 'DONE', BLOCKED: 'BLOCKED' }
    - `TaskPriority` as const object: { LOW: 'LOW', MEDIUM: 'MEDIUM', HIGH: 'HIGH', URGENT: 'URGENT' }
    - Export type aliases for each (same pattern as existing UserRole)

    **Create types/team.ts:**
    - `OrganizationBase`: id, name, slug, createdAt, updatedAt
    - `MembershipBase`: id, role, userId, organizationId, joinedAt
    - `TeamMember`: MembershipBase & { user: { id, name, email, image } }
    - `OrganizationWithMembers`: OrganizationBase & { members: TeamMember[] }

    **Create types/project.ts:**
    - `ProjectBase`: id, name, description, status, organizationId, createdAt, updatedAt
    - `ProjectWithTaskCount`: ProjectBase & { _count: { tasks: number } }

    **Create types/task.ts:**
    - `LabelBase`: id, name, color, organizationId
    - `CommentBase`: id, content, taskId, authorId, createdAt, updatedAt
    - `CommentWithAuthor`: CommentBase & { author: { id, name, image } }
    - `TaskBase`: id, title, description, status, priority, dueDate, position, projectId, assigneeId, createdById, createdAt, updatedAt
    - `TaskWithRelations`: TaskBase & { assignee?: { id, name, image }, labels: LabelBase[], _count: { comments: number } }
    - `TaskDetail`: TaskBase & { assignee?: { id, name, image }, labels: LabelBase[], comments: CommentWithAuthor[], createdBy: { id, name, image } }

    **Update types/index.ts** to re-export all new types.

    **Create validators/team.schema.ts:**
    - `createTeamSchema`: name (string, 2-50 chars, trimmed)
    - `inviteMemberSchema`: email (valid email), role (UserRole enum, default MEMBER)
    - Export inferred types with z.infer

    **Create validators/project.schema.ts:**
    - `createProjectSchema`: name (string, 2-100 chars), description (string, optional, max 2000)
    - `updateProjectSchema`: createProjectSchema.partial() (all fields optional)
    - Export inferred types

    **Create validators/task.schema.ts:**
    - `createTaskSchema`: title (string, 1-200 chars), description (string, optional), status (TaskStatus enum, default TODO), priority (TaskPriority enum, default MEDIUM), dueDate (z.coerce.date, optional), assigneeId (string.cuid, optional), labelIds (array of string.cuid, default []), projectId (string.cuid)
    - `updateTaskSchema`: createTaskSchema.partial().omit({ projectId: true }) — can't change project
    - `updateTaskStatusSchema`: status (TaskStatus enum) — for drag-drop Kanban
    - `createCommentSchema`: content (string, 1-5000 chars)
    - Export inferred types

    **Update validators/index.ts** to re-export all new validators.

    Follow existing patterns: use z.infer for types, export both schema and inferred type.
  </action>
  <verify>
    Run `cd packages/shared && npx tsc --noEmit` — should compile with no errors. Import check: verify types and validators are accessible from `@repo/shared`.
  </verify>
  <done>All Phase 2 types (Organization, Project, Task, Label, Comment) and Zod validators (create/update team, project, task, comment) compile without errors and are exported from @repo/shared.</done>
</task>

</tasks>

<verification>
1. `npx prisma db push` succeeds from packages/database
2. All new tables visible in database (Organization, Membership, Project, Task, Label, Comment, _LabelToTask)
3. `npx tsc --noEmit` passes in packages/shared
4. New types importable: `import { TaskBase, createTaskSchema } from '@repo/shared'`
</verification>

<success_criteria>
- 6 new Prisma models with proper indexes and constraints
- 3 new enums (ProjectStatus, TaskStatus, TaskPriority)
- Shared types for all entities
- Zod validators for all CRUD operations
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-work-management/02-01-SUMMARY.md`
</output>
