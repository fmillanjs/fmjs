---
phase: 02-core-work-management
plan: 10
type: execute
wave: 8
depends_on: ["02-08", "02-09"]
files_modified:
  - apps/web/app/(dashboard)/teams/[teamId]/projects/[projectId]/activity/page.tsx
  - apps/web/app/(dashboard)/teams/[teamId]/audit-log/page.tsx
  - apps/web/components/activity/activity-feed.tsx
  - apps/web/components/activity/activity-item.tsx
  - apps/web/components/activity/audit-log-table.tsx
autonomous: true

must_haves:
  truths:
    - "User can view activity feed for a project showing recent actions"
    - "Activity feed loads more items on scroll (infinite scroll)"
    - "Admin can view searchable audit log for the team"
    - "Non-admin cannot access audit log (redirect or 403)"
    - "Activity entries show who did what and when"
  artifacts:
    - path: "apps/web/components/activity/activity-feed.tsx"
      provides: "Project activity feed with infinite scroll"
      contains: "InfiniteScroll"
    - path: "apps/web/components/activity/audit-log-table.tsx"
      provides: "Admin audit log table with search and filters"
    - path: "apps/web/app/(dashboard)/teams/[teamId]/audit-log/page.tsx"
      provides: "Admin-only audit log page"
  key_links:
    - from: "apps/web/components/activity/activity-feed.tsx"
      to: "/api"
      via: "GET /projects/:id/activity with pagination"
      pattern: "api\\.get.*activity.*offset"
    - from: "apps/web/components/activity/audit-log-table.tsx"
      to: "/api"
      via: "GET /teams/:id/audit-log with search params"
      pattern: "api\\.get.*audit-log"
---

<objective>
Build the project activity feed (infinite scroll timeline of recent actions) and the admin-only searchable audit log. These views surface the audit data collected by the backend throughout Phase 2.

Purpose: Activity feed shows project collaboration history. Audit log demonstrates enterprise-grade accountability tracking. Both are impressive to recruiters evaluating production readiness.
Output: Project activity feed page and admin audit log page
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-work-management/02-RESEARCH.md
@.planning/phases/02-core-work-management/02-04-SUMMARY.md
@.planning/phases/02-core-work-management/02-09-SUMMARY.md
@apps/web/lib/api.ts
@apps/api/src/core/audit/audit.service.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project activity feed with infinite scroll</name>
  <files>
    apps/web/app/(dashboard)/teams/[teamId]/projects/[projectId]/activity/page.tsx
    apps/web/components/activity/activity-feed.tsx
    apps/web/components/activity/activity-item.tsx
  </files>
  <action>
    Install react-infinite-scroll-component: `npm install react-infinite-scroll-component --workspace=apps/web`

    **Create components/activity/activity-item.tsx:**
    - Props: activity (audit log entry with actor info)
    - Renders a single activity entry:
      - Left: avatar of actor
      - Center: human-readable description (same formatting logic as task-history.tsx)
        - "[Name] created task [Title]"
        - "[Name] moved [Title] from To Do to In Progress"
        - "[Name] commented on [Title]"
        - "[Name] created project [Name]"
        - "[Name] invited [Name] to the team"
        - "[Name] archived project [Name]"
      - Right: relative timestamp (e.g., "2h ago")
    - Compact design, single line per entry (expandable for details)

    **Create components/activity/activity-feed.tsx:**
    - Client component ('use client')
    - Props: projectId, initialActivities (first page from server)
    - Uses react-infinite-scroll-component (following 02-RESEARCH.md pattern)
    - State: activities array, hasMore boolean, offset counter
    - loadMore function: GET /projects/:projectId/activity?offset=N&limit=20
    - Append new activities to array
    - hasMore = false when API returns < 20 items
    - Loading indicator at bottom during fetch
    - End message: "You've reached the beginning of this project's history"
    - Empty state: "No activity yet. Start by creating tasks!"

    **Create activity/page.tsx:**
    - Server Component
    - Fetch initial activities: GET /projects/:projectId/activity?offset=0&limit=20
    - Page title: "Activity" with project name context
    - Render ActivityFeed with initialActivities
    - Breadcrumb: Team > Project > Activity
    - Back link to project page

    **Also add activity link to project page sidebar/header** (from Plan 06's project detail page):
    - Add "Activity" tab or navigation link on the project detail page
  </action>
  <verify>
    1. /teams/[teamId]/projects/[projectId]/activity shows activity timeline
    2. Scroll down loads more activities (infinite scroll)
    3. Activities show actor, action, timestamp
    4. Human-readable descriptions for all event types
    5. Empty state renders correctly
    6. End-of-list message appears when all loaded
  </verify>
  <done>Project activity feed with infinite scroll pagination. All audit events rendered as human-readable timeline entries. Loads 20 at a time.</done>
</task>

<task type="auto">
  <name>Task 2: Create admin-only searchable audit log</name>
  <files>
    apps/web/app/(dashboard)/teams/[teamId]/audit-log/page.tsx
    apps/web/components/activity/audit-log-table.tsx
  </files>
  <action>
    **Create components/activity/audit-log-table.tsx:**
    - Client component
    - Props: teamId, initialEntries, totalCount
    - Table layout with columns: Timestamp, Actor, Action, Entity, Outcome, Details
    - Search input: filter by action or entity (calls API with search param)
    - Filters:
      - Entity type dropdown: All, User, Task, Project, Comment, Organization, Membership
      - Outcome dropdown: All, SUCCESS, DENIED, FAILURE
      - Date range: from/to date pickers
    - Pagination: offset-based with page size 25, prev/next buttons, "Page X of Y"
    - Row expansion: click row to see full details (changes JSON, metadata JSON)
    - Expandable details show:
      - Changes: "status: TODO → IN_PROGRESS" (parsed from JSON)
      - Metadata: IP address, user agent, request ID

    **Create audit-log/page.tsx:**
    - Server Component
    - Check user role from session — if not ADMIN, redirect to team page or show "Access Denied" message
    - Fetch initial data: GET /teams/:teamId/audit-log?offset=0&limit=25
    - Page title: "Audit Log" with team name context
    - Render AuditLogTable with initial data
    - Breadcrumb: Team > Audit Log
    - Admin-only badge/indicator

    **Add audit log link to team sidebar/navigation:**
    - In the sidebar or team settings, add "Audit Log" link (visible only to admin users)
    - Use lock icon to indicate admin-only
  </action>
  <verify>
    1. /teams/[teamId]/audit-log shows audit log table (admin only)
    2. Non-admin users see access denied or redirect
    3. Search filters audit entries by action/entity
    4. Entity type and outcome filters work
    5. Pagination with prev/next works
    6. Row expansion shows change details and metadata
    7. Date range filter narrows results
    8. Admin-only link visible in sidebar
  </verify>
  <done>Admin-only audit log with searchable, filterable table. Row expansion shows full change details and request metadata. Paginated with 25 entries per page. Admin role enforced.</done>
</task>

</tasks>

<verification>
1. Activity feed shows project-scoped events with infinite scroll
2. Audit log shows organization-wide events with search and filters
3. Audit log restricted to admin users
4. All event types render with human-readable descriptions
5. Pagination works in both views
6. Navigation links added to project and team pages
</verification>

<success_criteria>
- AUDIT-05: User can view activity feed for a project
- AUDIT-06: Admin can view searchable audit log
- Activity entries show who did what and when
- Audit log supports search, filter by entity type, filter by outcome, date range
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-work-management/02-10-SUMMARY.md`
</output>
