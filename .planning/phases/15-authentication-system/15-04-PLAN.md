---
phase: 15-authentication-system
plan: 04
type: execute
wave: 2
depends_on:
  - 15-02
files_modified:
  - apps/devcollab-web/app/page.tsx
  - apps/devcollab-web/app/(auth)/login/page.tsx
  - apps/devcollab-web/app/(auth)/logout/route.ts
autonomous: true
requirements:
  - AUTH-02
  - AUTH-03
  - AUTH-04

must_haves:
  truths:
    - "devcollab-web root (/) shows a login form with email and password fields"
    - "Submitting valid credentials sets the httpOnly cookie and redirects to /dashboard placeholder"
    - "A logout action calls POST /auth/logout and redirects to /"
    - "The cookie persists across browser refresh (httpOnly cookie is not cleared on page navigation)"
    - "fetch calls use credentials: 'include' — required for cross-origin cookie exchange"
  artifacts:
    - path: "apps/devcollab-web/app/page.tsx"
      provides: "Root page redirecting or showing login"
      contains: "login"
    - path: "apps/devcollab-web/app/(auth)/login/page.tsx"
      provides: "Login form client component"
      contains: "credentials: 'include'"
    - path: "apps/devcollab-web/app/(auth)/logout/route.ts"
      provides: "Next.js Route Handler calling API logout and redirecting"
      contains: "logout"
  key_links:
    - from: "apps/devcollab-web/app/(auth)/login/page.tsx"
      to: "http://localhost:3003/auth/login"
      via: "fetch POST with credentials: 'include'"
      pattern: "credentials.*include"
    - from: "apps/devcollab-web/app/(auth)/logout/route.ts"
      to: "http://localhost:3003/auth/logout"
      via: "fetch POST then redirect"
      pattern: "auth/logout"
---

<objective>
Replace the devcollab-web login placeholder with a working login form and add a logout route handler. The frontend communicates with devcollab-api using httpOnly cookies and the `credentials: 'include'` fetch flag.

Purpose: Satisfies the browser-side session persistence requirements (AUTH-02, AUTH-03, AUTH-04). Runs in parallel with Plan 03 (API auth feature) — the UI can be built without the API being complete since they communicate only via fetch. Depends on Plan 02 for the API patterns but has no compile-time dependency on Plan 03.
Output: A Next.js app where users can log in and log out with sessions persisting via the devcollab_token httpOnly cookie.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-authentication-system/15-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build login page with form submission and session cookie flow</name>
  <files>
    apps/devcollab-web/app/page.tsx
    apps/devcollab-web/app/(auth)/login/page.tsx
  </files>
  <action>
    The current `apps/devcollab-web/app/page.tsx` is a placeholder. Phase 14 deliberately deferred auth UI to this phase.

    **File 1: `apps/devcollab-web/app/page.tsx`** — Replace entirely with a redirect to /login:
    ```tsx
    import { redirect } from 'next/navigation';

    export default function RootPage() {
      redirect('/login');
    }
    ```

    This is a Server Component redirect — no client JS needed. Users hitting / go directly to /login.

    **File 2: `apps/devcollab-web/app/(auth)/login/page.tsx`** — Create with directory:

    First create the directory `apps/devcollab-web/app/(auth)/login/` (the `(auth)` route group avoids adding "auth" to the URL — `/login` not `/auth/login`).

    ```tsx
    'use client';
    import { useState } from 'react';
    import { useRouter } from 'next/navigation';

    const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3003';

    export default function LoginPage() {
      const router = useRouter();
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [error, setError] = useState<string | null>(null);
      const [loading, setLoading] = useState(false);

      async function handleSubmit(e: React.FormEvent) {
        e.preventDefault();
        setLoading(true);
        setError(null);

        try {
          const res = await fetch(`${API_URL}/auth/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password }),
            credentials: 'include', // REQUIRED: tells browser to accept Set-Cookie on cross-origin response
          });

          if (res.ok) {
            router.push('/dashboard');
          } else {
            const data = await res.json().catch(() => ({}));
            setError((data as { message?: string }).message || 'Login failed. Check your credentials.');
          }
        } catch {
          setError('Unable to connect to server. Please try again.');
        } finally {
          setLoading(false);
        }
      }

      return (
        <main style={{ padding: '2rem', fontFamily: 'system-ui, sans-serif', maxWidth: '400px', margin: '4rem auto' }}>
          <h1 style={{ marginBottom: '1.5rem' }}>DevCollab</h1>
          <h2 style={{ marginBottom: '1rem', fontWeight: 'normal' }}>Sign in to your account</h2>
          <form onSubmit={handleSubmit}>
            <div style={{ marginBottom: '1rem' }}>
              <label style={{ display: 'block', marginBottom: '0.25rem' }}>
                Email
              </label>
              <input
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                required
                autoComplete="email"
                style={{ width: '100%', padding: '0.5rem', boxSizing: 'border-box' }}
              />
            </div>
            <div style={{ marginBottom: '1rem' }}>
              <label style={{ display: 'block', marginBottom: '0.25rem' }}>
                Password
              </label>
              <input
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                required
                autoComplete="current-password"
                style={{ width: '100%', padding: '0.5rem', boxSizing: 'border-box' }}
              />
            </div>
            {error && (
              <p style={{ color: 'red', marginBottom: '1rem' }}>{error}</p>
            )}
            <button
              type="submit"
              disabled={loading}
              style={{ width: '100%', padding: '0.625rem', cursor: loading ? 'wait' : 'pointer' }}
            >
              {loading ? 'Signing in...' : 'Sign in'}
            </button>
          </form>
          <p style={{ marginTop: '1rem', textAlign: 'center' }}>
            No account? <a href="/signup">Sign up</a>
          </p>
        </main>
      );
    }
    ```

    Note: No purple color used anywhere. Inline styles kept minimal — Shadcn design system integration is deferred to Phase 17+ when the design system is extended to devcollab-web.

    Also create a minimal `/dashboard` placeholder so the post-login redirect doesn't 404:

    **File 3 (bonus): `apps/devcollab-web/app/dashboard/page.tsx`**:
    ```tsx
    export default function DashboardPage() {
      return (
        <main style={{ padding: '2rem', fontFamily: 'system-ui, sans-serif' }}>
          <h1>Dashboard</h1>
          <p>You are logged in. Workspace features coming in Phase 16.</p>
          <a href="/api/logout">Log out</a>
        </main>
      );
    }
    ```

    Note: The logout link points to `/api/logout` — a Next.js Route Handler created in Task 2 that clears the cookie and redirects to /login.
  </action>
  <verify>
    1. `ls apps/devcollab-web/app/` shows page.tsx (root redirect), and `(auth)/login/page.tsx`.
    2. `grep "redirect.*login" apps/devcollab-web/app/page.tsx` — confirms root redirect.
    3. `grep "credentials.*include" apps/devcollab-web/app/(auth)/login/page.tsx` — confirms cookie flag.
    4. `grep "NEXT_PUBLIC_API_URL" apps/devcollab-web/app/(auth)/login/page.tsx` — confirms env var usage.
    5. `grep "purple" apps/devcollab-web/app/(auth)/login/page.tsx` — returns nothing (no purple).
  </verify>
  <done>Root page redirects to /login; login form posts to API with credentials: 'include'; success redirects to /dashboard; /dashboard placeholder exists; no purple styling used.</done>
</task>

<task type="auto">
  <name>Task 2: Create logout Route Handler and signup page</name>
  <files>
    apps/devcollab-web/app/api/logout/route.ts
    apps/devcollab-web/app/(auth)/signup/page.tsx
  </files>
  <action>
    **File 1: `apps/devcollab-web/app/api/logout/route.ts`** — Next.js Route Handler for logout:
    ```typescript
    import { NextRequest, NextResponse } from 'next/server';

    const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3003';

    export async function GET(_req: NextRequest): Promise<NextResponse> {
      // Call devcollab-api logout to clear the httpOnly cookie on the API side
      try {
        await fetch(`${API_URL}/auth/logout`, {
          method: 'POST',
          credentials: 'include',
        });
      } catch {
        // Even if API call fails, clear local cookie and redirect
      }

      // Redirect to login page after logout
      const response = NextResponse.redirect(new URL('/login', _req.url));

      // Also clear the cookie from the Next.js side as a safety measure
      // (the API response already cleared it via Set-Cookie: devcollab_token=; Max-Age=0)
      response.cookies.delete('devcollab_token');

      return response;
    }
    ```

    Note: This is a GET handler so `<a href="/api/logout">` works without JavaScript. In production, this should be a POST with a form submit, but GET is sufficient for this phase.

    **File 2: `apps/devcollab-web/app/(auth)/signup/page.tsx`** — Signup form:
    ```tsx
    'use client';
    import { useState } from 'react';
    import { useRouter } from 'next/navigation';

    const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3003';

    export default function SignupPage() {
      const router = useRouter();
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [name, setName] = useState('');
      const [error, setError] = useState<string | null>(null);
      const [loading, setLoading] = useState(false);

      async function handleSubmit(e: React.FormEvent) {
        e.preventDefault();
        setLoading(true);
        setError(null);

        try {
          const res = await fetch(`${API_URL}/auth/signup`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password, name: name || undefined }),
            credentials: 'include', // REQUIRED: accepts Set-Cookie on cross-origin response
          });

          if (res.ok) {
            router.push('/dashboard');
          } else {
            const data = await res.json().catch(() => ({}));
            setError((data as { message?: string }).message || 'Signup failed. Please try again.');
          }
        } catch {
          setError('Unable to connect to server. Please try again.');
        } finally {
          setLoading(false);
        }
      }

      return (
        <main style={{ padding: '2rem', fontFamily: 'system-ui, sans-serif', maxWidth: '400px', margin: '4rem auto' }}>
          <h1 style={{ marginBottom: '1.5rem' }}>DevCollab</h1>
          <h2 style={{ marginBottom: '1rem', fontWeight: 'normal' }}>Create your account</h2>
          <form onSubmit={handleSubmit}>
            <div style={{ marginBottom: '1rem' }}>
              <label style={{ display: 'block', marginBottom: '0.25rem' }}>
                Name (optional)
              </label>
              <input
                type="text"
                value={name}
                onChange={(e) => setName(e.target.value)}
                autoComplete="name"
                style={{ width: '100%', padding: '0.5rem', boxSizing: 'border-box' }}
              />
            </div>
            <div style={{ marginBottom: '1rem' }}>
              <label style={{ display: 'block', marginBottom: '0.25rem' }}>
                Email
              </label>
              <input
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                required
                autoComplete="email"
                style={{ width: '100%', padding: '0.5rem', boxSizing: 'border-box' }}
              />
            </div>
            <div style={{ marginBottom: '1rem' }}>
              <label style={{ display: 'block', marginBottom: '0.25rem' }}>
                Password
              </label>
              <input
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                required
                autoComplete="new-password"
                style={{ width: '100%', padding: '0.5rem', boxSizing: 'border-box' }}
              />
            </div>
            {error && (
              <p style={{ color: 'red', marginBottom: '1rem' }}>{error}</p>
            )}
            <button
              type="submit"
              disabled={loading}
              style={{ width: '100%', padding: '0.625rem', cursor: loading ? 'wait' : 'pointer' }}
            >
              {loading ? 'Creating account...' : 'Create account'}
            </button>
          </form>
          <p style={{ marginTop: '1rem', textAlign: 'center' }}>
            Already have an account? <a href="/login">Sign in</a>
          </p>
        </main>
      );
    }
    ```
  </action>
  <verify>
    1. `ls apps/devcollab-web/app/api/logout/` shows route.ts.
    2. `grep "credentials.*include" apps/devcollab-web/app/(auth)/signup/page.tsx` — confirms cookie flag on signup too.
    3. `grep "NextResponse.redirect" apps/devcollab-web/app/api/logout/route.ts` — confirms redirect to /login.
    4. `grep "cookies.delete" apps/devcollab-web/app/api/logout/route.ts` — confirms cookie cleanup.
    5. `grep "purple" apps/devcollab-web/app/api/logout/route.ts apps/devcollab-web/app/(auth)/signup/page.tsx` — no purple.
  </verify>
  <done>Logout route handler clears cookie and redirects to /login; signup page with credentials: 'include' fetch; no purple styling in any new file.</done>
</task>

</tasks>

<verification>
After both tasks, manually verify the complete auth flow:
1. `ls apps/devcollab-web/app/` confirms page.tsx (root redirect), `(auth)/login/`, `(auth)/signup/`, `api/logout/`, `dashboard/`
2. `grep "credentials.*include" apps/devcollab-web/app/(auth)/login/page.tsx apps/devcollab-web/app/(auth)/signup/page.tsx` — both confirm fetch cookie flag
3. `grep -r "purple" apps/devcollab-web/app/(auth)/ apps/devcollab-web/app/api/` — no results
4. Next.js type check: `cd apps/devcollab-web && npx tsc --noEmit` — no TypeScript errors (or `turbo build --filter=devcollab-web`)
</verification>

<success_criteria>
- `apps/devcollab-web/app/page.tsx` redirects to /login
- `apps/devcollab-web/app/(auth)/login/page.tsx` is a client component with email+password form using credentials: 'include'
- `apps/devcollab-web/app/(auth)/signup/page.tsx` is a client component with name+email+password form using credentials: 'include'
- `apps/devcollab-web/app/api/logout/route.ts` calls API logout and redirects to /login
- `apps/devcollab-web/app/dashboard/page.tsx` placeholder exists for post-login redirect
- No purple color anywhere in new files
</success_criteria>

<output>
After completion, create `.planning/phases/15-authentication-system/15-04-SUMMARY.md`
</output>
