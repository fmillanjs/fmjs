---
phase: 30-gsap-scrolltrigger-parallax
plan: 02
type: execute
wave: 2
depends_on: [30-01]
files_modified:
  - apps/web/components/portfolio/parallax-divider.tsx
  - apps/web/app/(portfolio)/page.tsx
  - apps/web/app/(portfolio)/about/page.tsx
  - apps/web/app/(portfolio)/projects/page.tsx
  - apps/web/app/(portfolio)/contact/page.tsx
autonomous: false
requirements: [PRLLX-02, PRLLX-03]

must_haves:
  truths:
    - "User scrolling past section dividers on the homepage sees decorative lines scale subtly (scaleX 0.92 → 1.04) — independent depth from surrounding content"
    - "Lighthouse CI performance score is >= 0.90 on all five portfolio URLs with parallax active"
    - "Lighthouse CLS metric is 0 on all five URLs — no pin: true spacers, no layout-affecting properties"
    - "User navigating away and returning to parallaxed pages sees divider animations fire correctly — no stale instances"
  artifacts:
    - path: "apps/web/components/portfolio/parallax-divider.tsx"
      provides: "ParallaxDivider 'use client' component with useGSAP + ScrollTrigger scaleX animation"
      contains: "useGSAP"
    - path: "apps/web/app/(portfolio)/page.tsx"
      provides: "Homepage with ParallaxDivider between hero and featured projects sections"
      contains: "ParallaxDivider"
  key_links:
    - from: "apps/web/components/portfolio/parallax-divider.tsx"
      to: "ScrollTrigger"
      via: "useGSAP callback with gsap.fromTo + scrollTrigger scaleX"
      pattern: "scaleX"
    - from: "apps/web/app/(portfolio)/page.tsx"
      to: "apps/web/components/portfolio/parallax-divider.tsx"
      via: "import and JSX render between sections"
      pattern: "ParallaxDivider"
---

<objective>
Create the ParallaxDivider client component using useGSAP + ScrollTrigger with a subtle scaleX 0.92 → 1.04 animation, insert it between major sections on the homepage (and other portfolio pages as appropriate), then run Lighthouse CI to verify performance >= 0.90 and CLS = 0 on all five portfolio URLs.

Purpose: PRLLX-02 requires section separators to move at an independent depth from surrounding content. PRLLX-03 requires Lighthouse CI to pass with the parallax effects active — proving no CLS regression from transform-only animations.

Output: New parallax-divider.tsx component; updated portfolio page files with divider inserts; Lighthouse CI passing >= 0.90 on /, /projects, /projects/teamflow, /projects/devcollab, /contact.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-gsap-scrolltrigger-parallax/30-RESEARCH.md
@.planning/phases/30-gsap-scrolltrigger-parallax/30-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ParallaxDivider component and insert into portfolio pages</name>
  <files>
    apps/web/components/portfolio/parallax-divider.tsx
    apps/web/app/(portfolio)/page.tsx
    apps/web/app/(portfolio)/about/page.tsx
    apps/web/app/(portfolio)/projects/page.tsx
    apps/web/app/(portfolio)/contact/page.tsx
  </files>
  <action>
**Step A — Create `apps/web/components/portfolio/parallax-divider.tsx`:**

```typescript
'use client'

import { useRef } from 'react'
import gsap from 'gsap'
import { ScrollTrigger } from 'gsap/ScrollTrigger'
import { useGSAP } from '@gsap/react'

gsap.registerPlugin(ScrollTrigger)

interface ParallaxDividerProps {
  className?: string
}

export function ParallaxDivider({ className }: ParallaxDividerProps) {
  const containerRef = useRef<HTMLDivElement>(null)
  const lineRef = useRef<HTMLDivElement>(null)

  useGSAP(() => {
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches
    if (prefersReducedMotion || !lineRef.current || !containerRef.current) return

    gsap.fromTo(
      lineRef.current,
      { scaleX: 0.92 },
      {
        scaleX: 1.04,
        ease: 'none',
        scrollTrigger: {
          trigger: containerRef.current,
          start: 'top 80%',
          end: 'bottom 20%',
          scrub: 1,
          invalidateOnRefresh: true,
        },
      }
    )
  }, { scope: containerRef })
  // useGSAP auto-reverts context (kills tween + ScrollTrigger) on unmount

  return (
    <div ref={containerRef} className={`py-8 overflow-hidden ${className ?? ''}`}>
      <div
        ref={lineRef}
        className="h-px bg-primary/30 w-full origin-center"
        // transform-origin: center — scaleX expands equally left+right, no horizontal shift
        // scaleX does not affect layout — CLS = 0
      />
    </div>
  )
}
```

**Step B — Insert ParallaxDivider into homepage (`apps/web/app/(portfolio)/page.tsx`):**

Add `import { ParallaxDivider } from '@/components/portfolio/parallax-divider'` at the top.

Insert `<ParallaxDivider />` between the HeroSection and the Featured Projects section (between `<HeroSection />` and `{/* Featured Project Section */}`). Also insert a second `<ParallaxDivider />` between the Featured Projects section and the Stats section (between the two `<section>` tags).

**Step C — Inspect other portfolio pages for section boundaries:**

Check `apps/web/app/(portfolio)/about/page.tsx`, `apps/web/app/(portfolio)/projects/page.tsx`, and `apps/web/app/(portfolio)/contact/page.tsx`. For each page that has two or more distinct `<section>` blocks, insert `<ParallaxDivider />` between the major sections. If a page has only one section or already has a visual separator, skip it. Do not force a divider where it would look wrong.

The divider uses `bg-primary/30` (Matrix green at 30% opacity within `.matrix-theme`) — no blue Radix tokens, consistent with the Matrix aesthetic.

CRITICAL constraints:
- Do NOT use `pin: true` anywhere
- Do NOT animate `top`, `margin`, `padding`, `height`, or any layout property
- Do NOT use `scrollerProxy` (deprecated)
- scaleX + transform-origin: center is the only allowed animation property for dividers
  </action>
  <verify>
`grep -rn "ParallaxDivider" apps/web/app/(portfolio)/page.tsx` — must appear at least twice (import + two renders). `grep -n "pin:" apps/web/components/portfolio/parallax-divider.tsx` — must NOT appear (only in comments). Run `npx tsc --noEmit` — zero TypeScript errors. Start dev server and visit http://localhost:3000 — divider lines visible between hero and featured projects; scrolling slowly shows the line expanding/contracting subtly.
  </verify>
  <done>
parallax-divider.tsx exists with useGSAP, scaleX 0.92→1.04, scrub: 1, prefers-reduced-motion guard, cleanup via useGSAP context auto-revert. ParallaxDivider inserted between major sections on homepage. TypeScript build clean.
  </done>
</task>

<task type="auto">
  <name>Task 2: Lighthouse CI gate — all 5 URLs >= 0.90 performance, CLS = 0</name>
  <files></files>
  <action>
Run Lighthouse CI against all five portfolio URLs with parallax active. This verifies PRLLX-03: performance >= 0.90 and CLS = 0.

Use the same LHCI setup established in Phase 29 (CHROME_PATH set for WSL2):

```bash
export CHROME_PATH=~/.cache/puppeteer/chrome/linux-141.0.7390.122/chrome-linux64/chrome
cd apps/web && npx next build && npx next start &
sleep 5
npx lhci autorun --config=.lighthouserc.json
```

URLs to test (from .lighthouserc.json already configured in Phase 29):
- http://localhost:3000/
- http://localhost:3000/projects
- http://localhost:3000/projects/teamflow
- http://localhost:3000/projects/devcollab
- http://localhost:3000/contact

Expected results:
- Performance score >= 0.90 on all 5 URLs
- CLS = 0 on all 5 URLs (confirm from the raw LHR output or .lighthouseci/ HTML reports)

If any URL scores < 0.90: inspect the LHR report to find the failing audit. Common causes with parallax:
  1. TBT spike — check if useGSAP is running heavy computation on main thread. If found, verify `scrub: 1` is set (it defers to RAF) and no synchronous layout thrashing.
  2. LCP regression — if hero text is the LCP element and it's now animated, check if the animation starts before LCP is reported. The `yPercent` animation starts at scroll position 0 (start: 'top top') so the text is at native position on load — LCP should not be affected.
  3. CLS > 0 — means a layout-affecting property was animated OR `pin: true` was accidentally used. Run `grep -rn "pin: true" apps/web/components/portfolio/` to confirm absence.

If performance passes but CLS > 0: search for `pin: true` and any layout properties in GSAP animations. Remove or replace with transform-only properties.

Kill the Next.js dev/start server after the run to free port 3000.
  </action>
  <verify>
LHCI output shows all 5 URLs with assertionResults passing. Specifically: performance/score >= 0.90 for every URL. Check the .lighthouseci/ HTML reports for CLS metric — must be 0.00 on all runs. If LHCI prints "All assertions passed!" — gate is clear.
  </verify>
  <done>
Lighthouse CI reports performance >= 0.90 and CLS = 0 for all five URLs: /, /projects, /projects/teamflow, /projects/devcollab, /contact. All LHCI assertions passed. Phase 30 complete.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Human visual verification — parallax depth effects and Lighthouse CI gate</name>
  <files></files>
  <action>Human verifies the visual quality of hero parallax (PRLLX-01), section divider depth effect (PRLLX-02), and reviews the Lighthouse CI results logged by Task 2 (PRLLX-03). No Claude automation in this task — this is a visual and interactive check only.</action>
  <what-built>
    ParallaxDivider component with scaleX 0.92→1.04 depth effect inserted between major sections on all portfolio pages. Lighthouse CI gate run showing >= 0.90 performance on all 5 URLs with CLS = 0.
  </what-built>
  <how-to-verify>
    1. Start dev server: `cd apps/web && npx next dev`
    2. Visit http://localhost:3000/ — scroll slowly past the hero: the hero text should drift upward noticeably slower than the page content below it (yPercent: -15, scrub: 1 lag)
    3. Continue scrolling — the decorative line between hero and "Featured Projects" should subtly expand (scaleX effect); a second line appears between Featured Projects and Stats
    4. Visit http://localhost:3000/about, /projects, /contact — confirm any inserted ParallaxDividers are visible and animate on scroll
    5. Open browser devtools Console — confirm zero JavaScript errors
    6. Set OS prefers-reduced-motion to ON (macOS: System Settings > Accessibility > Display > Reduce Motion; Windows: Ease of Access > Display > Show animations = Off) — reload the page — hero text must NOT drift (static position), divider lines must NOT animate (static). Then reset to OFF.
    7. Navigate: click Projects, then Back, then Home — confirm hero parallax re-fires correctly on return (no frozen position at the end state)
    8. Confirm Lighthouse CI log (from Task 2 output) shows all 5 URLs >= 0.90 performance and CLS = 0
  </how-to-verify>
  <verify>Human confirms all 8 check steps above pass</verify>
  <done>User types "approved" — all parallax effects are visually correct, reduced-motion gate works, navigation re-fires correctly, Lighthouse CI shows >= 0.90 performance and CLS = 0</done>
  <resume-signal>Type "approved" if all checks pass, or describe any issues seen (e.g., "hero text not moving", "CLS regression on /projects", "JS error in console")</resume-signal>
</task>

</tasks>

<verification>
1. `grep -n "ParallaxDivider" apps/web/app/(portfolio)/page.tsx` — import + at least 2 renders
2. `grep -rn "pin: true" apps/web/components/portfolio/` — must return nothing (no pin: true anywhere)
3. `npx tsc --noEmit` — zero TypeScript errors
4. LHCI output: "All assertions passed!" for all 5 URLs at >= 0.90 performance
5. CLS = 0.00 in Lighthouse reports for all 5 URLs
6. Human verification: hero parallax visible + divider depth effect + reduced-motion gate + no stale instances on navigation
</verification>

<success_criteria>
- parallax-divider.tsx exists with useGSAP, scaleX 0.92→1.04, scrub: 1, invalidateOnRefresh: true, prefers-reduced-motion guard, overflow-hidden container, origin-center on line
- ParallaxDivider rendered between major sections on homepage (at minimum: between hero and featured projects, between featured projects and stats)
- Lighthouse CI: all 5 portfolio URLs score >= 0.90 performance with CLS = 0
- Human approves visual scroll behavior and reduced-motion gate
- PRLLX-01, PRLLX-02, PRLLX-03 all complete — Phase 30 done
</success_criteria>

<output>
After completion, create `.planning/phases/30-gsap-scrolltrigger-parallax/30-02-SUMMARY.md`
</output>
