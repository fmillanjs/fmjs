---
phase: 13-automation-optimization
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/components/tasks/task-detail-panel.tsx
  - apps/web/components/tasks/task-views.tsx
  - apps/web/components/tasks/kanban-board.tsx
  - apps/web/eslint.config.mjs
  - apps/web/next.config.ts
  - apps/web/package.json
autonomous: true
requirements:
  - COMP-05

must_haves:
  truths:
    - "No file in components/tasks/, components/teams/, components/projects/, components/portfolio/, components/auth/, components/layout/, or components/activity/ imports ConflictWarning, EmptyState, or old Skeleton"
    - "ESLint no-restricted-imports catches deprecated imports in any new file immediately (build fails)"
    - "Bundle size baseline is documented with client chunk sizes from ANALYZE=true build"
  artifacts:
    - path: "apps/web/eslint.config.mjs"
      provides: "Hardened ESLint governance with exemptions removed for fully-migrated directories"
      min_lines: 50
    - path: "apps/web/next.config.ts"
      provides: "Bundle analyzer wrapper active on ANALYZE=true"
      contains: "withBundleAnalyzer"
    - path: "apps/web/components/tasks/task-detail-panel.tsx"
      provides: "ConflictWarning replaced with Shadcn Dialog/Alert pattern"
    - path: "apps/web/components/tasks/task-views.tsx"
      provides: "EmptyState replaced with Card + description pattern"
    - path: "apps/web/components/tasks/kanban-board.tsx"
      provides: "ConflictWarning replaced with Shadcn Dialog/Alert pattern"
  key_links:
    - from: "apps/web/eslint.config.mjs"
      to: "components/tasks/**"
      via: "no-restricted-imports enforcement (exemption removed)"
      pattern: "components/tasks"
    - from: "apps/web/next.config.ts"
      to: "@next/bundle-analyzer"
      via: "import withBundleAnalyzer from '@next/bundle-analyzer'"
      pattern: "withBundleAnalyzer"
---

<objective>
Replace the 3 remaining deprecated component usages in `components/tasks/`, narrow the ESLint `ignores` list to enforce governance on all fully-migrated directories, install `@next/bundle-analyzer`, and measure the bundle baseline.

Purpose: COMP-05 requires component governance via ESLint. Phase 9 created the rules but exempted all Phase 10-12 migration targets. Phase 12 is complete — those exemptions must be removed so the governance actually enforces. Three files (`task-detail-panel.tsx`, `task-views.tsx`, `kanban-board.tsx`) still import deprecated components and must be updated before removing exemptions.
Output: Clean ESLint (zero violations after `next lint`), `@next/bundle-analyzer` integrated, bundle baseline documented in plan summary.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-automation-optimization/13-RESEARCH.md
@apps/web/eslint.config.mjs
@apps/web/next.config.ts
@apps/web/components/tasks/task-detail-panel.tsx
@apps/web/components/tasks/task-views.tsx
@apps/web/components/tasks/kanban-board.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace deprecated component usages in tasks/ and harden ESLint governance</name>
  <files>
    apps/web/components/tasks/task-detail-panel.tsx
    apps/web/components/tasks/task-views.tsx
    apps/web/components/tasks/kanban-board.tsx
    apps/web/eslint.config.mjs
  </files>
  <action>
**Step 1: Fix the 3 files with remaining deprecated imports**

Read each file fully before editing. Use the established Shadcn patterns from Phase 12.

**`components/tasks/kanban-board.tsx`** — Replace `ConflictWarning` with inline alert markup:
- Remove: `import { ConflictWarning } from '../ui/conflict-warning'`
- Replace the `<ConflictWarning .../>` usage with the equivalent Shadcn-native pattern using existing imports (Alert from `@/components/ui/alert` if available, or inline amber-colored div using Radix CSS variables). Check what's already imported in the file. The ConflictWarning from `components/ui/conflict-warning.tsx` shows a dismissible amber banner — replicate using Tailwind classes: `bg-[var(--amber-3)] border border-[var(--amber-6)] text-[var(--amber-12)] rounded-md p-3 flex items-start gap-2` with the same props (message, onResolve). Keep existing props interface — only remove the import and inline the UI.
- If the existing ConflictWarning component accepts `{ message: string, onDismiss: () => void }` props (verify by reading the file), keep the same logic but render it inline.

**`components/tasks/task-detail-panel.tsx`** — Same ConflictWarning fix:
- Remove: `import { ConflictWarning } from '../ui/conflict-warning'`
- Apply the same inline amber banner pattern. Read the exact props used in the JSX (`<ConflictWarning ...>`) before writing the replacement.

**`components/tasks/task-views.tsx`** — Replace `EmptyState`:
- Remove: `import { EmptyState } from '@/components/ui/empty-state'`
- Replace `<EmptyState .../>` usage with a Card + description pattern using Shadcn Card. Look at how EmptyState is used (what props: `icon`, `title`, `description`, `action`?) and replace with:
  ```tsx
  <Card className="flex flex-col items-center justify-center py-12 text-center">
    <CardContent>
      {/* icon if applicable */}
      <p className="text-lg font-medium text-foreground">{title}</p>
      <p className="text-sm text-muted-foreground mt-1">{description}</p>
      {/* action button if applicable */}
    </CardContent>
  </Card>
  ```
- Ensure `Card`, `CardContent` are already imported (they should be from Phase 12 migration). If not, add `import { Card, CardContent } from '@/components/ui/card'`.

After each file edit, verify the deprecated import is gone:
```bash
grep -n "empty-state\|conflict-warning\|ConflictWarning\|EmptyState" apps/web/components/tasks/task-detail-panel.tsx apps/web/components/tasks/task-views.tsx apps/web/components/tasks/kanban-board.tsx
```
Expected: no output.

**Step 2: Harden ESLint governance in `eslint.config.mjs`**

Read the current `eslint.config.mjs`. The `ignores` array currently contains paths that Phase 10-12 have fully migrated. Remove exemptions for ALL directories that are now clean of deprecated imports.

Remove from `ignores` (fully migrated, no deprecated imports remaining):
- `'components/tasks/**'`
- `'components/projects/**'`
- `'components/project/**'`
- `'components/portfolio/**'`
- `'components/activity/**'`
- `'components/auth/**'`
- `'components/layout/**'`
- `'components/teams/**'`

Keep in `ignores` (still valid exceptions):
- `'components/ui/skeleton.tsx'` — IS the deprecated component itself
- `'components/ui/theme-toggle.tsx'` — uses legacy patterns, not yet migrated
- `'components/ui/command-palette.tsx'` — uses legacy patterns, not yet migrated
- `'components/ui/empty-state.tsx'` — IS the deprecated component itself
- `'components/ui/conflict-warning.tsx'` — IS the deprecated component itself
- `'components/providers/**'` — session/theme providers, not importing deprecated components
- All Shadcn-installed `components/ui/*.tsx` entries (button, card, input, label, dialog, badge, separator, sonner)

Update the comment header in `eslint.config.mjs` to say:
```
// Phase 13: All Phase 10-12 migration targets (tasks/projects/teams/portfolio/auth/layout)
// have been removed from ignores. ESLint now enforces governance on all feature components.
// Only the deprecated component files themselves remain exempt (they ARE the restricted targets).
```

After editing, verify with:
```bash
cd apps/web && npx next lint 2>&1 | tail -20
```
Expected: `✓ No ESLint warnings or errors` (or similar success message). If lint fails, read the error and fix.
  </action>
  <verify>
1. No deprecated imports remain: `grep -rn "empty-state\|conflict-warning" apps/web/components/tasks/ apps/web/components/teams/ apps/web/components/projects/ apps/web/components/portfolio/ apps/web/components/auth/ apps/web/components/layout/ apps/web/components/activity/ 2>/dev/null | grep -v "\.tsx-snapshots"` — expect no output
2. ESLint passes: `cd apps/web && npx next lint` — exits 0 with no errors
3. Exemptions removed: `grep -c "components/tasks" apps/web/eslint.config.mjs` — expect 0
4. Shadcn UI files still exempt: `grep "components/ui/button" apps/web/eslint.config.mjs` — expect 1 match
  </verify>
  <done>
Zero deprecated imports in any migrated component directory. `next lint` exits 0. `eslint.config.mjs` no longer exempts `components/tasks/**`, `components/projects/**`, `components/teams/**`, `components/portfolio/**`, `components/auth/**`, `components/layout/**`, `components/activity/**`. New files importing deprecated components will fail CI.
  </done>
</task>

<task type="auto">
  <name>Task 2: Install @next/bundle-analyzer and measure bundle baseline</name>
  <files>
    apps/web/package.json
    apps/web/next.config.ts
  </files>
  <action>
**Step 1: Install @next/bundle-analyzer**

Check if Docker container is available (per global instructions):
```bash
docker ps 2>/dev/null | grep -E "web|next" || echo "no web container"
```

Install in `apps/web` (not in Docker — this is a devDependency for build tooling):
```bash
cd apps/web && npm install --save-dev @next/bundle-analyzer
```

**Step 2: Update `next.config.ts` to wrap with bundle analyzer**

Read the current `apps/web/next.config.ts` (it has `output: 'standalone'`, `transpilePackages`, and `webpack` config).

Replace the entire file with the bundle-analyzer-wrapped version. Use `import` syntax (not `require`) since this is a `.ts` file:

```typescript
import type { NextConfig } from 'next';
import withBundleAnalyzer from '@next/bundle-analyzer';

const bundleAnalyzer = withBundleAnalyzer({
  enabled: process.env.ANALYZE === 'true',
});

const nextConfig: NextConfig = {
  output: 'standalone',
  transpilePackages: ['@repo/shared', '@repo/database'],
  webpack: (config, { isServer }) => {
    if (!isServer) {
      config.resolve.fallback = {
        ...config.resolve.fallback,
        fs: false,
        net: false,
        tls: false,
        dns: false,
        child_process: false,
      };
    }
    return config;
  },
};

export default bundleAnalyzer(nextConfig);
```

**Step 3: Measure bundle baseline**

Run the bundle analyzer to capture current bundle sizes:
```bash
cd apps/web && ANALYZE=true npm run build 2>&1 | grep -E "(Route|Size|First Load|chunks|kB|MB)" | head -40
```

If the build produces HTML reports in `.next/analyze/`, note the key sizes from build output. The build output (stdout) contains the route-by-route breakdown which is sufficient for baseline documentation.

Capture and document in the plan SUMMARY:
- Total first-load JS shared chunks size
- Largest page bundle sizes (if >100kB, note them)
- Whether size increased or decreased relative to Phase 11 end (Phase 11 added Shadcn Form/Select; Phase 12 migrated existing components but added no new deps — expect neutral or slight decrease from removing old inline styles)

Note: This measures current state AFTER Phase 12. Document honestly per global instructions — do not claim "decreased" if it hasn't.

**Step 4: Verify build still works normally (without ANALYZE)**
```bash
cd apps/web && npm run build 2>&1 | tail -5
```
Ensure normal `npm run build` still produces a successful build (exit code 0).
  </action>
  <verify>
1. Package installed: `grep "@next/bundle-analyzer" apps/web/package.json`
2. Config updated: `grep "withBundleAnalyzer" apps/web/next.config.ts`
3. Normal build works: `cd apps/web && npm run build 2>&1 | tail -3` — exits 0
4. TypeScript compiles: `grep "import withBundleAnalyzer" apps/web/next.config.ts`
  </verify>
  <done>
`@next/bundle-analyzer` installed in devDependencies, `next.config.ts` wraps config with `bundleAnalyzer({enabled: process.env.ANALYZE === 'true'})`, `ANALYZE=true npm run build` generates reports, normal `npm run build` is unaffected. Bundle baseline sizes documented in plan SUMMARY.
  </done>
</task>

</tasks>

<verification>
1. `grep -rn "empty-state\|conflict-warning" apps/web/components/tasks/` — no output
2. `cd apps/web && npx next lint` — exits 0, no errors
3. `grep "components/tasks" apps/web/eslint.config.mjs` — no match (exemption removed)
4. `grep "withBundleAnalyzer" apps/web/next.config.ts` — present
5. `cd apps/web && npm run build` — exits 0
6. `grep "@next/bundle-analyzer" apps/web/package.json` — present in devDependencies
</verification>

<success_criteria>
- All 3 deprecated component usages in components/tasks/ replaced with Shadcn-native patterns
- ESLint governance fully active on all feature component directories (tasks, teams, projects, portfolio, auth, layout, activity)
- `next lint` passes with zero violations
- @next/bundle-analyzer installed and integrated, normal build unaffected
- Bundle baseline documented in SUMMARY for comparison
</success_criteria>

<output>
After completion, create `.planning/phases/13-automation-optimization/13-02-SUMMARY.md`
Include bundle baseline sizes in the SUMMARY.
</output>
