---
phase: 31-magnetic-buttons
plan: 02
type: execute
wave: 2
depends_on:
  - 31-01
files_modified:
  - apps/web/components/portfolio/hero-section.tsx
  - apps/web/app/(portfolio)/about/page.tsx
autonomous: false
requirements:
  - MAGN-01
  - MAGN-02
  - MAGN-03

must_haves:
  truths:
    - "User hovering 'View Projects' hero CTA sees button attract toward cursor with spring elasticity and snap back on leave"
    - "User hovering 'View GitHub' hero CTA sees identical spring-physics magnetic attraction"
    - "User hovering 'Get In Touch' contact CTA on the about page sees the same magnetic behavior"
    - "User on a touch device tapping any CTA sees a plain button press with no position shift or magnetic artifact"
    - "User with prefers-reduced-motion active sees all three CTAs as plain buttons with no spring motion"
    - "Lighthouse CI performance score remains >= 0.90 on all 5 portfolio URLs after magnetic buttons active"
  artifacts:
    - path: "apps/web/components/portfolio/hero-section.tsx"
      provides: "Hero section with MagneticButton-wrapped CTAs"
      contains: "MagneticButton"
    - path: "apps/web/app/(portfolio)/about/page.tsx"
      provides: "About page with MagneticButton-wrapped Get In Touch CTA"
      contains: "MagneticButton"
  key_links:
    - from: "apps/web/components/portfolio/hero-section.tsx"
      to: "apps/web/components/portfolio/magnetic-button.tsx"
      via: "import { MagneticButton }"
      pattern: "MagneticButton"
    - from: "apps/web/app/(portfolio)/about/page.tsx"
      to: "apps/web/components/portfolio/magnetic-button.tsx"
      via: "import { MagneticButton }"
      pattern: "MagneticButton"
---

<objective>
Wire MagneticButton onto all three CTAs (hero "View Projects", hero "View GitHub", about "Get In Touch"), rename the hero "Learn More" CTA to "View Projects" pointing to /projects, then verify Lighthouse CI performance gate and human-confirm the spring-physics feel.

Purpose: Completes MAGN-01, MAGN-02, MAGN-03. The visual polish of magnetic attraction on the portfolio's primary CTAs is the entire deliverable of Phase 31.
Output: Two modified source files with MagneticButton wrappers. LHCI passing. Human visual verification of spring feel and guards.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/31-magnetic-buttons/31-RESEARCH.md
@.planning/phases/31-magnetic-buttons/31-01-SUMMARY.md
@apps/web/components/portfolio/hero-section.tsx
@apps/web/app/(portfolio)/about/page.tsx
@apps/web/lighthouserc.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire MagneticButton to hero CTAs and about page CTA</name>
  <files>
    apps/web/components/portfolio/hero-section.tsx
    apps/web/app/(portfolio)/about/page.tsx
  </files>
  <action>
**hero-section.tsx** (already `'use client'` — no directive needed):

1. Add import at the top of imports block:
```typescript
import { MagneticButton } from '@/components/portfolio/magnetic-button'
```

2. In the CTA flex container (`<div className="flex flex-col sm:flex-row gap-4 justify-center">`), replace the two existing Button/Link pairs.

Current state:
```tsx
<Button asChild size="lg">
  <Link href="/about">Learn More</Link>
</Button>
<Button asChild variant="outline" size="lg">
  <a href="https://github.com/fmillanjs" target="_blank" rel="noopener noreferrer">
    View GitHub
  </a>
</Button>
```

Replace with (rename "Learn More" → "View Projects", href /about → /projects per MAGN-01 spec):
```tsx
<MagneticButton>
  <Button asChild size="lg">
    <Link href="/projects">View Projects</Link>
  </Button>
</MagneticButton>
<MagneticButton>
  <Button asChild variant="outline" size="lg">
    <a href="https://github.com/fmillanjs" target="_blank" rel="noopener noreferrer">
      View GitHub
    </a>
  </Button>
</MagneticButton>
```

Note: `MagneticButton` needs no className here — the Button component inside provides its own sizing and styling.

**about/page.tsx** (Server Component — do NOT add `'use client'` to the page itself):

1. Add import near the top of the existing import block:
```typescript
import { MagneticButton } from '@/components/portfolio/magnetic-button'
```

2. Locate the existing `<Button asChild size="lg"><Link href="/contact">Get In Touch</Link></Button>` block (around line 125-127) and wrap it:
```tsx
<MagneticButton>
  <Button asChild size="lg">
    <Link href="/contact">Get In Touch</Link>
  </Button>
</MagneticButton>
```

Server Component importing a `'use client'` component is correct Next.js 15 App Router pattern — the MagneticButton creates its own client boundary; no page-level directive change needed.

After both edits, verify TypeScript and build:
```bash
cd /home/doctor/fernandomillan && npx turbo run build --filter=web 2>&1 | tail -30
```
  </action>
  <verify>
```bash
cd /home/doctor/fernandomillan && npx turbo run build --filter=web 2>&1 | grep -E "^.*(error TS|Error:|failed|BUILD FAILED)" | grep -v "node_modules" | head -20
```
Zero build errors. Confirm both files contain MagneticButton:
```bash
grep -n "MagneticButton" /home/doctor/fernandomillan/apps/web/components/portfolio/hero-section.tsx
grep -n "MagneticButton" /home/doctor/fernandomillan/apps/web/app/\(portfolio\)/about/page.tsx
```
  </verify>
  <done>
`hero-section.tsx` imports and wraps both CTAs in MagneticButton ("View Projects" linking /projects, "View GitHub" linking github). `about/page.tsx` imports and wraps "Get In Touch" in MagneticButton. Build compiles clean with zero TypeScript errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Lighthouse CI gate — performance >= 0.90 on all 5 URLs</name>
  <files></files>
  <action>
Run the existing Lighthouse CI workflow to confirm magnetic buttons do not spike TBT or drop performance below 0.90.

The LHCI config is at `apps/web/lighthouserc.json` — asserts `categories:performance >= 0.9` on 5 URLs (/, /projects, /projects/teamflow, /projects/devcollab, /contact).

CHROME_PATH must be set to the puppeteer Linux binary (project decision from Phase 29, STATE.md):
```bash
export CHROME_PATH="$HOME/.cache/puppeteer/chrome/linux-141.0.7390.122/chrome-linux64/chrome"
```

Run sequence:
```bash
cd /home/doctor/fernandomillan/apps/web

# Build standalone output first
npx turbo run build --filter=web

# Run LHCI autorun
CHROME_PATH="$HOME/.cache/puppeteer/chrome/linux-141.0.7390.122/chrome-linux64/chrome" \
  npx lhci autorun --config=lighthouserc.json 2>&1 | tail -60
```

The LHCI run:
- Starts standalone Next.js server on port 3000
- Tests all 5 URLs 3 times each (numberOfRuns: 3)
- Asserts performance >= 0.90 (error-level — fails if not met)
- Asserts accessibility >= 1.0 (warn-level — noted not blocking)

If TBT spikes above threshold: MagneticButton uses `motion/react` useSpring which is RAF-scheduled — it does NOT create per-pixel tweens. A TBT spike would indicate `getBoundingClientRect()` was accidentally moved to `handleMouseMove` (Pitfall 5 from RESEARCH.md). Verify `rectRef` is only set in `handleMouseEnter`.

If performance drops for unrelated reason: Check CLS in LHCI output — the `motion.div` wrapper must not introduce layout shift. The wrapper renders as inline-block and the Button inside retains its own layout position.
  </action>
  <verify>
LHCI output contains:
```
No error assertions failed
```
All 5 URL performance scores are >= 0.90.
  </verify>
  <done>
Lighthouse CI asserts pass on all 5 URLs. Performance >= 0.90. No error-level assertion failures. TBT within acceptable range (motion/react spring is RAF-scheduled, not blocking the main thread).
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Human visual verification — magnetic spring feel, guards, and Lighthouse CI gate</name>
  <files></files>
  <action>Human verifies the spring-physics magnetic attraction on all three CTAs, confirms the reduced-motion guard renders plain buttons, confirms touch guard works, and confirms focus rings are correctly positioned. No Claude automation in this task — visual and interactive checks only.</action>
  <what-built>
MagneticButton spring-physics cursor attraction on three portfolio CTAs:
- Hero "View Projects" (links to /projects)
- Hero "View GitHub" (links to github)
- About page "Get In Touch" (links to /contact)

Lighthouse CI gate confirmed performance >= 0.90 on all 5 URLs with magnetic buttons active.
  </what-built>
  <how-to-verify>
Start the dev server: `cd /home/doctor/fernandomillan && npx turbo run dev --filter=web`

**Check 1 — Hero magnetic attraction:**
1. Open http://localhost:3000 in a browser
2. Slowly move cursor toward the "View Projects" button — Expected: Button visibly attracts toward cursor position (subtle spring pull)
3. Move cursor away — Expected: Button snaps back to center with spring elasticity
4. Repeat for "View GitHub" button — Expected: Same spring-physics attraction and snap-back

**Check 2 — About page magnetic attraction:**
1. Open http://localhost:3000/about
2. Move cursor toward the "Get In Touch" button — Expected: Same magnetic spring pull and snap-back as hero CTAs

**Check 3 — Reduced-motion guard:**
1. Enable prefers-reduced-motion in Chrome DevTools: DevTools → Rendering → Emulate CSS media feature → `prefers-reduced-motion: reduce`
2. Reload http://localhost:3000
3. Move cursor over the CTAs — Expected: No button movement whatsoever, plain static buttons

**Check 4 — Touch device guard (Chrome DevTools):**
1. In Chrome DevTools → Toggle device toolbar (mobile simulation)
2. Tap the "View Projects" CTA — Expected: No position shift or flicker, plain button tap behavior

**Check 5 — Focus ring alignment:**
1. With prefers-reduced-motion OFF (normal mode)
2. Tab to the "View Projects" button using keyboard
3. Expected: Focus ring appears correctly around the button (not offset or displaced from the button's visual position)

**Check 6 — Link destinations correct:**
1. Click "View Projects" — Expected: Navigates to /projects
2. Click "Get In Touch" on /about — Expected: Navigates to /contact
  </how-to-verify>
  <verify>Human confirms all 6 checks above pass — magnetic attraction visible, snap-back elastic, reduced-motion guard works, touch guard no flicker, focus ring correct, links navigate correctly</verify>
  <done>User types "approved" — all magnetic button effects are visually correct, both guards work, focus rings are properly aligned, link destinations are correct</done>
  <resume-signal>Type "approved" if all 6 checks pass. Describe any issue if a check fails (e.g., "no spring movement", "flicker on mobile tap", "focus ring offset").</resume-signal>
</task>

</tasks>

<verification>
1. `grep -n "MagneticButton" apps/web/components/portfolio/hero-section.tsx` — shows import + 2 wrapper uses
2. `grep -n "MagneticButton" apps/web/app/(portfolio)/about/page.tsx` — shows import + 1 wrapper use
3. `grep -n "View Projects" apps/web/components/portfolio/hero-section.tsx` — CTA renamed from "Learn More"
4. LHCI all 5 URLs pass >= 0.90 performance assertion — logged in Task 2 output
5. Human checkpoint approved — all 6 visual/interactive checks confirmed
</verification>

<success_criteria>
All three CTAs have magnetic spring-physics attraction. Lighthouse CI performance gate passes on all 5 URLs. Human visual verification approved for all 6 checks. MAGN-01, MAGN-02, MAGN-03 complete.
</success_criteria>

<output>
After completion, create `.planning/phases/31-magnetic-buttons/31-02-SUMMARY.md`
</output>
