---
phase: 06.1-user-flow-architecture-audit
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/e2e/user-journey/complete-flow.spec.ts
  - apps/web/e2e/user-journey/authentication-boundaries.spec.ts
  - apps/web/e2e/user-journey/navigation-state.spec.ts
autonomous: true

must_haves:
  truths:
    - "User can navigate entire portfolio (home, about, resume, contact, projects) without broken links or auth errors"
    - "User can view project showcase and access TeamFlow project detail page from portfolio"
    - "User can log in from portfolio project page and land in TeamFlow dashboard with proper session"
    - "First-time authenticated user (admin) can create team → project → tasks through complete flow"
    - "User can navigate to project board and interact with Kanban (drag-drop, filters, task details)"
    - "Authentication works seamlessly across portfolio ↔ TeamFlow boundaries"
  artifacts:
    - path: "apps/web/e2e/user-journey/complete-flow.spec.ts"
      provides: "E2E test validating entire user journey from portfolio discovery to task interaction"
      min_lines: 150
    - path: "apps/web/e2e/user-journey/authentication-boundaries.spec.ts"
      provides: "E2E test validating session persistence, redirect flows, and auth state at route boundaries"
      min_lines: 100
    - path: "apps/web/e2e/user-journey/navigation-state.spec.ts"
      provides: "E2E test validating breadcrumbs, back buttons, sidebar state, and navigation consistency"
      min_lines: 80
  key_links:
    - from: "apps/web/e2e/user-journey/complete-flow.spec.ts"
      to: "portfolio pages"
      via: "page.goto() navigation"
      pattern: "page\\.goto\\('/'\\)"
    - from: "apps/web/e2e/user-journey/complete-flow.spec.ts"
      to: "/teams route"
      via: "authenticated session redirect"
      pattern: "expect\\(page\\)\\.toHaveURL\\(/\\/teams/"
    - from: "apps/web/e2e/user-journey/authentication-boundaries.spec.ts"
      to: "middleware auth check"
      via: "protected route access attempt"
      pattern: "page\\.goto\\('/teams'\\)"
---

<objective>
Create comprehensive E2E tests validating the complete user journey from portfolio through TeamFlow dashboard, ensuring navigation consistency, authentication boundaries, and proper session management across the entire application.

Purpose: Validate that all critical user journeys work end-to-end without broken links, auth errors, or navigation inconsistencies before moving to data integrity and edge case audits.

Output: Three E2E test suites providing automated validation of user flows, authentication boundaries, and navigation state preservation.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06.1-user-flow-architecture-audit/06.1-RESEARCH.md

# Existing E2E test patterns
@apps/web/e2e/portfolio/navigation.spec.ts
@apps/web/e2e/authenticated/teams.spec.ts

# Authentication configuration
@apps/web/lib/auth.ts
@apps/web/middleware.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create complete user journey E2E test</name>
  <files>apps/web/e2e/user-journey/complete-flow.spec.ts</files>
  <action>
Create comprehensive E2E test validating the complete user flow: Portfolio discovery → Project showcase → Login → Dashboard → Team creation → Project creation → Task creation → Kanban interaction → Task detail view.

Test steps:
1. Portfolio navigation: Visit /, navigate to /projects, click TeamFlow project
2. Login redirect: Click "View Live Demo" button, verify redirect to /login
3. Authentication: Login with test credentials, verify redirect to /teams
4. Empty state handling: Verify "Create your first team" CTA appears
5. Team creation: Navigate to /teams/new, create team, verify navigation to team page
6. Project creation: Click "New Project", fill form, verify navigation to project page
7. Task creation: Use "Add task" in Kanban TODO column, create task, verify it appears
8. Kanban interaction: Drag task to IN_PROGRESS column, verify optimistic update
9. Task detail: Click task title, verify navigation to task detail page with full description
10. Navigation validation: Verify breadcrumbs, back button, sidebar state throughout

Use semantic selectors (getByRole, getByLabel, getByText) for resilient tests. Follow pattern from existing portfolio/navigation.spec.ts and authenticated/teams.spec.ts. Test should take 60-90 seconds to run.

Account for async params in Next.js 15 (all dynamic routes use Promise params). Verify URL patterns with regex to handle dynamic IDs.
  </action>
  <verify>
Run test suite:
```bash
cd apps/web
npx playwright test e2e/user-journey/complete-flow.spec.ts --project=chromium
```

Should show all assertions passing with clear step-by-step flow through entire user journey.
  </verify>
  <done>
E2E test validates complete user journey from portfolio discovery through task detail view with all navigation steps working correctly. Test passes consistently and provides clear failure messages if any step breaks.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create authentication boundary E2E test</name>
  <files>apps/web/e2e/user-journey/authentication-boundaries.spec.ts</files>
  <action>
Create E2E test validating authentication state at boundaries between public (portfolio) and protected (dashboard) routes, ensuring proper redirects, session persistence, and auth state synchronization.

Test scenarios:
1. Unauthenticated user redirects: Try accessing /teams without auth, verify redirect to /login with callbackUrl
2. Protected route access post-login: Login, access /teams, verify no redirect
3. Session persistence across navigation: Login, navigate to portfolio (/), return to /teams, verify session still valid
4. Logout flow: Login, navigate to dashboard, logout, verify redirect to / and session cleared
5. Direct URL access: Login, copy project URL, logout, access URL, verify redirect to /login with callbackUrl
6. Portfolio accessibility: Verify all portfolio routes (/, /about, /resume, /contact, /projects) accessible without auth
7. Auth state after browser refresh: Login, navigate to /teams, refresh page, verify session persists

Use Playwright's storageState pattern from existing authenticated/teams.spec.ts for session management. Test middleware redirect behavior and NextAuth session handling.

Do NOT manually manipulate cookies or localStorage - use Playwright's built-in authentication helpers. Follow existing authenticated test pattern from apps/web/e2e/authenticated/*.spec.ts.
  </action>
  <verify>
Run test suite:
```bash
cd apps/web
npx playwright test e2e/user-journey/authentication-boundaries.spec.ts --project=chromium
```

All authentication boundary scenarios should pass. Verify clear error messages if middleware redirect fails or session doesn't persist.
  </verify>
  <done>
E2E test validates authentication boundaries with proper redirects, session persistence, and auth state synchronization across portfolio and dashboard routes. All 7 scenarios pass consistently.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create navigation state preservation E2E test</name>
  <files>apps/web/e2e/user-journey/navigation-state.spec.ts</files>
  <action>
Create E2E test validating navigation state preservation, including breadcrumbs, back button behavior, sidebar state, and filter/search persistence across route changes.

Test scenarios:
1. Breadcrumb hierarchy: Navigate Team → Project → Task, verify breadcrumbs show correct hierarchy at each level
2. Browser back button: Navigate Team → Project → Task, click browser back button twice, verify return to Team page
3. Sidebar state preservation: Expand team in sidebar, navigate to project, verify sidebar team still expanded
4. Filter state in URL: Apply filters on project board (status, priority), navigate to task detail, back to board, verify filters preserved
5. Search persistence: Search for task, navigate to task detail, back to board, verify search term persists
6. Scroll position: Scroll down task list, navigate to task detail, back to list, verify scroll position preserved (Next.js behavior)
7. Deep link access: Login, access /teams/{id}/projects/{id} directly, verify breadcrumbs and sidebar state correct

Use page.goBack() for browser back button testing. Use URL inspection (page.url()) to verify filter/search state in query params. Test should validate nuqs URL state management pattern from Phase 02-08.

Reference existing filter/search implementation from apps/web/app/(dashboard)/teams/[teamId]/projects/[projectId]/page.tsx if it exists.
  </action>
  <verify>
Run test suite:
```bash
cd apps/web
npx playwright test e2e/user-journey/navigation-state.spec.ts --project=chromium
```

All navigation state scenarios should pass, demonstrating proper state preservation across navigation.
  </verify>
  <done>
E2E test validates navigation state preservation including breadcrumbs, back button, sidebar state, and filter/search persistence. All 7 scenarios pass consistently, proving navigation UX is robust.
  </done>
</task>

</tasks>

<verification>
Run all user journey E2E tests:
```bash
cd apps/web
npx playwright test e2e/user-journey/ --project=chromium
```

All three test suites should pass:
- complete-flow.spec.ts: Validates entire user journey from portfolio to task detail
- authentication-boundaries.spec.ts: Validates auth redirects, session persistence, and state sync
- navigation-state.spec.ts: Validates breadcrumbs, back button, sidebar state, and filter persistence

Generate HTML report to review test execution:
```bash
npx playwright show-report
```

Verify test coverage includes all 10 success criteria related to user navigation, authentication boundaries, and user flow completeness.
</verification>

<success_criteria>
1. E2E test validates complete user journey: Portfolio → Login → Create Team → Create Project → Create Task → Interact with Kanban → View Task Detail
2. E2E test validates authentication boundaries: Proper redirects for unauth users, session persistence across navigation, logout flow
3. E2E test validates navigation state: Breadcrumbs correct at all levels, back button works, sidebar state preserved, filters persist in URL
4. All tests pass consistently in Playwright with clear, semantic selectors (getByRole, getByLabel, getByText)
5. Tests provide actionable failure messages indicating exactly which step broke and why
6. Test execution time is reasonable (each suite completes in under 2 minutes)
</success_criteria>

<output>
After completion, create `.planning/phases/06.1-user-flow-architecture-audit/06.1-01-SUMMARY.md`
</output>
