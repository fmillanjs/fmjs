---
phase: 06.1-user-flow-architecture-audit
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/app/(dashboard)/teams/[teamId]/projects/[projectId]/page.tsx
  - apps/web/components/tasks/task-form.tsx
  - apps/web/lib/hooks/use-tasks.ts
autonomous: false
gap_closure: true

must_haves:
  truths:
    - "Task creation succeeds without displaying error messages to user"
    - "Task form validation errors are only shown for actual validation failures"
    - "API errors during task creation show user-friendly messages"
  artifacts:
    - path: "apps/web/components/tasks/task-form.tsx"
      provides: "Task creation form with proper error handling"
      contains: "onSubmit handler with error state management"
    - path: "apps/web/lib/hooks/use-tasks.ts"
      provides: "Task mutation hook with proper error handling"
      contains: "useMutation with onError callback"
  key_links:
    - from: "task-form.tsx"
      to: "use-tasks.ts"
      via: "createTask mutation"
      pattern: "createTask\\("
    - from: "use-tasks.ts"
      to: "API endpoint"
      via: "POST /api/tasks"
      pattern: "api\\.post.*tasks"
---

<objective>
Investigate and fix task creation error UX where form submission displays error messages during successful task creation, improving user experience by eliminating confusing error messages while preserving actual validation error display.

Purpose: Close Gap 2 from Phase 6.1 verification - task creation functionality works correctly but displays errors during submission (documented as issue #001 in EDGE-CASE-CHECKLIST.md with MEDIUM severity).

Output: Clean task creation UX with no spurious errors during successful submission, while maintaining proper error handling for actual failures.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06.1-user-flow-architecture-audit/06.1-VERIFICATION.md

# Gap context
Gap 2: Task creation error UX (WARNING)
- Task creation works but shows errors during submission
- Documented as issue #001 in EDGE-CASE-CHECKLIST.md
- Fix needed: Investigate form validation and API error handling

# Related files
@apps/web/app/(dashboard)/teams/[teamId]/projects/[projectId]/page.tsx
@apps/web/components/tasks/task-form.tsx
@apps/web/lib/hooks/use-tasks.ts
@apps/web/lib/api.ts
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 1: Investigate task creation error behavior</name>
  <files>N/A - manual investigation</files>
  <action>
Manual investigation and testing of task creation flow to identify error source.

What was built: Task creation form with existing functionality that works but displays error messages.

How to verify:

1. **Start development server:**
   ```bash
   cd apps/web
   npm run dev
   ```

2. **Navigate to task creation:**
   - Login to TeamFlow
   - Navigate to any project board
   - Click "Add task" button in any Kanban column

3. **Test task creation with browser console open:**
   - Open browser DevTools (F12)
   - Switch to Console tab
   - Fill in task form: title "Test Task", description "Test Description"
   - Click "Create Task" button
   - **Observe and document:**
     - What error messages appear in UI?
     - What errors appear in browser console?
     - What network requests are made (check Network tab)?
     - Does task successfully appear in column after errors?

4. **Common error patterns to check:**
   - Form validation triggering on submit despite valid data
   - API response showing error but task created successfully
   - Optimistic update causing temporary error state
   - React Hook Form validation state not cleared after success
   - Toast notification showing error despite successful creation

5. **Document findings:**
   - Screenshot error messages
   - Copy console error messages
   - Note timing (when errors appear - before/during/after API call)
   - Note whether error persists or clears after task appears

6. **Report findings in response:**
   - Describe error UX behavior
   - Identify likely root cause (form validation, API error handling, state management)
   - Suggest fix approach

Resume signal: Describe what you observed: error messages, console output, network behavior, and suspected root cause. Type your findings to continue.
  </action>
  <verify>Manual verification checkpoint - findings documented in response to resume signal</verify>
  <done>Error source identified and documented, with clear understanding of root cause and fix approach for Task 2</done>
</task>

<task type="auto">
  <name>Task 2: Fix identified task creation error handling</name>
  <files>
apps/web/components/tasks/task-form.tsx
apps/web/lib/hooks/use-tasks.ts
apps/web/app/(dashboard)/teams/[teamId]/projects/[projectId]/page.tsx
  </files>
  <action>
Based on human verification findings from Task 1, implement fix for task creation error UX.

Common fix patterns by root cause:

**If form validation error:**
- Update React Hook Form configuration to only show errors for actual validation failures
- Ensure form reset after successful submission clears error state
- Check schema validators are not overly strict (e.g., requiring fields that are optional)

**If API error handling issue:**
- Verify useMutation onError vs onSuccess callbacks are wired correctly
- Ensure toast notifications only show for actual API failures (not 2xx responses)
- Check API response parsing - success response might include error field

**If optimistic update issue:**
- Review optimistic UI update pattern in useOptimistic or useMutation
- Ensure error state rollback only triggers on actual API failure, not during loading
- Verify loading state transitions correctly (loading → success vs loading → error)

**If state management issue:**
- Check React state updates are batched correctly (no race conditions)
- Verify form state is cleared/reset after successful submission
- Ensure no stale error state from previous failed attempts

**General approach:**
1. Locate root cause file identified in Task 1 verification
2. Add console logging to track error state flow if needed
3. Implement fix based on root cause pattern above
4. Remove any defensive error handling that's too aggressive
5. Ensure success path clears all error states
6. Preserve actual error handling for real failures (network errors, validation errors, 4xx/5xx responses)

Do NOT suppress legitimate error messages. Only fix spurious errors during successful operations.
  </action>
  <verify>
Manual verification of fix:
```bash
cd apps/web
npm run dev
```

Test task creation flow:
1. Login to TeamFlow
2. Navigate to project board
3. Click "Add task" in TODO column
4. Fill form: title "Test Task", description "Testing fix"
5. Submit form
6. **Verify:**
   - No error messages appear during submission
   - Task appears in column immediately (optimistic update)
   - No console errors
   - Success feedback shown (toast or visual confirmation)

Also test error case (to ensure error handling still works):
1. Disconnect network in DevTools
2. Try to create task
3. **Verify:**
   - Error message shows: "Failed to create task" or similar
   - Task does NOT appear in column
   - User can retry

Run E2E test to verify no regressions:
```bash
cd apps/web
npx playwright test e2e/user-journey/complete-flow.spec.ts --project=chromium
```

Should pass without errors.
  </verify>
  <done>
Task creation shows clean UX with no spurious error messages during successful submission. Actual error cases (network failure, validation errors) still display appropriate error messages. Manual testing and E2E tests confirm fix works correctly.
  </done>
</task>

</tasks>

<verification>
Manual verification checklist:

**Success case (should be clean):**
- [ ] Create task with valid data
- [ ] No error messages appear in UI
- [ ] No errors in browser console
- [ ] Task appears in column
- [ ] Form resets/closes after creation

**Error case (should show errors):**
- [ ] Create task with network disconnected
- [ ] Error message appears: "Failed to create task"
- [ ] Task does NOT appear in column
- [ ] Retry button or form stays open for correction

**Edge cases:**
- [ ] Create task with empty title (validation error should show)
- [ ] Create task twice rapidly (no duplicate/error race condition)
- [ ] Create task in different columns (all work cleanly)

Run automated tests:
```bash
cd apps/web
npx playwright test e2e/user-journey/complete-flow.spec.ts --project=chromium
npx playwright test e2e/edge-cases/error-states.spec.ts --project=chromium
```

Both should pass without failures.

Update EDGE-CASE-CHECKLIST.md:
- [ ] Mark issue #001 as RESOLVED
- [ ] Update status from MEDIUM to FIXED
- [ ] Add fix commit reference
</verification>

<success_criteria>
1. Task creation succeeds without displaying error messages during successful submission
2. Error handling preserved for actual failures (network errors, validation errors)
3. Manual testing confirms clean UX for success path
4. E2E tests pass without regressions
5. Issue #001 in EDGE-CASE-CHECKLIST.md marked as RESOLVED
6. Gap 2 from VERIFICATION.md is fully closed
</success_criteria>

<output>
After completion, create `.planning/phases/06.1-user-flow-architecture-audit/06.1-05-SUMMARY.md`
</output>
