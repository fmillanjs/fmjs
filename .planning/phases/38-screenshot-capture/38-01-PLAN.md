---
phase: 38-screenshot-capture
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/e2e/screenshots/teamflow-capture.ts
  - apps/web/public/screenshots/teamflow-kanban.png
  - apps/web/public/screenshots/teamflow-presence.png
  - apps/web/public/screenshots/teamflow-task-modal.png
  - apps/web/public/screenshots/teamflow-rbac.png
  - apps/web/public/screenshots/teamflow-audit-log.png
autonomous: true
requirements:
  - SHOT-01

must_haves:
  truths:
    - "A Playwright script file exists at apps/web/e2e/screenshots/teamflow-capture.ts"
    - "Running the script against teamflow.fernandomillan.me produces 5 PNG files in apps/web/public/screenshots/"
    - "All 5 TeamFlow PNG files are 1280x800 pixels"
    - "The 5 files cover: kanban board, real-time presence, task create/assign modal, RBAC team management, audit log"
  artifacts:
    - path: "apps/web/e2e/screenshots/teamflow-capture.ts"
      provides: "Playwright script for TeamFlow screenshot capture"
      exports: []
    - path: "apps/web/public/screenshots/teamflow-kanban.png"
      provides: "Kanban board screenshot"
    - path: "apps/web/public/screenshots/teamflow-presence.png"
      provides: "Real-time presence screenshot"
    - path: "apps/web/public/screenshots/teamflow-task-modal.png"
      provides: "Task create/assign modal screenshot"
    - path: "apps/web/public/screenshots/teamflow-rbac.png"
      provides: "RBAC team management screenshot"
    - path: "apps/web/public/screenshots/teamflow-audit-log.png"
      provides: "Audit log screenshot"
  key_links:
    - from: "teamflow-capture.ts"
      to: "teamflow.fernandomillan.me"
      via: "page.goto() with live production URL"
      pattern: "goto.*teamflow\\.fernandomillan\\.me"
    - from: "teamflow-capture.ts"
      to: "apps/web/public/screenshots/"
      via: "page.screenshot({ path: ... })"
      pattern: "screenshot.*public/screenshots"
---

<objective>
Write and execute a Playwright script that authenticates against the live TeamFlow production app and captures 5 workflow screenshots at exactly 1280x800 pixels, saving them to apps/web/public/screenshots/.

Purpose: Produce the static screenshot assets Phase 39 will annotate with callout overlays in the WalkthroughSection component.
Output: 5 PNG files — teamflow-kanban.png, teamflow-presence.png, teamflow-task-modal.png, teamflow-rbac.png, teamflow-audit-log.png — all at 1280x800 in apps/web/public/screenshots/.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

<interfaces>
<!-- Existing Playwright auth pattern from apps/web/e2e/auth/auth.setup.ts -->
<!-- The existing setup authenticates against localhost. This script targets PRODUCTION. -->
<!-- Do NOT use storageState — authenticate inline per screenshot session. -->

Existing playwright.config.ts targets localhost:3000. This script is a standalone script
(not a test spec) run directly with `npx playwright --config=...` or as a script with
`node -e` approach. Better: write it as a self-contained Playwright script that uses
chromium directly via chromium.launch(), not the test runner.

Existing screenshot pattern (apps/web/e2e/dashboard/visual-regression.spec.ts):
```typescript
await page.goto('/teams')
await page.waitForLoadState('networkidle')
await expect(page).toHaveScreenshot('file.png', { fullPage: true })
```

TeamFlow live app credentials (from auth setup, same demo account):
- URL: https://teamflow.fernandomillan.me
- Email: demo1@teamflow.dev
- Password: Password123
- Login route: /login
- Post-login redirect: /teams
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write TeamFlow Playwright screenshot capture script</name>
  <files>apps/web/e2e/screenshots/teamflow-capture.ts</files>
  <action>
Create a standalone Playwright script (NOT a test spec) at apps/web/e2e/screenshots/teamflow-capture.ts.

Use chromium.launch() from '@playwright/test' (chromium API, not test runner). Set viewport to { width: 1280, height: 800 } on the browser context. Save all screenshots to apps/web/public/screenshots/ using absolute path resolution with path.resolve(__dirname, '../../../public/screenshots/').

Authentication flow:
1. Navigate to https://teamflow.fernandomillan.me/login
2. Fill email: demo1@teamflow.dev
3. Fill password: Password123
4. Click submit button
5. Wait for navigation to /teams (waitForURL with pattern)

Screenshot sequence — for each: waitForLoadState('networkidle'), then page.screenshot({ path, fullPage: false }). All screenshots are viewport-only (NOT fullPage) so dimensions stay exactly 1280x800.

5 screenshots to capture:
1. teamflow-kanban.png — Navigate to the Kanban/project board. Try /teams, find first team link, click it, find first project link, click it. Wait for board columns to render (wait for selector like '[data-testid*="column"]' or '.kanban' or any board-like element, fallback to networkidle + 1000ms timeout).
2. teamflow-presence.png — On the same board page or /teams, look for presence indicators (online dots, user avatars with status). If presence UI visible, screenshot there. Otherwise screenshot /teams which shows team members.
3. teamflow-task-modal.png — On the board page, click "Create task" or "+ Add task" button or any button that opens a task creation/assignment modal. Wait for modal to be visible (role='dialog' or '[data-testid*="modal"]'). Screenshot with modal open.
4. teamflow-rbac.png — Navigate to team settings or member management. Try /teams/{teamId}/settings or /teams/{teamId}/members. Look for role/permission UI. Screenshot team members list showing roles.
5. teamflow-audit-log.png — Navigate to audit log. Try /teams/{teamId}/activity or /audit or /activity. If not found directly, look for an "Activity" or "Audit" nav link on the team detail page.

Error handling: Wrap each screenshot in try/catch. On failure, log the error and save a fallback screenshot of the current page state (still saves the file, just whatever state the page is in). This ensures all 5 files always exist even if navigation partially fails.

Script structure:
```typescript
import { chromium } from '@playwright/test'
import * as path from 'path'
import * as fs from 'fs'

const SCREENSHOTS_DIR = path.resolve(__dirname, '../../../public/screenshots')
const BASE_URL = 'https://teamflow.fernandomillan.me'

async function capture() {
  const browser = await chromium.launch({ headless: true })
  const context = await browser.newContext({
    viewport: { width: 1280, height: 800 }
  })
  const page = await context.newPage()

  // Ensure output directory exists
  fs.mkdirSync(SCREENSHOTS_DIR, { recursive: true })

  // Login
  await page.goto(`${BASE_URL}/login`)
  await page.getByLabel('Email').fill('demo1@teamflow.dev')
  await page.getByLabel('Password').fill('Password123')
  await page.getByRole('button', { name: /log in/i }).click()
  await page.waitForURL(`${BASE_URL}/teams`)

  // ... 5 screenshots with error handling ...

  await browser.close()
}

capture().catch(console.error)
```

The script is run with: npx ts-node apps/web/e2e/screenshots/teamflow-capture.ts
OR compiled and run: npx tsx apps/web/e2e/screenshots/teamflow-capture.ts
  </action>
  <verify>
    <automated>test -f /home/doctor/fernandomillan/apps/web/e2e/screenshots/teamflow-capture.ts && echo "Script file exists"</automated>
  </verify>
  <done>teamflow-capture.ts exists with chromium.launch(), viewport 1280x800, login flow, 5 named screenshot saves, error handling per screenshot</done>
</task>

<task type="auto">
  <name>Task 2: Execute TeamFlow capture script and verify 5 PNG files</name>
  <files>
    apps/web/public/screenshots/teamflow-kanban.png
    apps/web/public/screenshots/teamflow-presence.png
    apps/web/public/screenshots/teamflow-task-modal.png
    apps/web/public/screenshots/teamflow-rbac.png
    apps/web/public/screenshots/teamflow-audit-log.png
  </files>
  <action>
Run the capture script from the apps/web directory using tsx (which is available via @playwright/test's bundled tooling, or install tsx if needed).

Check if tsx is available:
```bash
cd apps/web && npx tsx --version 2>/dev/null || npm install -D tsx
```

Run the script:
```bash
cd apps/web && npx tsx e2e/screenshots/teamflow-capture.ts
```

If tsx is not available and install fails, use ts-node:
```bash
cd apps/web && npx ts-node --project tsconfig.json e2e/screenshots/teamflow-capture.ts
```

After running, verify all 5 PNG files exist in apps/web/public/screenshots/:
- teamflow-kanban.png
- teamflow-presence.png
- teamflow-task-modal.png
- teamflow-rbac.png
- teamflow-audit-log.png

If any file is missing (due to navigation errors), check the error output and adjust the script's selectors/navigation logic. Common fixes:
- If board not found: try navigating directly to /teams, screenshot the teams page as "kanban" fallback
- If modal won't open: screenshot the board state with a "New Task" button visible
- If audit log not found: screenshot /teams with activity sidebar visible

Re-run until all 5 files exist.

Verify file sizes: each PNG should be > 10KB (a blank/error screenshot would be much smaller):
```bash
ls -lh apps/web/public/screenshots/teamflow-*.png
```
  </action>
  <verify>
    <automated>ls /home/doctor/fernandomillan/apps/web/public/screenshots/teamflow-kanban.png /home/doctor/fernandomillan/apps/web/public/screenshots/teamflow-presence.png /home/doctor/fernandomillan/apps/web/public/screenshots/teamflow-task-modal.png /home/doctor/fernandomillan/apps/web/public/screenshots/teamflow-rbac.png /home/doctor/fernandomillan/apps/web/public/screenshots/teamflow-audit-log.png && echo "All 5 TeamFlow screenshots exist"</automated>
  </verify>
  <done>All 5 teamflow-*.png files exist in apps/web/public/screenshots/, each > 10KB, each at 1280x800 viewport dimensions</done>
</task>

</tasks>

<verification>
- apps/web/e2e/screenshots/teamflow-capture.ts exists with correct structure
- 5 TeamFlow PNG files exist in apps/web/public/screenshots/
- Each file is > 10KB (not blank/error screenshots)
- Script uses viewport 1280x800 (not fullPage) so all screenshots are exactly 1280x800
</verification>

<success_criteria>
Running `ls apps/web/public/screenshots/teamflow-*.png | wc -l` returns 5.
Running `file apps/web/public/screenshots/teamflow-kanban.png` confirms PNG format.
All 5 screenshots visually represent their named workflow area (kanban, presence, task modal, rbac, audit log).
</success_criteria>

<output>
After completion, create `.planning/phases/38-screenshot-capture/38-01-SUMMARY.md` documenting:
- Which selectors/navigation paths worked for each of the 5 screenshots
- Any fallback approaches used (e.g. "task modal screenshot fell back to board state")
- Script invocation command that worked (tsx vs ts-node)
</output>
