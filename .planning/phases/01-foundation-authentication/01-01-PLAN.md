---
phase: 01-foundation-authentication
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - turbo.json
  - docker-compose.yml
  - .env
  - .env.example
  - .gitignore
  - apps/web/package.json
  - apps/web/tsconfig.json
  - apps/web/next.config.ts
  - apps/api/package.json
  - apps/api/tsconfig.json
  - apps/api/nest-cli.json
  - packages/shared/package.json
  - packages/shared/tsconfig.json
  - packages/database/package.json
  - packages/database/tsconfig.json
  - packages/config/tsconfig/base.json
  - packages/config/tsconfig/nextjs.json
  - packages/config/tsconfig/nestjs.json
autonomous: true

must_haves:
  truths:
    - "Running `docker compose up -d` starts Postgres and Redis containers successfully"
    - "Running `npm install` at root installs dependencies for all workspaces"
    - "Turborepo builds all packages without errors"
    - "Each app (web, api) can import from @repo/shared and @repo/database packages"
  artifacts:
    - path: "package.json"
      provides: "NPM workspaces root config"
      contains: "workspaces"
    - path: "turbo.json"
      provides: "Turborepo pipeline configuration"
      contains: "pipeline"
    - path: "docker-compose.yml"
      provides: "Postgres and Redis containers"
      contains: "postgres"
    - path: "apps/web/package.json"
      provides: "Next.js frontend app"
      contains: "next"
    - path: "apps/api/package.json"
      provides: "NestJS backend app"
      contains: "@nestjs/core"
    - path: "packages/shared/package.json"
      provides: "Shared types and validators package"
      contains: "@repo/shared"
    - path: "packages/database/package.json"
      provides: "Prisma database package"
      contains: "@repo/database"
  key_links:
    - from: "apps/web/package.json"
      to: "@repo/shared"
      via: "workspace dependency"
      pattern: "@repo/shared"
    - from: "apps/api/package.json"
      to: "@repo/shared"
      via: "workspace dependency"
      pattern: "@repo/shared"
    - from: "apps/web/package.json"
      to: "@repo/database"
      via: "workspace dependency"
      pattern: "@repo/database"
    - from: "apps/api/package.json"
      to: "@repo/database"
      via: "workspace dependency"
      pattern: "@repo/database"
---

<objective>
Set up the Turborepo monorepo structure with Next.js frontend, NestJS backend, shared packages, and Docker infrastructure for local development.

Purpose: Establish the foundational project structure that all subsequent plans build upon. Without this, nothing else can be implemented. Covers TECH-01 (monorepo), DEPLOY-01 (Docker), DEPLOY-03 (env vars).

Output: Working monorepo with Docker Compose running Postgres + Redis, and all workspace packages linked.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-authentication/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Turborepo monorepo with workspace packages</name>
  <files>
    package.json
    turbo.json
    .gitignore
    apps/web/package.json
    apps/web/tsconfig.json
    apps/web/next.config.ts
    apps/web/app/layout.tsx
    apps/web/app/page.tsx
    apps/api/package.json
    apps/api/tsconfig.json
    apps/api/nest-cli.json
    apps/api/src/main.ts
    apps/api/src/app.module.ts
    packages/shared/package.json
    packages/shared/tsconfig.json
    packages/shared/src/index.ts
    packages/database/package.json
    packages/database/tsconfig.json
    packages/database/src/index.ts
    packages/config/tsconfig/base.json
    packages/config/tsconfig/nextjs.json
    packages/config/tsconfig/nestjs.json
  </files>
  <action>
    Create the full monorepo structure using npm workspaces + Turborepo.

    **Root package.json:**
    - name: "teamflow"
    - private: true
    - workspaces: ["apps/*", "packages/*"]
    - devDependencies: turbo, typescript (pin to ~5.6)
    - scripts: "build": "turbo build", "dev": "turbo dev", "lint": "turbo lint"

    **turbo.json:**
    - pipeline: build (dependsOn: ^build), dev (cache: false, persistent: true), lint
    - globalDependencies: [".env"]

    **Shared tsconfig packages (packages/config/tsconfig/):**
    - base.json: strict mode, ES2022 target, moduleResolution: bundler, paths for @repo/*
    - nextjs.json: extends base, adds jsx: preserve, Next.js plugin
    - nestjs.json: extends base, adds emitDecoratorMetadata, experimentalDecorators

    **packages/shared:**
    - name: "@repo/shared"
    - main: "./src/index.ts" (raw TS source, NOT compiled â€” per research on type drift prevention)
    - exports: { "./types": "./src/types/index.ts", "./validators": "./src/validators/index.ts" }
    - dependencies: zod@^3.22
    - Create placeholder src/index.ts, src/types/index.ts, src/validators/index.ts

    **packages/database:**
    - name: "@repo/database"
    - main: "./src/index.ts"
    - dependencies: @prisma/client
    - devDependencies: prisma
    - Create placeholder src/index.ts

    **apps/web:**
    - Next.js 15 app with App Router
    - dependencies: next, react, react-dom
    - devDependencies: @types/react, @types/node
    - workspace deps: "@repo/shared": "*", "@repo/database": "*"
    - next.config.ts: transpilePackages: ["@repo/shared", "@repo/database"]
    - tsconfig.json extends packages/config/tsconfig/nextjs.json
    - Minimal app/layout.tsx and app/page.tsx (just "TeamFlow" heading)

    **apps/api:**
    - NestJS 10 app (minimal scaffold)
    - dependencies: @nestjs/core, @nestjs/common, @nestjs/platform-express, reflect-metadata, rxjs
    - workspace deps: "@repo/shared": "*", "@repo/database": "*"
    - tsconfig.json extends packages/config/tsconfig/nestjs.json
    - nest-cli.json with standard config
    - Minimal src/main.ts (bootstrap on port 3001) and src/app.module.ts

    **Update .gitignore:**
    - Add: node_modules, .next, dist, .turbo, .env.local, *.tsbuildinfo, coverage

    IMPORTANT: Do NOT install dependencies yet (that happens after docker-compose in Task 2).
  </action>
  <verify>
    All files exist in correct locations:
    ```bash
    ls package.json turbo.json
    ls apps/web/package.json apps/api/package.json
    ls packages/shared/package.json packages/database/package.json
    ls packages/config/tsconfig/base.json
    ```
    Verify @repo/* workspace references in web and api package.json files.
  </verify>
  <done>
    Monorepo file structure exists with all workspace packages, TypeScript configs extending shared base, and Turborepo pipeline defined. Apps reference @repo/shared and @repo/database as workspace dependencies.
  </done>
</task>

<task type="auto">
  <name>Task 2: Set up Docker Compose and environment configuration</name>
  <files>
    docker-compose.yml
    .env
    .env.example
  </files>
  <action>
    **IMPORTANT: First check if a Docker container is already running. If so, note it and work around it.**

    ```bash
    docker ps 2>/dev/null
    ```

    **docker-compose.yml:**
    - Service `postgres`: image postgres:16-alpine, port 5432:5432, volume pgdata:/var/lib/postgresql/data, env POSTGRES_USER/PASSWORD/DB from .env, healthcheck using pg_isready
    - Service `redis`: image redis:7-alpine, port 6379:6379, volume redisdata:/data, healthcheck using redis-cli ping
    - volumes: pgdata, redisdata
    - networks: teamflow-network

    **.env (gitignored):**
    ```
    # Database
    DATABASE_URL=postgresql://teamflow:teamflow_dev@localhost:5432/teamflow
    POSTGRES_USER=teamflow
    POSTGRES_PASSWORD=teamflow_dev
    POSTGRES_DB=teamflow

    # Redis
    REDIS_URL=redis://localhost:6379

    # NextAuth
    NEXTAUTH_SECRET=dev-secret-change-in-production
    NEXTAUTH_URL=http://localhost:3000

    # API
    API_URL=http://localhost:3001
    API_PORT=3001

    # JWT
    JWT_SECRET=dev-jwt-secret-change-in-production
    JWT_EXPIRES_IN=15m
    JWT_REFRESH_EXPIRES_IN=7d

    # Frontend
    NEXT_PUBLIC_API_URL=http://localhost:3001
    NEXT_PUBLIC_WS_URL=ws://localhost:3001
    ```

    **.env.example:** Same as .env but with placeholder values (no real secrets).

    After creating files, run:
    ```bash
    docker compose up -d
    ```
    Wait for healthy status, then run `npm install` at root to install all workspace dependencies.

    Verify monorepo builds:
    ```bash
    npx turbo build --dry-run
    ```
  </action>
  <verify>
    ```bash
    docker compose ps  # Both postgres and redis show "healthy"
    docker compose exec postgres pg_isready  # Returns "accepting connections"
    docker compose exec redis redis-cli ping  # Returns "PONG"
    ls node_modules/.package-lock.json  # npm install completed
    ```
  </verify>
  <done>
    Docker Compose runs Postgres 16 and Redis 7 with health checks. Environment variables configured for all services. npm workspaces installed. Monorepo structure verified with Turborepo dry run.
  </done>
</task>

</tasks>

<verification>
1. `docker compose ps` shows postgres and redis healthy
2. `npm install` completes without errors
3. `ls apps/web/node_modules/@repo/shared` confirms workspace linking
4. `ls apps/api/node_modules/@repo/shared` confirms workspace linking
5. All TypeScript configs parse without errors
</verification>

<success_criteria>
- Monorepo structure with apps/web, apps/api, packages/shared, packages/database, packages/config exists
- Docker Compose starts Postgres and Redis with health checks
- npm workspaces link @repo/* packages across apps
- Environment variables configured in .env with .env.example template
- Turborepo pipeline defined for build, dev, lint
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-authentication/01-01-SUMMARY.md`
</output>
