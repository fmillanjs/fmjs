---
phase: 12-critical-route-migration
plan: 02
type: execute
wave: 2
depends_on:
  - 12-01
files_modified:
  - apps/web/components/tasks/task-form.tsx
  - apps/web/components/tasks/kanban-board.tsx
  - apps/web/components/tasks/task-list-view.tsx
  - apps/web/components/tasks/task-views.tsx
autonomous: true
requirements:
  - COMP-04
  - MIG-02
  - MIG-03

must_haves:
  truths:
    - "TaskForm renders inside a Shadcn Dialog with DialogTitle and DialogDescription visible"
    - "Dialog has focus trap — tabbing inside the form cannot exit the modal"
    - "Pressing ESC closes the dialog"
    - "The old fixed inset-0 bg-black/50 overlay div is deleted from task-form.tsx"
    - "Kanban + List + TaskViews open TaskForm via Dialog open/onOpenChange props"
  artifacts:
    - path: "apps/web/components/tasks/task-form.tsx"
      provides: "Dialog-wrapped form with open/onOpenChange interface"
      contains: "DialogContent"
    - path: "apps/web/components/tasks/kanban-board.tsx"
      provides: "Opens TaskForm via Dialog open prop"
      contains: "open={isFormOpen}"
    - path: "apps/web/components/tasks/task-list-view.tsx"
      provides: "Opens TaskForm via Dialog open prop"
      contains: "open={isFormOpen}"
    - path: "apps/web/components/tasks/task-views.tsx"
      provides: "Opens TaskForm via Dialog open prop"
      contains: "open={isNewTaskOpen}"
  key_links:
    - from: "apps/web/components/tasks/kanban-board.tsx"
      to: "apps/web/components/tasks/task-form.tsx"
      via: "Dialog open={isFormOpen} onOpenChange={setIsFormOpen}"
      pattern: "open=\\{isFormOpen\\}"
    - from: "apps/web/components/tasks/task-form.tsx"
      to: "@/components/ui/dialog"
      via: "import"
      pattern: "from '@/components/ui/dialog'"
---

<objective>
Migrate TaskForm from a custom fixed-overlay div to a Shadcn Dialog. This is the primary COMP-04 deliverable — the first real accessible modal in the application. The form internals (Shadcn Form, Input, Textarea, Select, Button) are unchanged; only the wrapper changes.

Purpose: Satisfies COMP-04 (focus trapping, ESC close, proper ARIA roles). Radix Dialog provides automatic focus trap, ESC handler, role="dialog", aria-labelledby wired to DialogTitle — none of which the current custom div has.
Output: task-form.tsx wraps its content in Dialog/DialogContent. Three callers (kanban-board, task-list-view, task-views) use `open`/`onOpenChange` instead of conditional rendering. Old overlay div deleted.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/12-critical-route-migration/12-RESEARCH.md
@apps/web/components/tasks/task-form.tsx
@apps/web/components/tasks/kanban-board.tsx
@apps/web/components/tasks/task-list-view.tsx
@apps/web/components/tasks/task-views.tsx
@apps/web/components/ui/dialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate task-form.tsx from custom overlay div to Shadcn Dialog</name>
  <files>apps/web/components/tasks/task-form.tsx</files>
  <action>
    Replace the custom modal wrapper with Shadcn Dialog. The form internals stay exactly as-is.

    Changes to make:

    1. Add imports at the top:
       ```tsx
       import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';
       ```
       Remove the `X` import from lucide-react (DialogContent has a built-in close button).

    2. Change the TaskFormProps interface:
       - Remove `onClose: () => void;`
       - Add `open: boolean;`
       - Add `onOpenChange: (open: boolean) => void;`

    3. Update the destructured props to use `open, onOpenChange` instead of `onClose`.

    4. Update internal `onClose` references:
       - In the form `onSubmit`, the `onClose()` call becomes `onOpenChange(false)`
       - The Cancel button's `onClick={onClose}` becomes `onClick={() => onOpenChange(false)}`

    5. Replace the entire JSX return — delete the two nested divs (`fixed inset-0 bg-black/50` outer and `bg-card rounded-lg shadow-xl` inner):
       ```tsx
       return (
         <Dialog open={open} onOpenChange={onOpenChange}>
           <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
             <DialogHeader>
               <DialogTitle>
                 {mode === 'create' ? 'Create Task' : 'Edit Task'}
               </DialogTitle>
               <DialogDescription>
                 {mode === 'create'
                   ? 'Add a new task to this project.'
                   : 'Update the task details below.'}
               </DialogDescription>
             </DialogHeader>
             <Form {...form}>
               <form onSubmit={form.handleSubmit(onSubmit)} className="p-6 space-y-4">
                 {/* error alert, FormFields, actions — all unchanged */}
               </form>
             </Form>
           </DialogContent>
         </Dialog>
       );
       ```
       The header with the manual X button and the `onClick={onClose}` / `e.stopPropagation()` pattern are DELETED entirely — DialogContent handles all of this automatically.

    Note: DialogTitle MUST be present inside DialogContent or Radix throws a warning and axe flags dialog-name violation.
  </action>
  <verify>
    `npx tsc --noEmit` in apps/web shows no errors in task-form.tsx.
    `grep "fixed inset-0" apps/web/components/tasks/task-form.tsx` returns empty (old overlay deleted).
    `grep "DialogContent\|DialogTitle" apps/web/components/tasks/task-form.tsx` returns matches.
  </verify>
  <done>task-form.tsx uses Dialog/DialogContent/DialogHeader/DialogTitle/DialogDescription. The old overlay div is gone. Props are open/onOpenChange. No TypeScript errors.</done>
</task>

<task type="auto">
  <name>Task 2: Update TaskForm callers — kanban-board, task-list-view, task-views</name>
  <files>
    apps/web/components/tasks/kanban-board.tsx
    apps/web/components/tasks/task-list-view.tsx
    apps/web/components/tasks/task-views.tsx
  </files>
  <action>
    Update every place that renders `<TaskForm>` to use the new `open`/`onOpenChange` API.

    For each file:
    1. Read the current usage — each file already has an `isFormOpen` or `isNewTaskOpen` boolean state.
    2. Change the conditional render `{isFormOpen && <TaskForm ...>}` to always render `<TaskForm open={isFormOpen} onOpenChange={setIsFormOpen} ...>` (remove the conditional, Dialog handles visibility).
    3. Remove the `onClose` prop, replace with `onOpenChange={setIsFormOpen}` (or `setIsNewTaskOpen` in task-views).
    4. Keep all other props unchanged: mode, task, projectId, teamMembers, labels, onSuccess, prefilledStatus.

    Specific changes:

    kanban-board.tsx (line ~199):
    - Before: `{isFormOpen && (<TaskForm ... onClose={() => setIsFormOpen(false)} ... />)}`
    - After: `<TaskForm open={isFormOpen} onOpenChange={setIsFormOpen} ... onSuccess={handleSuccess} />`

    task-list-view.tsx (line ~247):
    - Before: `{isFormOpen && selectedTask && (<TaskForm ... onClose={() => setIsFormOpen(false)} ... />)}`
    - After: `<TaskForm open={isFormOpen && !!selectedTask} onOpenChange={setIsFormOpen} ... />`
    - Keep the `selectedTask` guard by setting `open={isFormOpen && !!selectedTask}` or maintain the existing guard as needed

    task-views.tsx (line ~132):
    - Before: `{isNewTaskOpen && (<TaskForm ... onClose={() => setIsNewTaskOpen(false)} ... />)}`
    - After: `<TaskForm open={isNewTaskOpen} onOpenChange={setIsNewTaskOpen} ... />`
  </action>
  <verify>
    `npx tsc --noEmit` in apps/web shows no type errors in any of the three files.
    `grep "onClose" apps/web/components/tasks/kanban-board.tsx apps/web/components/tasks/task-list-view.tsx apps/web/components/tasks/task-views.tsx` returns empty (old prop removed from all callers).
    `grep "open={" apps/web/components/tasks/kanban-board.tsx` returns a match.
  </verify>
  <done>All three TaskForm callers pass open/onOpenChange props instead of onClose. No conditional {isFormOpen && <TaskForm>} patterns remain. TypeScript compiles cleanly.</done>
</task>

</tasks>

<verification>
1. `grep -r "fixed inset-0" apps/web/components/tasks/` returns no results
2. `grep -r "onClose" apps/web/components/tasks/task-form.tsx` returns no results
3. `grep "DialogTitle" apps/web/components/tasks/task-form.tsx` returns a match
4. `npx tsc --noEmit` in apps/web passes without new errors
</verification>

<success_criteria>
TaskForm is a Shadcn Dialog. The old fixed-overlay div is deleted. All three callers (kanban-board, task-list-view, task-views) use open/onOpenChange. COMP-04 is partially satisfied for this component (focus trap, ESC, ARIA roles now automatic via Radix).
</success_criteria>

<output>
After completion, create `.planning/phases/12-critical-route-migration/12-02-SUMMARY.md`
</output>
