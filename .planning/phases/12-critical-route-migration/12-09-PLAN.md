---
phase: 12-critical-route-migration
plan: 09
type: execute
wave: 3
depends_on:
  - 12-02
  - 12-03
  - 12-04
  - 12-05
  - 12-06
  - 12-07
  - 12-08
files_modified:
  - apps/web/e2e/dashboard/component-accessibility.spec.ts
autonomous: false
requirements:
  - COMP-04
  - MIG-02
  - MIG-03

must_haves:
  truths:
    - "axe WCAG AA passes on team page (light and dark mode)"
    - "axe WCAG AA passes on project page with task board (light and dark mode)"
    - "No old component files remain in codebase (verified by grep)"
    - "No inline fixed-overlay divs remain in tasks/ components"
    - "No showConfirm or showArchiveConfirm state patterns remain"
    - "Human confirms Dialog, Tabs, Popover, AlertDialog all work visually"
    - "No competing CSS library imports in components/ or app/ — single Tailwind/Radix/Shadcn style system confirmed"
  artifacts:
    - path: "apps/web/e2e/dashboard/component-accessibility.spec.ts"
      provides: "WCAG AA axe tests for team and project dashboard routes"
      contains: "AxeBuilder"
  key_links:
    - from: "apps/web/e2e/dashboard/component-accessibility.spec.ts"
      to: "/teams/[teamId]"
      via: "Playwright storageState auth"
      pattern: "storageState.*user.json"
    - from: "apps/web/e2e/dashboard/component-accessibility.spec.ts"
      to: "AxeBuilder"
      via: "@axe-core/playwright"
      pattern: "AxeBuilder"
---

<objective>
Write and run WCAG AA axe tests for the migrated dashboard routes (team page and project page), run MIG-03 grep verification to confirm no old code patterns remain, and present the visual changes to the user for human approval before Phase 12 is considered complete.

Purpose: Phase quality gate — COMP-04 is not "satisfied" until tests prove focus trapping/ARIA roles work (axe catches accessible name violations, role violations). MIG-03 is not "done" until grep confirms deletion.
Output: e2e/dashboard/component-accessibility.spec.ts with tests for team and project routes. All grep checks pass. Human approves visual changes.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/12-critical-route-migration/12-RESEARCH.md
@apps/web/e2e/auth/form-accessibility.spec.ts
@apps/web/playwright.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write axe WCAG AA tests for dashboard routes and run MIG-03 grep verification</name>
  <files>apps/web/e2e/dashboard/component-accessibility.spec.ts</files>
  <action>
    First, run grep checks to confirm MIG-03 (old code deleted):

    ```bash
    # Must all return EMPTY (no results)
    grep -r "fixed inset-0 bg-black/50" apps/web/components/tasks/
    grep -r "openDropdown.*useState" apps/web/components/tasks/task-filters.tsx
    grep -r "showConfirm.*useState" apps/web/components/teams/
    grep -r "showArchiveConfirm\|showDeleteConfirm" apps/web/components/projects/
    grep -r "activeTab.*useState" apps/web/components/tasks/task-detail-panel.tsx
    grep -r "<svg" apps/web/app/\(dashboard\)/teams/
    ```

    If ANY grep returns results, fix the relevant component before creating the test file.

    Then confirm single style system — no competing CSS library imports anywhere in components or app:

    ```bash
    # Must return EMPTY (no matches = PASS, any match = FAIL)
    grep -r "from 'bootstrap'\|from \"bootstrap\"\|import.*bootstrap\|from 'styled-components'\|from '@material-ui'\|from '@mui'\|from '@chakra-ui'\|from 'antd'" apps/web/components/ apps/web/app/ && echo "FAIL: competing CSS library found" || echo "PASS: single style system confirmed"
    ```

    If that grep returns any matches, remove the competing library import(s) before proceeding.

    Then create `apps/web/e2e/dashboard/` directory if it does not exist and create the test file:

    ```tsx
    // Source: based on apps/web/e2e/auth/form-accessibility.spec.ts pattern
    import { test, expect } from '@playwright/test';
    import AxeBuilder from '@axe-core/playwright';

    // Dashboard routes require authentication — use stored auth state from Phase 11
    test.use({ storageState: 'playwright/.auth/user.json' });

    test.describe('Dashboard Component Accessibility - WCAG AA', () => {
      test('teams list page - light mode', async ({ page }) => {
        await page.goto('/teams');
        await page.waitForLoadState('networkidle');
        const results = await new AxeBuilder({ page })
          .withTags(['wcag2a', 'wcag2aa', 'wcag21aa'])
          .analyze();
        expect(results.violations).toEqual([]);
      });

      test('teams list page - dark mode', async ({ page }) => {
        await page.addInitScript(() => { localStorage.setItem('theme', 'dark'); });
        await page.goto('/teams');
        await page.waitForLoadState('networkidle');
        await page.waitForTimeout(200);
        const results = await new AxeBuilder({ page })
          .withTags(['wcag2a', 'wcag2aa', 'wcag21aa'])
          .analyze();
        expect(results.violations).toEqual([]);
      });

      test('team detail page - light mode', async ({ page }) => {
        await page.goto('/teams');
        await page.waitForLoadState('networkidle');
        const teamLink = page.locator('a[href^="/teams/"]').first();
        await teamLink.click();
        await page.waitForLoadState('networkidle');
        const results = await new AxeBuilder({ page })
          .withTags(['wcag2a', 'wcag2aa', 'wcag21aa'])
          .analyze();
        expect(results.violations).toEqual([]);
      });

      test('team detail page - dark mode', async ({ page }) => {
        await page.addInitScript(() => { localStorage.setItem('theme', 'dark'); });
        await page.goto('/teams');
        await page.waitForLoadState('networkidle');
        const teamLink = page.locator('a[href^="/teams/"]').first();
        await teamLink.click();
        await page.waitForLoadState('networkidle');
        await page.waitForTimeout(200);
        const results = await new AxeBuilder({ page })
          .withTags(['wcag2a', 'wcag2aa', 'wcag21aa'])
          .analyze();
        expect(results.violations).toEqual([]);
      });

      test('project board page - light mode', async ({ page }) => {
        await page.goto('/teams');
        await page.waitForLoadState('networkidle');
        const teamLink = page.locator('a[href^="/teams/"]').first();
        await teamLink.click();
        await page.waitForLoadState('networkidle');
        const projectLink = page.locator('a[href*="/projects/"]').first();
        if (await projectLink.count() > 0) {
          await projectLink.click();
          await page.waitForLoadState('networkidle');
          const results = await new AxeBuilder({ page })
            .withTags(['wcag2a', 'wcag2aa', 'wcag21aa'])
            .analyze();
          expect(results.violations).toEqual([]);
        } else {
          test.skip(true, 'No projects available to test');
        }
      });

      test('project board page - dark mode', async ({ page }) => {
        await page.addInitScript(() => { localStorage.setItem('theme', 'dark'); });
        await page.goto('/teams');
        await page.waitForLoadState('networkidle');
        const teamLink = page.locator('a[href^="/teams/"]').first();
        await teamLink.click();
        await page.waitForLoadState('networkidle');
        const projectLink = page.locator('a[href*="/projects/"]').first();
        if (await projectLink.count() > 0) {
          await projectLink.click();
          await page.waitForLoadState('networkidle');
          await page.waitForTimeout(200);
          const results = await new AxeBuilder({ page })
            .withTags(['wcag2a', 'wcag2aa', 'wcag21aa'])
            .analyze();
          expect(results.violations).toEqual([]);
        } else {
          test.skip(true, 'No projects available to test');
        }
      });
    });
    ```

    After creating the file, run the tests:
    ```bash
    npx playwright test e2e/dashboard/component-accessibility.spec.ts --reporter=list
    ```

    If tests fail due to axe violations, fix each violation before marking this task complete. Common fixes:
    - `dialog-name`: Add `<DialogTitle>` inside `<DialogContent>` if missing
    - `button-name`: Add aria-label to icon-only buttons
    - `color-contrast`: Check Radix Color token usage against WCAG 4.5:1 threshold
  </action>
  <verify>
    All grep checks for old code patterns return empty.
    Single style system grep returns "PASS: single style system confirmed" (no matches).
    `npx playwright test e2e/dashboard/component-accessibility.spec.ts` shows 0 failures.
    Test file exists at `apps/web/e2e/dashboard/component-accessibility.spec.ts`.
  </verify>
  <done>All MIG-03 grep checks pass (no old code). Single style system confirmed (no bootstrap/MUI/Chakra/antd imports). All axe WCAG AA tests pass for teams list, team detail, and project board in both light and dark mode.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human visual verification of all migrated components</name>
  <action>
    Present the following verification checklist to the user. All items in plans 02-08 have been automated. This checkpoint confirms visual correctness and UX behavior before Phase 12 is marked complete.
  </action>
  <what-built>
    Phase 12 complete. All team and task management components migrated to Shadcn:
    - TaskForm: custom overlay div to Shadcn Dialog (focus trap, ESC, ARIA roles)
    - TaskDetailPanel: raw selects + manual tabs to Shadcn Select + Tabs + AlertDialog for delete
    - TaskFilters: 5 custom dropdowns to 5 independent Popovers; shared openDropdown state deleted
    - TaskSearch: raw input to Shadcn Input
    - TaskCard: inline badge spans to Shadcn Badge
    - KanbanColumn: raw div to Shadcn Card (dnd-kit unchanged)
    - TeamMemberList: inline confirm div to AlertDialog; role badges to Badge
    - ProjectCard: raw div to Shadcn Card; status span to Badge
    - ProjectList: manual tab buttons to Shadcn Tabs
    - ProjectActions: inline confirms to AlertDialog (archive) + controlled Dialog with Input (delete)
    - Route pages: inline SVGs + manual button strings to Button asChild + Card + lucide icons

    Note: view-toggle.tsx (Kanban/list view switcher) is intentionally out of scope for Phase 12. It is a LOW impact custom toggle that does not affect WCAG compliance or modal accessibility. It remains a non-Shadcn component and will not be flagged as a MIG-02 failure.
  </what-built>
  <how-to-verify>
    1. Visit /teams — verify team cards render with Card styling (rounded-xl border)
    2. Click into a team — verify stat boxes use Card, navigation buttons use Button, no inline SVGs
    3. Click into a project — verify Kanban board columns use Card, task badges use Badge
    4. Click "+ Add" on a Kanban column — verify TaskForm opens as a Dialog (not a full-page overlay), tabbing stays trapped inside, ESC closes it, "Create Task" title is present
    5. Open the task detail page — verify Status/Priority/Assignee use Shadcn Select dropdowns, Comments/History use Shadcn Tabs, Delete uses AlertDialog
    6. In TaskFilters — verify clicking "Status" opens a Popover, clicking outside closes it
    7. On team page — click "Remove" next to a member — verify AlertDialog appears with "Remove team member?" title
    8. On a project settings page — click "Archive Project" — verify AlertDialog appears. Click "Delete Project" — verify a Dialog with a text input opens
    9. Verify dark mode works on all above routes (toggle theme)
  </how-to-verify>
  <verify>Human has completed all 9 verification steps above and confirmed they work correctly.</verify>
  <done>Human approval received. Phase 12 migration is complete and visually confirmed.</done>
  <resume-signal>Type "approved" to complete Phase 12, or describe specific issues found during verification</resume-signal>
</task>

</tasks>

<verification>
1. All grep checks pass (no old patterns in codebase)
2. Single style system grep confirms no bootstrap/MUI/Chakra/antd imports in components/ or app/
3. axe WCAG AA: 0 violations across 6 tests (teams list, team detail, project board x2 modes each)
4. Human approves visual rendering of Dialog, Tabs, Popover, AlertDialog, Badge, Card
</verification>

<success_criteria>
COMP-04 verified: Dialog/AlertDialog components have focus trapping, ESC close, and ARIA roles (axe passes). MIG-02 verified: team and task routes use Shadcn throughout (view-toggle.tsx intentionally excluded as LOW impact). MIG-03 verified: grep confirms no old overlay divs, confirm divs, or manual tab patterns remain, and no competing CSS libraries are present. Human approval received.
</success_criteria>

<output>
After completion, create `.planning/phases/12-critical-route-migration/12-09-SUMMARY.md`
</output>
