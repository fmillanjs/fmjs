---
phase: 33-footer-redesign-matrix-animation
plan: "02"
type: execute
wave: 2
depends_on:
  - "33-01"
files_modified:
  - apps/web/components/portfolio/glitch-signature.tsx
  - apps/web/components/portfolio/footer.tsx
autonomous: true
requirements:
  - FOOTER-05

must_haves:
  truths:
    - "Fernando Millan name in footer glitches exactly once when first scrolled into view"
    - "Subsequent scrolls show the static name with no animation repeat"
    - "User with prefers-reduced-motion sees static name with zero animation"
    - "No SSR crash — IntersectionObserver is browser-only, loaded via next/dynamic ssr:false"
    - "React StrictMode double-invoke in development does not cause two glitch fires"
  artifacts:
    - path: "apps/web/components/portfolio/glitch-signature.tsx"
      provides: "GlitchSignature client island with IntersectionObserver single-fire pattern"
      contains: "IntersectionObserver"
    - path: "apps/web/components/portfolio/footer.tsx"
      provides: "Footer shell importing GlitchSignature via next/dynamic ssr:false"
      contains: "next/dynamic"
  key_links:
    - from: "apps/web/components/portfolio/footer.tsx"
      to: "apps/web/components/portfolio/glitch-signature.tsx"
      via: "next/dynamic(() => import('./glitch-signature'), { ssr: false })"
      pattern: "next/dynamic"
    - from: "apps/web/components/portfolio/glitch-signature.tsx"
      to: "apps/web/app/globals.css"
      via: "el.classList.add('footer-glitch-once') triggers CSS keyframe"
      pattern: "footer-glitch-once"
---

<objective>
Create `GlitchSignature` as a `'use client'` island that uses `IntersectionObserver` to add the `.footer-glitch-once` CSS class exactly once when the "Fernando Millan" text scrolls into view. Wire it into `footer.tsx` via `next/dynamic` with `ssr: false`. Reduced-motion users receive static text.

Purpose: Delivers FOOTER-05 — single-fire CSS glitch animation on the footer signature — without SSR crash, memory leaks, or accessibility violations.
Output: `glitch-signature.tsx` (new file) + updated `footer.tsx` with `next/dynamic` import replacing the placeholder span from Plan 33-01.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-footer-redesign-matrix-animation/33-RESEARCH.md
@.planning/phases/33-footer-redesign-matrix-animation/33-01-SUMMARY.md

# Footer from Plan 33-01 — understand the placeholder span to replace
@apps/web/components/portfolio/footer.tsx

# Reference: how next/dynamic + ssr:false is used for MatrixRainCanvas
@apps/web/components/portfolio/hero-section.tsx

# Reference: useReducedMotion + useEffect pattern
@apps/web/components/portfolio/magnetic-button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GlitchSignature client island</name>
  <files>apps/web/components/portfolio/glitch-signature.tsx</files>
  <action>
    Create a new file `apps/web/components/portfolio/glitch-signature.tsx` with the following exact implementation:

    ```tsx
    'use client'

    import { useEffect, useRef, useState } from 'react'
    import { useReducedMotion } from 'motion/react'

    export default function GlitchSignature() {
      const ref = useRef<HTMLSpanElement>(null)
      const [hasGlitched, setHasGlitched] = useState(false)
      const prefersReducedMotion = useReducedMotion()

      useEffect(() => {
        // Reduced-motion: skip observer entirely — no animation class ever added
        // prefersReducedMotion is null on SSR (falsy) — safe per project convention
        // (confirmed from magnetic-button.tsx: null treated as falsy, no hydration mismatch)
        if (prefersReducedMotion) return

        // StrictMode guard: second mount finds hasGlitched=true and skips creating a new observer
        // This prevents two glitch fires in development strict mode
        if (hasGlitched) return

        const el = ref.current
        if (!el) return

        const observer = new IntersectionObserver(
          (entries) => {
            if (entries[0].isIntersecting) {
              // Add glitch CSS class — triggers @keyframes footer-glitch (defined in globals.css)
              // animation-iteration-count: 1 fires exactly once then holds final state (forwards)
              el.classList.add('footer-glitch-once')
              setHasGlitched(true)
              // Disconnect immediately — never fires again, no memory leak
              observer.disconnect()
            }
          },
          { threshold: 0.5 }
        )

        observer.observe(el)

        // Cleanup: disconnect on unmount (handles StrictMode's mount → unmount → remount cycle)
        return () => observer.disconnect()
      }, [prefersReducedMotion, hasGlitched])

      return (
        <span
          ref={ref}
          className="text-lg font-bold font-mono text-foreground"
          aria-label="Fernando Millan"
        >
          Fernando Millan
        </span>
      )
    }
    ```

    Key constraints:
    - `useReducedMotion` from `motion/react` (NOT from framer-motion — project uses motion package)
    - `IntersectionObserver` is browser-only: it MUST NOT be imported or called at module level — it only runs inside `useEffect` which only runs in the browser
    - `observer.disconnect()` must appear BOTH inside the `isIntersecting` branch AND in the useEffect cleanup return
    - `animation-fill-mode: forwards` is already embedded in the `.footer-glitch-once` class in globals.css (written in Plan 33-01): `animation: footer-glitch 0.6s ease-out 1 forwards`
    - Do NOT use `clip-path` in any animation — `transform: skewX()` is the safe approach (already in globals.css keyframe from Plan 33-01)
    - Do NOT add purple to any color values
  </action>
  <verify>
    Run: `grep "IntersectionObserver" apps/web/components/portfolio/glitch-signature.tsx | wc -l`
    Expected: 2 (one `new IntersectionObserver`, one `observer.disconnect` in cleanup).

    Run: `grep "useReducedMotion" apps/web/components/portfolio/glitch-signature.tsx`
    Expected: one match importing from 'motion/react'.

    Run: `grep "observer.disconnect" apps/web/components/portfolio/glitch-signature.tsx | wc -l`
    Expected: 2 (inside isIntersecting branch + useEffect cleanup return).

    Run: `grep "'use client'" apps/web/components/portfolio/glitch-signature.tsx`
    Expected: one match at top of file.
  </verify>
  <done>
    `glitch-signature.tsx` exists with `'use client'`, `useReducedMotion` from `motion/react`, `IntersectionObserver` with `disconnect()` in both success branch and cleanup, `hasGlitched` StrictMode guard, and exports `default function GlitchSignature`.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire GlitchSignature into footer.tsx via next/dynamic</name>
  <files>apps/web/components/portfolio/footer.tsx</files>
  <action>
    Update `footer.tsx` to import `GlitchSignature` via `next/dynamic` with `ssr: false`, and replace the placeholder `<span>` in Column 1 with the dynamic component.

    Add this import at the top of `footer.tsx` (after existing `import Link from 'next/link'`):
    ```tsx
    import dynamic from 'next/dynamic'

    const GlitchSignature = dynamic(
      () => import('./glitch-signature'),
      { ssr: false }
    )
    ```

    Replace the placeholder span in Column 1:
    ```tsx
    {/* Before (Plan 33-01 placeholder): */}
    <span className="text-lg font-bold font-mono text-foreground">
      Fernando Millan
    </span>

    {/* After: */}
    <GlitchSignature />
    ```

    The rest of `footer.tsx` (background, social links, EOF tagline, copyright) stays exactly as written in Plan 33-01. Do NOT change any other part of the file.

    After the edit, verify the build passes:
    Run `npm run build --workspace apps/web` from `/home/doctor/fernandomillan`.
    If build fails with "next/dynamic requires a function that returns a Promise", check that the arrow function wraps the import correctly: `() => import('./glitch-signature')`.
  </action>
  <verify>
    Run: `grep "next/dynamic\|GlitchSignature" apps/web/components/portfolio/footer.tsx`
    Expected: 3 lines — `import dynamic`, `const GlitchSignature = dynamic(`, `<GlitchSignature />`.

    Run: `grep "ssr: false" apps/web/components/portfolio/footer.tsx`
    Expected: one match.

    Run: `grep "placeholder.*Fernando\|<span.*font-bold.*font-mono.*Fernando" apps/web/components/portfolio/footer.tsx`
    Expected: no output (placeholder span replaced by GlitchSignature component).

    Run from /home/doctor/fernandomillan: `npm run build --workspace apps/web 2>&1 | tail -5`
    Expected: build succeeds, no TypeScript errors, no "ReferenceError: IntersectionObserver" during build.
  </verify>
  <done>
    `footer.tsx` imports `GlitchSignature` via `next/dynamic` with `{ ssr: false }`, renders `<GlitchSignature />` in Column 1, build passes. The footer is a Server Component except for the GlitchSignature island. No placeholder span remains.
  </done>
</task>

</tasks>

<verification>
After both tasks:
1. `grep "'use client'" apps/web/components/portfolio/glitch-signature.tsx` — one match
2. `grep "ssr: false" apps/web/components/portfolio/footer.tsx` — one match
3. `grep "footer-glitch-once" apps/web/components/portfolio/glitch-signature.tsx` — one match (classList.add call)
4. `npm run build --workspace apps/web` from /home/doctor/fernandomillan — zero errors
5. No `clip-path` in `glitch-signature.tsx` — transform-only approach confirmed
</verification>

<success_criteria>
- `glitch-signature.tsx` created as `'use client'` island with `IntersectionObserver` single-fire + `observer.disconnect()` in both branches + `hasGlitched` StrictMode guard (FOOTER-05)
- `footer.tsx` loads GlitchSignature via `next/dynamic({ ssr: false })` — no SSR crash
- Reduced-motion: `useReducedMotion()` returns truthy → observer never created → `.footer-glitch-once` never added
- Build passes zero TypeScript errors
- No purple used
</success_criteria>

<output>
After completion, create `.planning/phases/33-footer-redesign-matrix-animation/33-02-SUMMARY.md`
</output>
