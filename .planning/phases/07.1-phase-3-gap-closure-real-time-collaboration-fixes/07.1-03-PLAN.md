---
phase: 07.1-phase-3-gap-closure-real-time-collaboration-fixes
plan: 03
type: execute
wave: 3
depends_on: ["07.1-01", "07.1-02"]
files_modified:
  - apps/web/app/teams/[orgSlug]/projects/[projectId]/components/task-form.tsx
  - apps/web/components/ui/**/*.tsx
autonomous: false
gap_closure: true

must_haves:
  truths:
    - "All text elements meet WCAG AA 4.5:1 minimum contrast ratio"
    - "No white text appears on white backgrounds"
    - "Assignee field shows user name during task creation (no 'unknown user')"
    - "Dark mode preserves contrast ratios and readability"
  artifacts:
    - path: "apps/web/app/teams/[orgSlug]/projects/[projectId]/components/task-form.tsx"
      provides: "Task form with proper assignee display during creation"
      contains: "selectedUser?.name ||"
      min_lines: 200
  key_links:
    - from: "Task form assignee field"
      to: "User select state"
      via: "Displays name immediately on selection"
      pattern: "selectedUser\\.name"
---

<objective>
Fix UI/UX issues including white-on-white text (WCAG violation) and "unknown user" display during task creation

Purpose: Verification identified accessibility failures (white text on white background) and confusing UX ("unknown user" shown when adding assignee during task creation). These are HIGH priority issues affecting usability and compliance.

Output: All text elements meet WCAG AA contrast requirements (4.5:1 minimum), assignee field displays user names correctly during task creation, comprehensive color audit documented
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-phase-3-verification/07-VERIFICATION.md
@.planning/phases/07.1-phase-3-gap-closure-real-time-collaboration-fixes/07.1-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and fix white-on-white text violations</name>
  <files>apps/web/components/ui/**/*.tsx</files>
  <action>
Conduct comprehensive audit to find and fix all white-on-white text and WCAG contrast violations.

Research context: User reported "the colorscheme is a mess some text I cant even see because the color of the text is white and the backgorund is also white there are other instances like that not just white on white I believe other colors". WCAG AA requires 4.5:1 minimum contrast for normal text.

Implementation:
1. Search for potentially problematic patterns:
```bash
cd apps/web
# Find all potential white-on-white combinations
grep -r "bg-white.*text-white" . --include="*.tsx" --include="*.jsx"
grep -r "text-white.*bg-white" . --include="*.tsx" --include="*.jsx"

# Find all text-white usage (check surrounding context for background)
grep -r "text-white" . --include="*.tsx" --include="*.jsx" | head -50

# Find all bg-white usage (check if text color specified)
grep -r "bg-white" . --include="*.tsx" --include="*.jsx" | head -50
```

2. For each violation found, apply WCAG-compliant fix pattern:
```tsx
// BAD - WCAG violation (1:1 contrast ratio):
<div className="bg-white text-white">Text</div>

// GOOD - WCAG AA compliant (17:1 contrast ratio):
<div className="bg-white text-slate-900 dark:bg-slate-900 dark:text-white">
  Text
</div>
```

3. Common fixes by element type:
- Headers on white background: `text-slate-900 dark:text-white`
- Body text on white background: `text-slate-700 dark:text-slate-200` (5.8:1 ratio)
- Muted text on white background: `text-slate-500 dark:text-slate-400` (4.6:1 ratio)
- Text on colored backgrounds: Verify with WebAIM Contrast Checker
- Links: `text-blue-600 hover:text-blue-700 dark:text-blue-400` (4.5:1+ ratio)

4. Priority areas to audit (likely sources based on user report):
- Presence indicators (apps/web/components/presence-indicator.tsx)
- Task cards in Kanban board
- Comment threads
- Form labels and inputs
- Modal/dialog content
- Dropdown menu items

5. Test ALL fixes with WebAIM Contrast Checker: https://webaim.org/resources/contrastchecker/
   - Foreground: Text color
   - Background: Background color
   - Minimum ratio for normal text: 4.5:1
   - Minimum ratio for large text (18pt+): 3:1

Pattern from research: "WCAG Color Contrast Compliance - WCAG AA requires 4.5:1 contrast for normal text, 3:1 for large text"

Why: This is a serious accessibility violation that makes content literally invisible to users. Must fix for WCAG compliance and basic usability.

IMPORTANT: Test in both light AND dark mode. DO NOT introduce new violations while fixing old ones.

Document all changes in a comment at top of each modified file:
```tsx
// WCAG Contrast Fix (Phase 07.1-03): Changed text-white to text-slate-900 for 17:1 contrast ratio
```
  </action>
  <verify>
1. Run grep searches to confirm no white-on-white combinations remain:
   ```bash
   cd apps/web
   grep -r "bg-white.*text-white" . --include="*.tsx" --include="*.jsx"
   grep -r "text-white.*bg-white" . --include="*.tsx" --include="*.jsx"
   # Should return empty results
   ```

2. Test modified components visually:
   - Start dev server: `npm run dev`
   - Navigate to project board, task details, comments
   - Toggle dark mode (if available)
   - Verify all text is readable

3. Spot check 5 modified files with WebAIM Contrast Checker:
   - Copy text color and background color from classes
   - Enter in https://webaim.org/resources/contrastchecker/
   - Verify ratio ≥ 4.5:1 for normal text

4. Run TypeScript compiler: `cd apps/web && npm run type-check`
  </verify>
  <done>
- All white-on-white text violations identified and fixed
- All modified components meet WCAG AA 4.5:1 minimum contrast
- Dark mode preserves contrast ratios (tested if dark mode exists)
- Changes documented with comments explaining WCAG compliance
- No TypeScript errors introduced
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix "unknown user" display in task creation form</name>
  <files>apps/web/app/teams/[orgSlug]/projects/[projectId]/components/task-form.tsx</files>
  <action>
Fix the assignee field in task creation form to display user name immediately when selected, instead of showing "unknown user" until task is saved.

Research context: User reported "when creating a task when I add an asssignee to the task it says unknown user but when the task is created the user does appear". This indicates the form shows placeholder/loading state for selected user.

Root Cause Hypothesis:
- Assignee field may be storing userId (string) instead of full User object
- Display logic may be looking for user.name on incomplete data
- Async user fetch may not complete before render

Implementation:
1. Open task-form.tsx (likely at apps/web/app/teams/[orgSlug]/projects/[projectId]/components/task-form.tsx or similar)

2. Find assignee field (likely uses ComboBox or Select component from Radix UI or similar)

3. Check what's stored in form state when user selects assignee:
   - If storing only userId: Change to store full user object `{ id, name, email, avatarUrl }`
   - If storing user object: Check display logic for null/undefined handling

4. Fix display pattern:
```tsx
// BAD - Shows "unknown user" if data incomplete:
<div>{assignee?.name || 'Unknown user'}</div>

// GOOD - Shows name immediately from form state:
const [selectedUser, setSelectedUser] = useState<User | null>(null);

// In select handler:
const handleAssigneeSelect = (userId: string) => {
  const user = availableUsers.find(u => u.id === userId);
  setSelectedUser(user || null);
  form.setValue('assigneeId', userId);
};

// In display:
<div>
  {selectedUser?.name || 'No assignee'}
</div>
```

5. Ensure user data available:
   - Verify assignee dropdown loads full user objects (with name, email)
   - Don't rely on task.assignee relationship until AFTER task saved
   - Use local form state for display during creation

Pattern: Optimistic UI should show selected values immediately from local state, not wait for server confirmation.

Why: Confusing UX makes users question if selection worked. Shows "unknown user" temporarily breaks trust in the UI.

Note: This may affect task-form.tsx or a shared user-select component. Check imports to find actual component file.
  </action>
  <verify>
1. Open task creation form in browser: Navigate to project board, click "New Task"
2. In "Assignee" field, select a user from dropdown
3. Expected: User's name appears immediately in form (NOT "unknown user")
4. Complete form, click Save
5. Expected: After save, assignee still shows correct user name
6. Test edge cases:
   - Select user, then change to different user (should update display)
   - Select user, then clear selection (should show "No assignee" or empty)
   - Select user with long name (should not overflow or break layout)
7. Check browser console for any errors or warnings
  </verify>
  <done>
- Assignee field displays user name immediately on selection (no "unknown user" placeholder)
- Form stores full user object or properly maps userId to user data
- Edge cases handled: changing selection, clearing selection, long names
- No console errors during task creation flow
- User experience smooth and predictable
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
UI/UX fixes including WCAG contrast compliance audit and "unknown user" fix in task creation form. This addresses HIGH priority accessibility and usability issues identified in Phase 7 verification.
  </what-built>
  <how-to-verify>
**Prerequisites:**
1. Complete Plans 01 and 02 first
2. Start dev server: `npm run dev` from monorepo root
3. Navigate to http://localhost:3000/teams/demo-workspace/projects/marketing-campaign

**Test: White-on-White Text (CRITICAL accessibility issue)**
1. Navigate through all major pages:
   - Project board (Kanban view)
   - Task detail page (open any task)
   - Comments section
   - Team settings page
   - Project list page

2. For each page, verify:
   - All text is clearly readable
   - No white text on white backgrounds
   - No same-color text on same-color backgrounds
   - Headers, body text, labels all have sufficient contrast

3. If dark mode exists:
   - Toggle to dark mode (usually in header or settings)
   - Repeat verification for all pages
   - Check that text remains readable with inverted colors

4. Visual spot checks:
   - Headers should be very dark on light backgrounds (slate-900 or similar)
   - Body text should be dark gray (slate-700 or similar)
   - Muted text should still be readable (slate-500 minimum)
   - Colored backgrounds should have contrasting text (white on blue, etc.)

**Pass Criteria:**
- ✓ All text elements visible and readable
- ✓ No user reports of invisible text
- ✓ Both light and dark modes (if applicable) pass visual inspection

**Test: "Unknown User" in Task Creation**
1. Navigate to project board
2. Click "New Task" or "Add Task" button
3. Fill in task title: "Test Assignee Display"
4. Click on "Assignee" dropdown
5. Select a user (e.g., "Admin User" from demo data)
6. **Critical Check:** Assignee field should immediately show "Admin User"
   - NOT "unknown user"
   - NOT blank or loading spinner
   - User name visible BEFORE clicking Save

7. Test edge cases:
   - Change selection to different user → Should update name immediately
   - Clear selection → Should show "No assignee" or empty state (not "unknown user")
   - Select user with long name → Should display without overflow

8. Click Save
9. Verify: After save, assignee still shows correct user name in task card and detail view

**Pass Criteria:**
- ✓ User name appears immediately on selection (not after save)
- ✓ No "unknown user" placeholder appears at any point
- ✓ Edge cases handled gracefully

**Additional Verification:**
- Check browser console for React errors or warnings
- Test on different screen sizes (desktop, tablet, mobile viewport)
- If you find ANY text that's hard to read, note the location and colors

**Failure Scenarios:**
- If white-on-white text still exists: Note exact component/page location
- If "unknown user" still appears: Note exact steps to reproduce
- If contrast is borderline (hard to read but not invisible): Use WebAIM Contrast Checker to verify ratio
- If dark mode introduces new violations: Document specific components affected
  </how-to-verify>
  <resume-signal>
Respond with:
- "approved" if all text is readable and assignee field works correctly
- "contrast issue: [location]" with page/component where text is hard to read
- "unknown user still appears: [steps]" with exact reproduction steps
- "dark mode issue: [description]" if dark mode has contrast problems
  </resume-signal>
</task>

</tasks>

<verification>
## Success Verification

After plan execution:
- [ ] No white-on-white text combinations in codebase (grep returns empty)
- [ ] All modified components meet WCAG AA 4.5:1 minimum contrast
- [ ] WebAIM Contrast Checker confirms ratios for spot-checked components
- [ ] Assignee field in task-form.tsx shows user name on selection
- [ ] Manual testing (checkpoint) confirms all text readable
- [ ] No "unknown user" placeholder appears during task creation
- [ ] Dark mode (if exists) preserves contrast and readability

## Gap Closure Verification

Phase 7 verification UX issues addressed:
- White-on-white text: Accessibility violation → WCAG AA compliant
- "Unknown user" placeholder: Confusing UX → Immediate name display
- Color contrast: Failed WCAG → Meets 4.5:1 minimum across all components

This plan addresses the HIGH priority UI/UX issues affecting accessibility and user trust.
</verification>

<success_criteria>
## Observable Truths Achieved

1. User views any page → All text is clearly visible and readable
2. User selects assignee in task form → User name appears immediately (not "unknown user")
3. User toggles dark mode → Text remains readable with proper contrast
4. Screen reader user → Content accessible with sufficient contrast for low vision users
5. Color contrast validator → All components pass WCAG AA 4.5:1 minimum

## Requirements Satisfied

- UI-01 (Professional design and polish): Improved with WCAG compliance
- UI-05 (Loading states and empty states): "Unknown user" was false loading state, now fixed
- WCAG 2.1 Level AA compliance: Color contrast criterion satisfied

## Anti-Patterns Avoided

- White text on white backgrounds (1:1 ratio = unusable)
- Insufficient contrast in dark mode (breaks accessibility)
- Placeholder text showing when real data available ("unknown user")
- Ignoring WCAG guidelines (legal/compliance risk)
</success_criteria>

<output>
After completion, create `.planning/phases/07.1-phase-3-gap-closure-real-time-collaboration-fixes/07.1-03-SUMMARY.md` using the standard SUMMARY.md template.

Include:
- List of files modified with contrast fixes
- Specific color combinations changed (before/after)
- WebAIM Contrast Checker results for key components
- Task form assignee field fix implementation details
- Manual test results from checkpoint
- Any remaining accessibility concerns for future work
</output>
