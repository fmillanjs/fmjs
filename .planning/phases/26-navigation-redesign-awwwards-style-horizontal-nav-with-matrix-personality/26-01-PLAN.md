---
phase: 26-navigation-redesign-awwwards-style-horizontal-nav-with-matrix-personality
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/components/portfolio/nav.tsx
  - apps/web/app/globals.css
autonomous: true
requirements:
  - UX-04

must_haves:
  truths:
    - "Hovering a desktop nav link causes a Matrix-green underline to slide in from left to right under the link text"
    - "The active page always shows a persistent Matrix-green underline that is visible without hovering"
    - "Navigating between routes causes the active underline to animate (slide/spring) from the old link to the new one"
    - "With OS prefers-reduced-motion enabled, no underline animation fires — the active indicator appears instantly with no transition"
    - "Nav link text color changes to --matrix-green on hover (desktop) and on the active link (desktop and mobile)"
    - "Mobile active link shows a left-border accent in --matrix-green instead of a bottom underline"
    - "No purple color appears anywhere in the nav"
  artifacts:
    - path: "apps/web/components/portfolio/nav.tsx"
      provides: "Redesigned nav with UX-04 hover underline + Motion layoutId active indicator + Awwwards typography"
      contains: "useReducedMotion"
    - path: "apps/web/app/globals.css"
      provides: "Optional .matrix-theme nav overrides if needed for scoping"
  key_links:
    - from: "apps/web/components/portfolio/nav.tsx"
      to: "motion/react"
      via: "import { motion, useReducedMotion } from 'motion/react'"
      pattern: "useReducedMotion"
    - from: "nav.tsx hover span"
      to: "globals.css reduced-motion rule"
      via: "CSS transition killed by @media (prefers-reduced-motion: reduce) { * { transition-duration: 0.01ms !important } }"
      pattern: "scale-x-0.*group-hover:scale-x-100"
    - from: "motion.span layoutId"
      to: "useReducedMotion() guard"
      via: "conditional render: {pathname === link.href && !prefersReducedMotion && <motion.span .../>}"
      pattern: "layoutId.*nav-active-underline"
---

<objective>
Elevate the portfolio nav to Awwwards quality by implementing UX-04: a CSS-only sliding Matrix-green underline on hover and a Motion layoutId animated active-page indicator. Typography and spacing are also refined to match the v2.5 Matrix aesthetic.

Purpose: The nav is the last major visual piece before the v2.5 release. This plan delivers the complete nav redesign in a single coherent change — one component file (nav.tsx) plus a minimal globals.css update if needed.

Output: Modified nav.tsx with hover underline, active indicator, and Awwwards-grade typography. Verified: TypeScript compiles, Next.js dev server renders correctly.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/components/portfolio/nav.tsx
@apps/web/app/globals.css
@.planning/phases/26-navigation-redesign-awwwards-style-horizontal-nav-with-matrix-personality/26-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement UX-04 — hover underline + active indicator + Awwwards typography in nav.tsx</name>
  <files>apps/web/components/portfolio/nav.tsx</files>
  <action>
Rewrite `apps/web/components/portfolio/nav.tsx` with the following changes. Keep ALL existing imports (Link, usePathname, useState, Menu, X, ThemeToggle, Button, cn) and add new ones. Do NOT use purple anywhere.

**New imports to add:**
```tsx
import { motion, useReducedMotion } from 'motion/react';
```

**Inside PortfolioNav():** Add `const prefersReducedMotion = useReducedMotion();` after the existing hooks.

**Desktop nav link changes** (the `hidden md:flex` div block):
- Change `space-x-6` to `space-x-8` on the desktop links container for more generous Awwwards spacing.
- Change the logo Link className: replace `hover:text-primary` with `hover:text-[var(--matrix-green)]`. Keep `text-xl font-bold text-foreground transition-colors`.
- Replace the entire navLinks.map() for the desktop section with this pattern:

```tsx
{navLinks.map((link) => (
  <Link
    key={link.href}
    href={link.href}
    className={cn(
      'group relative inline-flex flex-col py-1 text-sm font-medium tracking-wide transition-colors',
      pathname === link.href
        ? 'text-[var(--matrix-green)]'
        : 'text-muted-foreground hover:text-[var(--matrix-green)]'
    )}
  >
    {link.label}

    {/* Hover underline — CSS scaleX, GPU-composited, killed automatically by global reduced-motion CSS */}
    <span
      aria-hidden="true"
      className="absolute bottom-0 left-0 h-[2px] w-full bg-[var(--matrix-green)] origin-left scale-x-0 transition-transform duration-[250ms] ease-out group-hover:scale-x-100 z-[1]"
    />

    {/* Active indicator — Motion layoutId for cross-route slide animation */}
    {pathname === link.href && !prefersReducedMotion && (
      <motion.span
        aria-hidden="true"
        layoutId="nav-active-underline"
        className="absolute bottom-0 left-0 h-[2px] w-full bg-[var(--matrix-green)] z-[2]"
        transition={{ type: 'spring', stiffness: 380, damping: 30 }}
      />
    )}
    {/* Reduced motion fallback — static underline, no animation */}
    {pathname === link.href && prefersReducedMotion && (
      <span
        aria-hidden="true"
        className="absolute bottom-0 left-0 h-[2px] w-full bg-[var(--matrix-green)] z-[2]"
      />
    )}
  </Link>
))}
```

**z-index rationale:** hover span `z-[1]`, active Motion span `z-[2]` — active indicator sits on top; hover span still visible on non-active links (no active span present to occlude it).

**Mobile nav link changes** (the `md:hidden` dropdown block):
- Update mobile active link className: replace `bg-primary/10 text-primary` with `border-l-2 border-[var(--matrix-green)] text-[var(--matrix-green)] bg-transparent pl-2` — left-border accent appropriate for vertical list layout.
- Update mobile inactive hover: replace `hover:bg-muted` with `hover:text-[var(--matrix-green)] hover:bg-muted` — add Matrix-green text color on hover.
- Keep `block px-3 py-2 rounded-lg text-base font-medium transition-colors`.

**DO NOT:**
- Do not add `<LayoutGroup>` — only one nav in the DOM, not needed.
- Do not use GSAP — CSS-only for hover, Motion layoutId for active indicator.
- Do not use purple.
- Do not change the `<kbd>` element or `<ThemeToggle />` positioning.
- Do not touch the `mobileMenuOpen` state logic or the Menu/X icon toggle.
  </action>
  <verify>
Run `cd /home/doctor/fernandomillan && npx tsc --project apps/web/tsconfig.json --noEmit 2>&1 | head -30` to confirm no TypeScript errors.

Also check the file was written: `grep -n "useReducedMotion\|nav-active-underline\|scale-x-0\|group-hover:scale-x-100" apps/web/components/portfolio/nav.tsx`
  </verify>
  <done>
- TypeScript reports 0 errors for nav.tsx
- grep finds: `useReducedMotion`, `nav-active-underline`, `scale-x-0`, `group-hover:scale-x-100` all present in nav.tsx
- No `text-primary` or `hover:text-primary` remain on nav links (replaced with matrix-green)
- No purple color anywhere in the file
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify globals.css already covers reduced-motion and add .matrix-theme nav scoping if needed</name>
  <files>apps/web/app/globals.css</files>
  <action>
Read `apps/web/app/globals.css` and confirm the following already exists (it does per Phase 22 decisions):

```css
@media (prefers-reduced-motion: reduce) {
  * {
    transition-duration: 0.01ms !important;
    /* ... */
  }
}
```

If this rule exists with `transition-duration: 0.01ms !important`, NO change is needed to globals.css — the CSS underline animation is already automatically disabled for reduced-motion users.

If the rule is somehow absent (unlikely per STATE.md decisions), add it to the end of globals.css:

```css
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}
```

Additionally, check if `.matrix-theme` has any nav-specific overrides that conflict with the new `text-[var(--matrix-green)]` classes. If there are conflicting `nav a { color: ... }` rules in .matrix-theme scope, add a specificity fix. Most likely no change is needed since the new Tailwind classes use inline `var(--matrix-green)` directly.

**If globals.css already has the reduced-motion rule (expected):** Mark this task done without writing any changes. Document the confirmation in the task output.
  </action>
  <verify>
Run: `grep -n "prefers-reduced-motion\|transition-duration.*0.01ms" apps/web/app/globals.css`

Expected output: lines showing the existing rule.
  </verify>
  <done>
- Confirmation that `prefers-reduced-motion` rule with `transition-duration: 0.01ms !important` exists in globals.css
- No conflicting nav color rules in .matrix-theme scope that would override the new Tailwind classes
  </done>
</task>

</tasks>

<verification>
After both tasks complete, run the Next.js dev server and do a quick manual check:

```bash
cd /home/doctor/fernandomillan && docker ps | grep web
# If no container: pnpm --filter web dev
```

Navigate to http://localhost:3000 and verify:
1. Hovering a nav link shows a green underline sliding in from left
2. The active page has a persistent green underline
3. TypeScript and build have no errors

Also run: `npx tsc --project apps/web/tsconfig.json --noEmit`
</verification>

<success_criteria>
- nav.tsx compiles with 0 TypeScript errors
- `useReducedMotion` imported from `motion/react` (not framer-motion)
- `layoutId="nav-active-underline"` present on motion.span inside desktop nav
- `scale-x-0 group-hover:scale-x-100` present on hover underline span
- `tracking-wide` added to desktop nav link classes (Awwwards typography)
- Mobile active link uses `border-l-2 border-[var(--matrix-green)]` (left-border accent)
- No purple color anywhere in nav.tsx or globals.css changes
- globals.css prefers-reduced-motion rule confirmed present
</success_criteria>

<output>
After completion, create `.planning/phases/26-navigation-redesign-awwwards-style-horizontal-nav-with-matrix-personality/26-01-SUMMARY.md` with:
- What was changed in nav.tsx (list each class/import change)
- Whether globals.css was modified (expected: no change needed)
- TypeScript verification result
- Any deviations from the plan and why
</output>
