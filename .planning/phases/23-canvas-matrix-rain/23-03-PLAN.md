---
phase: 23-canvas-matrix-rain
plan: 03
type: execute
wave: 2
depends_on:
  - 23-01
files_modified:
  - apps/web/e2e/portfolio/visual-regression.spec.ts-snapshots/homepage-light-chromium-linux.png
  - apps/web/e2e/portfolio/visual-regression.spec.ts-snapshots/homepage-dark-chromium-linux.png
autonomous: false
requirements:
  - ANIM-02

must_haves:
  truths:
    - "Playwright visual regression tests pass after the canvas is added to the hero section"
    - "homepage-light and homepage-dark snapshots reflect the hero section with the canvas layer"
    - "All other portfolio snapshots (about, projects, contact, resume, teamflow) remain unchanged"
  artifacts:
    - path: "apps/web/e2e/portfolio/visual-regression.spec.ts-snapshots/homepage-light-chromium-linux.png"
      provides: "Updated homepage light-mode snapshot including canvas layer"
    - path: "apps/web/e2e/portfolio/visual-regression.spec.ts-snapshots/homepage-dark-chromium-linux.png"
      provides: "Updated homepage dark-mode snapshot including canvas layer"
  key_links:
    - from: "apps/web/e2e/portfolio/visual-regression.spec.ts"
      to: "visual-regression.spec.ts-snapshots/"
      via: "toHaveScreenshot with maxDiffPixelRatio: 0.02"
      pattern: "homepage.*light|homepage.*dark"
---

<objective>
Regenerate Playwright visual regression snapshots for the homepage after the Matrix rain canvas is added.

Purpose: The canvas changes pixel values in the hero section. The existing `homepage-light.png` and `homepage-dark.png` snapshots will fail against `maxDiffPixelRatio: 0.02` because the canvas layer is now visible. Snapshots must be regenerated to accept the new baseline.
Output: Updated homepage-light and homepage-dark snapshot files. All other route snapshots remain unchanged.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-canvas-matrix-rain/23-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Regenerate homepage visual regression snapshots</name>
  <files>
    apps/web/e2e/portfolio/visual-regression.spec.ts-snapshots/homepage-light-chromium-linux.png
    apps/web/e2e/portfolio/visual-regression.spec.ts-snapshots/homepage-dark-chromium-linux.png
  </files>
  <action>
    First, verify the dev server is available. Check if a Docker container is running the apps/web dev server on port 3000:
    ```bash
    docker ps 2>/dev/null | grep -E "3000|apps/web|portfolio" || true
    ```

    Then regenerate ONLY the homepage snapshots using Playwright's `--update-snapshots` flag with a grep filter to limit to homepage tests only. Run from `/home/doctor/fernandomillan/apps/web`:

    ```bash
    npx playwright test e2e/portfolio/visual-regression.spec.ts --update-snapshots --grep "homepage"
    ```

    The `--grep "homepage"` flag limits regeneration to only the `homepage` named tests in the visual regression suite, leaving all other snapshots (about, projects, teamflow, contact, resume) untouched.

    If the dev server is not running (Playwright needs a running server to take screenshots), start it first. Check `playwright.config.ts` to understand how Playwright handles the server — if it has `webServer` config it will start it automatically. If not, ensure the dev server is running.

    The canvas is animated at runtime; Playwright captures a static frame mid-animation. The snapshot will capture whatever frame is rendered at `waitForLoadState('networkidle')`. This is expected and the snapshot will be a valid baseline for future runs.

    Do NOT run `--update-snapshots` without `--grep "homepage"` — that would regenerate all portfolio snapshots unnecessarily.
  </action>
  <verify>
    Run without `--update-snapshots` to confirm tests pass now:
    ```bash
    npx playwright test e2e/portfolio/visual-regression.spec.ts --grep "homepage"
    ```
    Both `homepage` light and dark tests pass (exit code 0).

    Confirm the other portfolio snapshot tests still pass:
    ```bash
    npx playwright test e2e/portfolio/visual-regression.spec.ts --grep-invert "homepage"
    ```
    All non-homepage tests pass (exit code 0).
  </verify>
  <done>
    `npx playwright test e2e/portfolio/visual-regression.spec.ts` exits with code 0. All 12 snapshot tests pass (6 routes × light + dark). Homepage snapshots have been regenerated to include the canvas layer baseline.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify accessibility tests confirm canvas aria-hidden passes axe-core</name>
  <what-built>
    Task 1 regenerated homepage visual regression snapshots. The Matrix rain canvas was added to the hero section in Plan 01 with `aria-hidden="true"` so the element is invisible to the accessibility tree. This checkpoint confirms axe-core reports zero violations on the homepage.
  </what-built>
  <how-to-verify>
    Run the homepage accessibility test from `/home/doctor/fernandomillan/apps/web`:
    ```bash
    npx playwright test e2e/portfolio/accessibility.spec.ts --grep "/"
    ```

    Expected: exit code 0, zero axe violations in both light and dark modes.

    If violations are reported, check whether any involve the canvas element. The canvas with `aria-hidden="true"` should not trigger `canvas-missing-best-practice` or `aria-required-children` violations. Do NOT suppress violations — investigate and report exactly what axe-core flagged.
  </how-to-verify>
  <resume-signal>
    Type "passed" if the homepage accessibility tests exit with code 0 and zero violations, or paste the axe-core violation output and describe which element triggered each violation.
  </resume-signal>
  <verify>
    `npx playwright test e2e/portfolio/accessibility.spec.ts --grep "/"` exits with code 0 — zero axe violations on the homepage in both light and dark modes.
  </verify>
  <done>
    Homepage accessibility tests pass. Zero axe-core violations. Canvas element with `aria-hidden="true"` is invisible to the accessibility tree.
  </done>
</task>

</tasks>

<verification>
After both tasks:
1. `npx playwright test e2e/portfolio/visual-regression.spec.ts` — all 12 tests pass
2. `npx playwright test e2e/portfolio/accessibility.spec.ts --grep "/"` — passes with zero violations
3. `ls apps/web/e2e/portfolio/visual-regression.spec.ts-snapshots/homepage-*` — both light and dark PNG files exist and have recent modification times
</verification>

<success_criteria>
- All 12 visual regression tests pass (no diff failures)
- Homepage snapshots reflect the new canvas layer as the accepted baseline
- All other portfolio route snapshots are unchanged
- Homepage accessibility tests pass (zero axe violations, canvas is aria-hidden)
</success_criteria>

<output>
After completion, create `.planning/phases/23-canvas-matrix-rain/23-03-SUMMARY.md`
</output>
