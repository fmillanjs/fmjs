---
phase: 04-portfolio-polish
plan: 09
type: execute
wave: 4
depends_on: ["04-08"]
files_modified:
  - apps/web/playwright.config.ts
  - apps/web/e2e/auth/login.spec.ts
  - apps/web/e2e/auth/signup.spec.ts
  - apps/web/e2e/auth/auth.setup.ts
  - apps/web/e2e/portfolio/navigation.spec.ts
  - apps/web/package.json
  - apps/web/.gitignore
autonomous: true

must_haves:
  truths:
    - "Playwright runs E2E tests for authentication flows"
    - "Login test verifies successful authentication and redirect"
    - "Invalid credentials test shows error message"
    - "Portfolio navigation test verifies all pages load"
  artifacts:
    - path: "apps/web/playwright.config.ts"
      provides: "Playwright configuration with web server"
    - path: "apps/web/e2e/auth/login.spec.ts"
      provides: "Login E2E tests"
    - path: "apps/web/e2e/auth/signup.spec.ts"
      provides: "Signup E2E tests"
    - path: "apps/web/e2e/auth/auth.setup.ts"
      provides: "Auth state setup for reuse"
    - path: "apps/web/e2e/portfolio/navigation.spec.ts"
      provides: "Portfolio page navigation tests"
  key_links:
    - from: "apps/web/playwright.config.ts"
      to: "apps/web/e2e/"
      via: "testDir configuration"
      pattern: "testDir.*e2e"
    - from: "apps/web/e2e/auth/auth.setup.ts"
      to: "playwright/.auth/user.json"
      via: "stored auth state"
      pattern: "storageState.*auth"
---

<objective>
Set up Playwright for E2E testing and write authentication flow tests plus portfolio navigation tests.

Purpose: E2E tests prove the application works end-to-end from a user's perspective. Auth E2E tests are the most valuable — they verify the critical security path.
Output: Playwright configured, auth flow E2E tests, portfolio navigation tests.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-portfolio-polish/04-RESEARCH.md
@.planning/phases/04-portfolio-polish/04-08-SUMMARY.md
@apps/web/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Playwright Setup and Auth E2E Tests</name>
  <files>
    apps/web/package.json
    apps/web/playwright.config.ts
    apps/web/e2e/auth/auth.setup.ts
    apps/web/e2e/auth/login.spec.ts
    apps/web/e2e/auth/signup.spec.ts
    apps/web/.gitignore
  </files>
  <action>
    Set up Playwright and write authentication E2E tests:

    1. **Install Playwright** in apps/web:
       ```
       npm install -D @playwright/test
       npx playwright install chromium
       ```

    2. **Playwright config** (apps/web/playwright.config.ts):
       ```typescript
       import { defineConfig, devices } from '@playwright/test'

       export default defineConfig({
         testDir: './e2e',
         fullyParallel: true,
         forbidOnly: !!process.env.CI,
         retries: process.env.CI ? 2 : 0,
         workers: process.env.CI ? 1 : undefined,
         reporter: 'html',
         use: {
           baseURL: 'http://localhost:3000',
           trace: 'on-first-retry',
         },
         projects: [
           { name: 'setup', testMatch: /.*\.setup\.ts/ },
           {
             name: 'chromium',
             use: {
               ...devices['Desktop Chrome'],
               storageState: 'playwright/.auth/user.json',
             },
             dependencies: ['setup'],
           },
         ],
         webServer: {
           command: 'npm run dev',
           url: 'http://localhost:3000',
           reuseExistingServer: !process.env.CI,
         },
       })
       ```

    3. **Update .gitignore**: Add `playwright/.auth/`, `playwright-report/`, `test-results/`

    4. **Add test script** to apps/web/package.json:
       - "test:e2e": "playwright test"
       - "test:e2e:ui": "playwright test --ui"

    5. **Auth setup** (apps/web/e2e/auth/auth.setup.ts):
       - Use `test as setup` from @playwright/test
       - Navigate to /login
       - Fill in demo credentials: demo1@teamflow.dev / Password123
       - Submit and wait for redirect to dashboard
       - Save storage state to playwright/.auth/user.json

    6. **Login tests** (apps/web/e2e/auth/login.spec.ts):
       - Test: "login page loads" — navigate to /login, expect heading/form visible
       - Test: "successful login redirects to dashboard" — use demo credentials, verify redirect
       - Test: "invalid credentials show error" — wrong password, expect error message visible
       - Test: "empty form shows validation errors" — click submit without filling, expect field errors
       - Do NOT use stored auth state for login tests (they test the login flow itself)
       - Use `test.use({ storageState: { cookies: [], origins: [] } })` to clear auth state

    7. **Signup tests** (apps/web/e2e/auth/signup.spec.ts):
       - Test: "signup page loads" — navigate to /signup, expect form visible
       - Test: "signup with valid data creates account" — fill form with unique email (use timestamp), verify redirect
       - Test: "signup with existing email shows error" — use demo1@teamflow.dev, expect error
       - Test: "signup validates password requirements" — weak password, expect error
       - Use `test.use({ storageState: { cookies: [], origins: [] } })` to clear auth state

    Note: These tests require Docker containers (Postgres, Redis) and both dev servers running.
    The playwright config's webServer starts the Next.js dev server. The API server must also be running.
    Add a comment in the config noting the API server requirement.
  </action>
  <verify>
    - Playwright config exists with web server configuration
    - Auth setup file saves storage state
    - Login tests cover success, failure, and validation
    - Signup tests cover success, duplicate, and validation
    - `npx playwright test --list` shows all test files (doesn't need to run them)
  </verify>
  <done>
    Playwright configured with auth state management. Login tests verify successful auth, invalid credentials, and form validation. Signup tests verify account creation and duplicate prevention. Tests are ready to run when dev servers are active.
  </done>
</task>

<task type="auto">
  <name>Task 2: Portfolio Navigation E2E Tests</name>
  <files>
    apps/web/e2e/portfolio/navigation.spec.ts
  </files>
  <action>
    Write E2E tests verifying portfolio pages load and navigation works:

    1. **Portfolio navigation tests** (apps/web/e2e/portfolio/navigation.spec.ts):
       - These tests do NOT require auth (portfolio is public)
       - Use `test.use({ storageState: { cookies: [], origins: [] } })` to ensure no auth

       Test cases:
       - "home page loads with hero section" — navigate to /, expect heading text visible
       - "about page loads with bio" — navigate to /about, expect heading and tech stack section
       - "projects page loads with TeamFlow" — navigate to /projects, expect TeamFlow project card
       - "case study page loads with all sections" — navigate to /projects/teamflow, expect key section headings (Problem, Solution, Architecture, etc.)
       - "resume page loads with download link" — navigate to /resume, expect heading and download button/link
       - "contact page loads with form" — navigate to /contact, expect form fields (Name, Email, Message) and submit button
       - "navigation links work" — click each nav link, verify URL changes
       - "404 page shows for invalid routes" — navigate to /nonexistent, expect 404 content
       - "mobile navigation works" — set viewport to mobile size, verify hamburger menu appears and opens

    Each test:
    - Use `expect(page.locator(...)).toBeVisible()` for element checks
    - Use `await page.waitForLoadState('domcontentloaded')` if needed
    - Use semantic selectors (getByRole, getByText) where possible
  </action>
  <verify>
    - Portfolio navigation tests exist with 8+ test cases
    - Tests cover all portfolio pages (home, about, projects, case study, resume, contact)
    - Tests include 404 verification
    - Tests include mobile viewport test
    - `npx playwright test --list` shows the navigation spec
  </verify>
  <done>
    Portfolio navigation E2E tests verify all pages load correctly, navigation works between pages, 404 is handled, and mobile viewport renders correctly.
  </done>
</task>

</tasks>

<verification>
- Playwright configured with chromium browser
- Auth E2E tests: login success/failure, signup success/failure
- Portfolio tests: all 6 pages load, navigation works, 404 works
- `npx playwright test --list` shows all test files
- Tests ready to run when dev servers active
</verification>

<success_criteria>
Playwright is configured with auth state management. Authentication flows have E2E tests covering success and failure paths. Portfolio pages have navigation E2E tests. All tests are discoverable by Playwright test runner.
</success_criteria>

<output>
After completion, create `.planning/phases/04-portfolio-polish/04-09-SUMMARY.md`
</output>
