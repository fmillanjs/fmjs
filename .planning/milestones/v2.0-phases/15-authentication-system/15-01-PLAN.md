---
phase: 15-authentication-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/devcollab-database/prisma/schema.prisma
  - .env
  - .env.example
  - docker-compose.yml
autonomous: true
requirements:
  - AUTH-01
  - AUTH-02

must_haves:
  truths:
    - "The DevCollab Postgres User table has a `password` column (bcrypt-ready, non-nullable)"
    - "A Prisma migration file exists recording the password column addition"
    - "DEVCOLLAB_JWT_SECRET is present in .env, .env.example, and docker-compose.yml environment stanzas"
    - "DEVCOLLAB_JWT_SECRET is a different key from JWT_SECRET (TeamFlow isolation preserved)"
  artifacts:
    - path: "packages/devcollab-database/prisma/schema.prisma"
      provides: "User model with password String field"
      contains: "password  String"
    - path: "packages/devcollab-database/prisma/migrations/*/migration.sql"
      provides: "Generated Prisma migration adding password column"
      contains: "password"
    - path: ".env"
      provides: "DEVCOLLAB_JWT_SECRET local dev value"
      contains: "DEVCOLLAB_JWT_SECRET"
    - path: "docker-compose.yml"
      provides: "DEVCOLLAB_JWT_SECRET env var wired into devcollab-api service"
      contains: "DEVCOLLAB_JWT_SECRET"
  key_links:
    - from: "packages/devcollab-database/prisma/schema.prisma"
      to: "packages/devcollab-database/prisma/migrations/"
      via: "prisma migrate dev"
      pattern: "migration\\.sql"
    - from: ".env"
      to: "docker-compose.yml"
      via: "${DEVCOLLAB_JWT_SECRET} variable substitution"
      pattern: "DEVCOLLAB_JWT_SECRET"
---

<objective>
Add `password String` to the DevCollab Prisma User model, run the migration, and add DEVCOLLAB_JWT_SECRET to all environment configuration files.

Purpose: Auth service in Phase 15-03 needs the password column in Postgres to store bcrypt hashes. The JWT secret must be present at runtime for JwtService to sign tokens. Neither can be added mid-feature without breaking the build.
Output: Migration applied to devcollab-postgres; env vars wired into .env, .env.example, and docker-compose.yml.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-authentication-system/15-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add password field to Prisma User model and run migration</name>
  <files>
    packages/devcollab-database/prisma/schema.prisma
    packages/devcollab-database/prisma/migrations/
  </files>
  <action>
    Open `packages/devcollab-database/prisma/schema.prisma`. Find the `User` model which currently has: id, email, name, createdAt, updatedAt. Add `password  String` as a required (non-nullable) field between `name` and `createdAt`:

    ```prisma
    model User {
      id        String   @id @default(cuid())
      email     String   @unique
      name      String?
      password  String
      createdAt DateTime @default(now())
      updatedAt DateTime @updatedAt

      @@index([email])
    }
    ```

    Then run the migration from the monorepo root:
    ```bash
    npx prisma migrate dev \
      --schema=packages/devcollab-database/prisma/schema.prisma \
      --name add_password_to_user
    ```

    The DEVCOLLAB_DATABASE_URL must be set (or the devcollab-postgres Docker container must be running on port 5435). If the database is not running, generate only the migration file without applying it:
    ```bash
    npx prisma migrate dev \
      --schema=packages/devcollab-database/prisma/schema.prisma \
      --name add_password_to_user \
      --create-only
    ```
    The migration SQL file will be committed and applied when `devcollab-migrate` runs at docker compose up. If the database IS reachable, run without `--create-only`.

    Do NOT run `prisma generate` here — the client is regenerated automatically by `migrate dev`.
  </action>
  <verify>
    1. `packages/devcollab-database/prisma/schema.prisma` contains `password  String` — grep confirms.
    2. A new directory under `packages/devcollab-database/prisma/migrations/` exists with a `migration.sql` file containing `ALTER TABLE` or `CREATE TABLE` referencing `password`.
    3. Run: `grep -r "password" packages/devcollab-database/prisma/migrations/` — output shows migration SQL.
  </verify>
  <done>Schema has password field; migration file committed; Prisma client can be regenerated cleanly.</done>
</task>

<task type="auto">
  <name>Task 2: Add DEVCOLLAB_JWT_SECRET and DEVCOLLAB_WEB_URL to environment files</name>
  <files>
    .env
    .env.example
    docker-compose.yml
  </files>
  <action>
    Three files need updating. IMPORTANT: Do NOT change TeamFlow's JWT_SECRET. The new variable must have a distinct name.

    **1. `.env`** — add under the DevCollab section (or append if no section exists):
    ```
    # DevCollab Auth
    DEVCOLLAB_JWT_SECRET=devcollab-dev-secret-change-in-production
    DEVCOLLAB_WEB_URL=http://localhost:3002
    ```
    If a `# DevCollab` section already exists, add alongside existing vars. If `.env` does not exist yet (only `.env.example` exists), create it or check — the file should exist from Phase 14.

    **2. `.env.example`** — add the same keys with placeholder values:
    ```
    # DevCollab Auth
    DEVCOLLAB_JWT_SECRET=your-devcollab-jwt-secret-here
    DEVCOLLAB_WEB_URL=http://localhost:3002
    ```

    **3. `docker-compose.yml`** — under the `devcollab-api` service `environment:` stanza, add:
    ```yaml
          DEVCOLLAB_JWT_SECRET: ${DEVCOLLAB_JWT_SECRET}
          DEVCOLLAB_WEB_URL: ${DEVCOLLAB_WEB_URL:-http://localhost:3002}
    ```
    Find the `devcollab-api:` service block in docker-compose.yml, locate its `environment:` section, and append these two lines with proper YAML indentation (matching existing entries). Do NOT touch any other service's environment block.
  </action>
  <verify>
    1. `grep DEVCOLLAB_JWT_SECRET .env` — returns the key with a value.
    2. `grep DEVCOLLAB_JWT_SECRET .env.example` — returns placeholder.
    3. `grep DEVCOLLAB_JWT_SECRET docker-compose.yml` — returns the variable reference under devcollab-api service.
    4. `grep JWT_SECRET .env | grep -v DEVCOLLAB` — returns TeamFlow's JWT_SECRET unchanged (verify isolation).
    5. `grep DEVCOLLAB_WEB_URL docker-compose.yml` — returns the variable reference.
  </verify>
  <done>DEVCOLLAB_JWT_SECRET in .env, .env.example, docker-compose.yml; TeamFlow JWT_SECRET untouched; DEVCOLLAB_WEB_URL added.</done>
</task>

</tasks>

<verification>
After both tasks:
1. `grep "password" packages/devcollab-database/prisma/schema.prisma` shows `password  String`
2. A migration file exists: `ls packages/devcollab-database/prisma/migrations/*/migration.sql`
3. `grep DEVCOLLAB_JWT_SECRET .env .env.example docker-compose.yml` — all three files contain the key
4. `grep JWT_SECRET .env` — shows both JWT_SECRET (TeamFlow) and DEVCOLLAB_JWT_SECRET (DevCollab) as separate entries — confirms isolation
</verification>

<success_criteria>
- `packages/devcollab-database/prisma/schema.prisma` User model contains `password  String`
- A Prisma migration file under `packages/devcollab-database/prisma/migrations/` records the addition
- `DEVCOLLAB_JWT_SECRET` present in .env, .env.example, docker-compose.yml
- `DEVCOLLAB_WEB_URL` present in docker-compose.yml (with default value fallback)
- TeamFlow's `JWT_SECRET` is unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/15-authentication-system/15-01-SUMMARY.md`
</output>