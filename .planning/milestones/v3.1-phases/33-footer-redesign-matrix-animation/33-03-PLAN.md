---
phase: 33-footer-redesign-matrix-animation
plan: "03"
type: execute
wave: 3
depends_on:
  - "33-01"
  - "33-02"
files_modified:
  - apps/web/e2e/portfolio/visual-regression.spec.ts-snapshots/
  - apps/web/e2e/portfolio/accessibility.spec.ts
autonomous: false
requirements:
  - FOOTER-06
  - FOOTER-07

must_haves:
  truths:
    - "All footer links receive a visible Matrix green focus ring when navigated to by keyboard"
    - "axe-core WCAG AA audit reports zero violations on all portfolio routes after footer redesign"
    - "All 18 Playwright visual regression snapshots pass at maxDiffPixelRatio 0.02 after baseline update"
    - "Dashboard snapshots (6 PNGs) are unchanged — no Matrix green footer bleed into dashboard routes"
    - "Reduced-motion users see a static footer — GlitchSignature never fires animation class"
  artifacts:
    - path: "apps/web/e2e/portfolio/visual-regression.spec.ts-snapshots/"
      provides: "Updated visual regression baselines for all 6 portfolio routes (12 PNGs light+dark)"
      contains: "footer"
    - path: "apps/web/e2e/portfolio/accessibility.spec.ts"
      provides: "Passing WCAG AA axe audit on all 6 portfolio routes in light + dark mode"
      contains: "wcag2aa"
  key_links:
    - from: "apps/web/e2e/portfolio/visual-regression.spec.ts"
      to: "apps/web/e2e/portfolio/visual-regression.spec.ts-snapshots/"
      via: "npx playwright test --config=playwright.visual.config.ts --update-snapshots"
      pattern: "toHaveScreenshot"
    - from: "apps/web/e2e/portfolio/accessibility.spec.ts"
      to: "apps/web/components/portfolio/footer.tsx"
      via: "axe-core AxeBuilder analyzing rendered footer HTML"
      pattern: "wcag2aa"
---

<objective>
Verify and lock the final footer state: run axe-core WCAG AA audit confirming zero violations, verify all footer links have visible keyboard focus rings, update all 18 Playwright visual regression baselines (12 portfolio + 6 dashboard) with the new terminal footer, and confirm dashboard snapshots are unchanged.

Purpose: Delivers FOOTER-06 (keyboard accessibility) and FOOTER-07 (all 18 snapshots passing). This is the phase completion gate — no code changes, only verification and baseline updates.
Output: Updated snapshot PNGs in the two snapshot directories. Human visual approval of the new footer appearance.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-footer-redesign-matrix-animation/33-RESEARCH.md
@.planning/phases/33-footer-redesign-matrix-animation/33-01-SUMMARY.md
@.planning/phases/33-footer-redesign-matrix-animation/33-02-SUMMARY.md

# Playwright test files — understand test structure before running
@apps/web/e2e/portfolio/visual-regression.spec.ts
@apps/web/e2e/portfolio/accessibility.spec.ts
@apps/web/playwright.visual.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run axe accessibility audit and verify keyboard focus rings</name>
  <files>apps/web/e2e/portfolio/accessibility.spec.ts</files>
  <action>
    Step 1 — Confirm dev server is running. Check if a Next.js dev server is already running on port 3000:
    ```bash
    curl -s -o /dev/null -w "%{http_code}" http://localhost:3000 2>/dev/null
    ```
    If response is not 200, start the dev server in background:
    ```bash
    cd /home/doctor/fernandomillan && npm run dev --workspace apps/web &
    # Wait for server to be ready
    sleep 8
    ```

    Step 2 — Run the axe WCAG AA accessibility tests across all portfolio routes:
    ```bash
    cd /home/doctor/fernandomillan/apps/web && npx playwright test e2e/portfolio/accessibility.spec.ts --config=playwright.config.ts 2>&1
    ```

    If the test runner fails to find `playwright.config.ts`, try:
    ```bash
    cd /home/doctor/fernandomillan/apps/web && npx playwright test e2e/portfolio/accessibility.spec.ts 2>&1
    ```

    Step 3 — Parse the output. Expected: all 12 tests pass (6 routes x 2 modes), zero axe violations.

    If there are axe violations related to the footer:
    - Color contrast on `text-muted-foreground` against `#0a0a0a` background: If axe reports insufficient contrast, change muted foreground elements to `text-[var(--matrix-terminal)]` or a higher-contrast value. Do NOT use purple.
    - Missing `role` on `<footer>`: HTML `<footer>` element has implicit `role="contentinfo"` — no action needed.
    - Duplicate landmark: If axe reports "contentinfo" used more than once, verify layout.tsx doesn't render another `<footer>`.
    - `aria-label` missing on social links: All three links have `aria-label` from Plan 33-01. Verify they are present.

    After fixing any violations, re-run until all pass.

    Step 4 — Keyboard focus ring grep verification:
    ```bash
    grep "focus-visible:ring-2" apps/web/components/portfolio/footer.tsx | wc -l
    ```
    Expected: 7 lines (4 nav links + 3 social links).
  </action>
  <verify>
    Run: `cd /home/doctor/fernandomillan/apps/web && npx playwright test e2e/portfolio/accessibility.spec.ts 2>&1 | tail -10`
    Expected: "12 passed" with "0 failed".

    Run: `grep "focus-visible:ring-2" apps/web/components/portfolio/footer.tsx | wc -l`
    Expected: 7 or more.

    Run: `grep "focus-visible:ring-offset-\[#0a0a0a\]" apps/web/components/portfolio/footer.tsx | wc -l`
    Expected: 7 or more (ring-offset matches footer background).
  </verify>
  <done>
    All axe accessibility tests pass (zero violations on all portfolio routes in light and dark mode). All footer links have `focus-visible:ring-2 focus-visible:ring-[var(--matrix-green)] focus-visible:ring-offset-[#0a0a0a]` classes confirmed by grep.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update all 18 Playwright visual regression baselines</name>
  <files>apps/web/e2e/portfolio/visual-regression.spec.ts-snapshots/</files>
  <action>
    The footer redesign changed the visual appearance of all 6 portfolio routes. All 12 portfolio baselines must be regenerated. The 6 dashboard baselines must remain unchanged.

    Step 1 — Confirm dev server is running on port 3000 (see Task 1 for start command if needed).

    Step 2 — Update portfolio visual regression baselines:
    ```bash
    cd /home/doctor/fernandomillan/apps/web && npx playwright test --config=playwright.visual.config.ts --update-snapshots 2>&1 | tail -20
    ```

    This regenerates all 12 portfolio PNGs (6 routes x light/dark) with `reducedMotion: 'reduce'` active.
    The GlitchSignature animation duration drops to 0.01ms via the global prefers-reduced-motion CSS rule in globals.css — renders as static text in all snapshots.

    Step 3 — Verify all 18 pass without `--update-snapshots` flag:
    ```bash
    cd /home/doctor/fernandomillan/apps/web && npx playwright test --config=playwright.visual.config.ts 2>&1 | tail -20
    ```
    Expected: 12 passed (portfolio tests), all at maxDiffPixelRatio 0.02.

    Step 4 — Confirm dashboard baselines are UNCHANGED:
    ```bash
    cd /home/doctor/fernandomillan && git diff --stat apps/web/e2e/dashboard/visual-regression.spec.ts-snapshots/ 2>/dev/null
    ```
    Expected: no output — dashboard snapshots must show zero changes.

    Step 5 — Check how many portfolio snapshot files changed:
    ```bash
    cd /home/doctor/fernandomillan && git diff --stat apps/web/e2e/portfolio/visual-regression.spec.ts-snapshots/ 2>/dev/null
    ```
    Expected: 12 files changed (all 6 routes x 2 themes).

    Step 6 — Stage the updated portfolio snapshots:
    ```bash
    cd /home/doctor/fernandomillan && git add apps/web/e2e/portfolio/visual-regression.spec.ts-snapshots/
    ```

    IMPORTANT: Do NOT stage dashboard snapshot changes if any appear. If dashboard snapshots changed unexpectedly, investigate — the footer should not affect dashboard routes (no `.matrix-theme` class on dashboard layout).
  </action>
  <verify>
    Run: `cd /home/doctor/fernandomillan/apps/web && npx playwright test --config=playwright.visual.config.ts 2>&1 | grep -E "passed|failed"`
    Expected: "12 passed" with "0 failed".

    Run: `cd /home/doctor/fernandomillan && git diff --stat apps/web/e2e/dashboard/ 2>/dev/null`
    Expected: no output (dashboard unchanged).

    Run: `cd /home/doctor/fernandomillan && git diff --staged --stat apps/web/e2e/portfolio/visual-regression.spec.ts-snapshots/ 2>/dev/null | wc -l`
    Expected: 12 or more lines (12 PNG files staged).
  </verify>
  <done>
    All 12 portfolio visual regression snapshots updated and passing at maxDiffPixelRatio 0.02. Dashboard 6 snapshots unchanged. Updated PNGs staged in git.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Human visual approval of terminal footer</name>
  <files>apps/web/components/portfolio/footer.tsx</files>
  <action>
    Pause for human visual verification. All automated work is complete (Tasks 1 and 2). The user must now open the browser and confirm the terminal-themed footer looks correct across all portfolio routes.
  </action>
  <verify>
    Human confirms all visual aspects of the footer meet the FOOTER-01 through FOOTER-07 requirements as described in how-to-verify below.
  </verify>
  <done>
    User types "approved" confirming the terminal footer is visually correct on all portfolio routes.
  </done>
  <what-built>
    Complete terminal-themed footer across all portfolio routes:
    - #0a0a0a background with Matrix green top border (FOOTER-01)
    - Terminal-prompt social links: > github, > linkedin, > email in monospace green (FOOTER-02)
    - > EOF narrative tagline before copyright (FOOTER-03)
    - CRT scanline texture via CSS ::before (FOOTER-04)
    - Single-fire CSS glitch on "Fernando Millan" signature on first scroll-into-view (FOOTER-05)
    - Keyboard focus rings on all links (FOOTER-06)
    - All 18 Playwright baselines passing (FOOTER-07)
  </what-built>
  <how-to-verify>
    1. Open http://localhost:3000 in your browser (or start: cd /home/doctor/fernandomillan && npm run dev --workspace apps/web)
    2. Scroll to the bottom of the homepage — confirm:
       - Footer is dark (#0a0a0a) with a green top border
       - Social links show "> github", "> linkedin", "> email" in monospace green
       - "> EOF" text appears above the copyright line
       - A subtle horizontal scanline texture overlays the footer (may be very faint — this is correct)
    3. Scroll back up to top, then scroll back down to see the footer — "Fernando Millan" should glitch exactly once on first entry
    4. Scroll away and scroll back — name is static on second view (no repeat glitch)
    5. Tab through the footer — all links get a visible green focus ring
    6. Visit http://localhost:3000/about, /projects, /contact, /projects/teamflow, /resume — confirm footer appears consistently on all pages
    7. If possible, open TeamFlow dashboard (/dashboard or /w/...) — confirm the footer there has NO Matrix green styling (different layout)
  </how-to-verify>
  <resume-signal>Type "approved" if the footer looks correct, or describe any visual issues to fix</resume-signal>
</task>

</tasks>

<verification>
Final gate — all must be true:
1. `npx playwright test --config=playwright.visual.config.ts` from apps/web — 12 passed, 0 failed
2. `npx playwright test e2e/portfolio/accessibility.spec.ts` — all pass, 0 axe violations
3. `git diff --stat apps/web/e2e/dashboard/` — no output (dashboard unchanged)
4. Human visual approval confirmed
5. FOOTER-01 through FOOTER-07 all satisfied
</verification>

<success_criteria>
- axe-core WCAG AA: zero violations on all portfolio routes in light and dark mode (FOOTER-06)
- All footer links have `focus-visible:ring-2 focus-visible:ring-[var(--matrix-green)] focus-visible:ring-offset-[#0a0a0a]` (FOOTER-06)
- All 18 Playwright visual regression snapshots pass at maxDiffPixelRatio 0.02 (FOOTER-07)
- Dashboard 6 snapshots unchanged — no Matrix green bleed (FOOTER-07 isolation)
- Human visual approval of the terminal-themed footer across all portfolio pages
- Phase 33 complete — v3.1 milestone complete (all 24 requirements satisfied)
</success_criteria>

<output>
After completion, create `.planning/phases/33-footer-redesign-matrix-animation/33-03-SUMMARY.md`
</output>
