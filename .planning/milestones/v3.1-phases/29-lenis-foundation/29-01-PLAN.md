---
phase: 29-lenis-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/components/portfolio/lenis-provider.tsx
  - apps/web/app/(portfolio)/layout.tsx
  - apps/web/app/globals.css
autonomous: true
requirements:
  - SCROLL-01
  - SCROLL-03

must_haves:
  truths:
    - "User scrolling any portfolio page experiences inertia-based smooth scroll instead of native instant scroll"
    - "User with prefers-reduced-motion active gets native browser scroll with zero Lenis overhead (no RAF loop, no ReactLenis mount)"
    - "TeamFlow dashboard scroll behavior is identical to pre-Phase-29 (Lenis never touches dashboard routes)"
  artifacts:
    - path: "apps/web/components/portfolio/lenis-provider.tsx"
      provides: "LenisProvider component — 'use client', conditionally mounts ReactLenis root with lerp: 0.1, autoRaf: true"
      exports: ["LenisProvider"]
      min_lines: 40
    - path: "apps/web/app/(portfolio)/layout.tsx"
      provides: "Portfolio layout with LenisProvider wrapping all content (including CommandPalette and PortfolioNav)"
      contains: "LenisProvider"
    - path: "apps/web/app/globals.css"
      provides: "Lenis required CSS imported once globally"
      contains: "lenis"
  key_links:
    - from: "apps/web/app/(portfolio)/layout.tsx"
      to: "apps/web/components/portfolio/lenis-provider.tsx"
      via: "import + JSX wrap"
      pattern: "LenisProvider"
    - from: "apps/web/components/portfolio/lenis-provider.tsx"
      to: "lenis/react"
      via: "ReactLenis root prop"
      pattern: "ReactLenis.*root"
    - from: "apps/web/app/globals.css"
      to: "lenis/dist/lenis.css"
      via: "@import"
      pattern: "@import.*lenis"
---

<objective>
Create the LenisProvider component and wire it into the portfolio layout so all portfolio pages get inertia smooth scroll. The component gates itself behind a prefers-reduced-motion check so motion-sensitive users get zero overhead.

Purpose: SCROLL-01 and SCROLL-03 — the foundation all other Phase 29 work builds on. Without this, no useLenis() context exists for route reset or CommandPalette lock.
Output: LenisProvider component, globals.css Lenis CSS import, portfolio layout wired.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29-lenis-foundation/29-RESEARCH.md
@apps/web/app/(portfolio)/layout.tsx
@apps/web/app/globals.css
@apps/web/components/portfolio/motion-provider.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LenisProvider component</name>
  <files>apps/web/components/portfolio/lenis-provider.tsx</files>
  <action>
Create `apps/web/components/portfolio/lenis-provider.tsx` as a `'use client'` component.

The component must:
1. Use `useState(false)` + `useEffect` for SSR-safe `prefers-reduced-motion` detection (NOT `typeof window !== 'undefined'` inline check — that causes hydration mismatch). The `useState` approach starts both server and client rendering the Lenis tree, then client-side `useEffect` unmounts it if reduced-motion is set.
2. When `prefersReducedMotion` is true: return `<>{children}</>` with NO ReactLenis — zero RAF overhead (satisfies SCROLL-03).
3. When `prefersReducedMotion` is false: render `<ReactLenis root options={{ lerp: 0.1, autoRaf: true, smoothWheel: true }}>` wrapping children.
   - `root` prop: makes the instance globally accessible via `useLenis()` — critical for Task 2 in 29-02.
   - `autoRaf: true`: Phase 29 uses built-in RAF. Phase 30 will switch to `autoRaf: false` + `gsap.ticker.add`. Do NOT add gsap.ticker here.
   - `lerp: 0.1`: starting value; comment in code that 0.08-0.12 may be adjusted after real-device feel testing.
   - Do NOT set `duration` alongside `lerp` — they are alternatives, not companions.
4. Include a `LenisScrollReset` inner component (separate named function inside the file, not exported) that:
   - Calls `usePathname()` from `next/navigation`
   - Calls `useLenis()` from `lenis/react`
   - Has a `useEffect` on `[pathname, lenis]` that calls `lenis.scrollTo(0, { immediate: true, force: true })` when both are truthy
   - Returns `null`
   - This inner component is rendered as `<LenisScrollReset />` inside the ReactLenis tree (NOT outside — useLenis() needs the ReactLenis ancestor)
5. Exports: only `LenisProvider` (named export).

Imports required:
- `import { useEffect, useState } from 'react'`
- `import { usePathname } from 'next/navigation'`
- `import ReactLenis, { useLenis } from 'lenis/react'`

Do NOT import `lenis/dist/lenis.css` here — that goes in globals.css (Task 2) to avoid duplicate imports.

State.md constraint: import from `lenis/react` (never `@studio-freight/react-lenis` — deprecated).
  </action>
  <verify>
Run: `cd /home/doctor/fernandomillan && npx tsc --noEmit -p apps/web/tsconfig.json 2>&1 | grep lenis-provider`

Expected: no TypeScript errors for lenis-provider.tsx.

Also check: `grep -n "ReactLenis" apps/web/components/portfolio/lenis-provider.tsx` shows `root` prop and `options={{ lerp: 0.1, autoRaf: true, smoothWheel: true }}`.
  </verify>
  <done>
File exists at `apps/web/components/portfolio/lenis-provider.tsx`, exports `LenisProvider`, uses useState+useEffect for reduced-motion, inner `LenisScrollReset` is inside ReactLenis tree, no TypeScript errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add lenis CSS import to globals.css and wire LenisProvider into portfolio layout</name>
  <files>apps/web/app/globals.css, apps/web/app/(portfolio)/layout.tsx</files>
  <action>
**Step A — globals.css:**
Add `@import "lenis/dist/lenis.css";` to `apps/web/app/globals.css`. Place it after the existing `@import "tailwindcss"` and `@import "tw-animate-css"` lines but before the Radix Colors imports. This CSS sets `html.lenis, html.lenis body { height: auto }` and `html.lenis-stopping { overflow: clip }` — required for Lenis scroll container behavior. Import it exactly once here; do NOT also import it in lenis-provider.tsx.

**Step B — portfolio layout:**
Modify `apps/web/app/(portfolio)/layout.tsx` to wrap the entire layout with `LenisProvider`.

Current layout structure:
```tsx
<div className="matrix-theme min-h-screen flex flex-col">
  <DotGridSpotlight />
  <PortfolioNav />
  <MotionProvider><main className="flex-1">{children}</main></MotionProvider>
  <PortfolioFooter />
  <CommandPalette />
</div>
```

Required new structure — `LenisProvider` must be the OUTERMOST wrapper (outside the `.matrix-theme` div) so that `CommandPalette` and `PortfolioNav` inside the div can all access `useLenis()` context:
```tsx
import { LenisProvider } from '@/components/portfolio/lenis-provider'

export default function PortfolioLayout({ children }: { children: React.ReactNode }) {
  return (
    <LenisProvider>
      <div className="matrix-theme min-h-screen flex flex-col">
        <DotGridSpotlight />
        <PortfolioNav />
        <MotionProvider>
          <main className="flex-1">{children}</main>
        </MotionProvider>
        <PortfolioFooter />
        <CommandPalette />
      </div>
    </LenisProvider>
  )
}
```

Keep the `metadata` export and all existing imports unchanged. Only add the `LenisProvider` import and wrap.

CRITICAL: Do NOT add LenisProvider to `app/layout.tsx` (root layout) — that would wrap dashboard routes and break TanStack Table virtual scroll (Lenis CSS sets `html { height: auto }` globally). Portfolio layout only.
  </action>
  <verify>
1. Check import exists: `grep "lenis" /home/doctor/fernandomillan/apps/web/app/globals.css`
2. Check layout wraps correctly: `grep -n "LenisProvider" /home/doctor/fernandomillan/apps/web/app/\(portfolio\)/layout.tsx` — should show import line and wrapping JSX.
3. Run TypeScript check: `cd /home/doctor/fernandomillan && npx tsc --noEmit -p apps/web/tsconfig.json 2>&1 | head -20` — no errors.
4. Run build to confirm no SSR crash: `cd /home/doctor/fernandomillan && pnpm --filter web build 2>&1 | tail -20`
  </verify>
  <done>
`globals.css` contains exactly one `@import "lenis/dist/lenis.css"` line. Portfolio layout imports `LenisProvider` and wraps the entire layout. Build succeeds with no errors. Dashboard layout (`app/(dashboard)/layout.tsx`) is untouched.
  </done>
</task>

</tasks>

<verification>
1. `pnpm --filter web build` completes with no errors — no SSR crash from window access, no missing exports
2. `grep "LenisProvider" apps/web/app/\(portfolio\)/layout.tsx` returns both the import and the JSX wrap
3. `grep "LenisProvider" apps/web/app/layout.tsx` returns nothing (not in root layout)
4. `grep "lenis" apps/web/app/globals.css` returns exactly one import line
5. TypeScript: `npx tsc --noEmit -p apps/web/tsconfig.json` passes clean
</verification>

<success_criteria>
- LenisProvider component exists and exports correctly
- Portfolio layout wraps with LenisProvider (dashboard layout untouched)
- Lenis CSS imported once in globals.css
- Build passes — no SSR window errors, no TypeScript errors
- useLenis() context is available to all components inside portfolio layout
</success_criteria>

<output>
After completion, create `.planning/phases/29-lenis-foundation/29-01-SUMMARY.md`
</output>
