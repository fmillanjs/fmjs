---
phase: 12-critical-route-migration
plan: 03
type: execute
wave: 2
depends_on:
  - 12-01
files_modified:
  - apps/web/components/tasks/task-detail-panel.tsx
autonomous: true
requirements:
  - COMP-04
  - MIG-02
  - MIG-03

must_haves:
  truths:
    - "Status, Priority, and Assignee fields use Shadcn Select (not native <select>)"
    - "Comments/History tab bar uses Shadcn Tabs with proper ARIA roles"
    - "Title inline editing uses Shadcn Input"
    - "Description inline editing uses Shadcn Textarea and Button"
    - "Delete Task uses Shadcn AlertDialog (not inline confirm div)"
    - "All native <select>, raw <input type=text>, raw <textarea>, and showDeleteConfirm inline div deleted"
  artifacts:
    - path: "apps/web/components/tasks/task-detail-panel.tsx"
      provides: "Accessible inline-edit panel with Select, Tabs, Input, Textarea, AlertDialog"
      contains: "Tabs"
      min_lines: 200
  key_links:
    - from: "apps/web/components/tasks/task-detail-panel.tsx"
      to: "@/components/ui/tabs"
      via: "import"
      pattern: "from '@/components/ui/tabs'"
    - from: "apps/web/components/tasks/task-detail-panel.tsx"
      to: "@/components/ui/alert-dialog"
      via: "import"
      pattern: "from '@/components/ui/alert-dialog'"
    - from: "apps/web/components/tasks/task-detail-panel.tsx"
      to: "@/components/ui/select"
      via: "import"
      pattern: "from '@/components/ui/select'"
---

<objective>
Migrate TaskDetailPanel from raw HTML form elements and manual tab UI to Shadcn components. This component is on the task detail page (not a modal), so inline editing patterns (click-to-edit title/description) are preserved — only the HTML elements change.

Purpose: MIG-02 + MIG-03 — replace all non-Shadcn UI in the task detail view. COMP-04 for the AlertDialog delete confirmation (role="alertdialog", focus trap, ESC).
Output: task-detail-panel.tsx uses Select for status/priority/assignee, Tabs for comments/history, Input for title edit, Textarea for description edit, AlertDialog for delete confirmation. All old raw elements deleted.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/12-critical-route-migration/12-RESEARCH.md
@apps/web/components/tasks/task-detail-panel.tsx
@apps/web/components/ui/select.tsx
@apps/web/components/ui/tabs.tsx
@apps/web/components/ui/alert-dialog.tsx
@apps/web/components/ui/input.tsx
@apps/web/components/ui/textarea.tsx
@apps/web/components/ui/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace raw selects with Shadcn Select and manual tabs with Shadcn Tabs</name>
  <files>apps/web/components/tasks/task-detail-panel.tsx</files>
  <action>
    Add imports for Select, Tabs, and their sub-components. Then replace the raw elements in the right-column sidebar and the tab UI in the main column.

    1. Add imports:
       ```tsx
       import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
       import { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';
       ```

    2. Remove `useState` for `activeTab` — Tabs manages its own state internally. Delete the `activeTab` state declaration.

    3. Replace the Status `<select>` (currently lines ~312-323 in the sidebar):
       ```tsx
       {/* Status */}
       <div>
         <label className="block text-sm font-medium text-muted-foreground mb-1">Status</label>
         <Select value={currentTask.status} onValueChange={(v) => updateField('status', v)}>
           <SelectTrigger className={`w-full font-medium ${statusColors[currentTask.status].bg} ${statusColors[currentTask.status].text}`}>
             <SelectValue />
           </SelectTrigger>
           <SelectContent>
             {Object.entries(statusLabels).map(([value, label]) => (
               <SelectItem key={value} value={value}>{label}</SelectItem>
             ))}
           </SelectContent>
         </Select>
       </div>
       ```

    4. Replace the Priority `<select>` with Shadcn Select using the same pattern as Status above, using `priorityColors` and `priorityLabels`.

    5. Replace the Assignee `<select>`:
       ```tsx
       <Select value={currentTask.assigneeId || ''} onValueChange={(v) => updateField('assigneeId', v || null)}>
         <SelectTrigger className="w-full">
           <SelectValue placeholder="Unassigned" />
         </SelectTrigger>
         <SelectContent>
           <SelectItem value="">Unassigned</SelectItem>
           {teamMembers.map((member) => (
             <SelectItem key={member.id} value={member.id}>
               {member.name || member.email}
             </SelectItem>
           ))}
         </SelectContent>
       </Select>
       ```

    6. Replace the entire manual tab section (the `<div className="border-b border-border">` tabs container and the conditional tab content below it) with Shadcn Tabs:
       ```tsx
       <div className="bg-card shadow rounded-lg overflow-hidden">
         <Tabs defaultValue="comments">
           <div className="border-b border-border">
             <TabsList className="w-full justify-start rounded-none h-auto bg-transparent px-6 gap-0">
               <TabsTrigger
                 value="comments"
                 className="rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:shadow-none data-[state=active]:bg-transparent py-4"
               >
                 Comments ({comments.length})
               </TabsTrigger>
               <TabsTrigger
                 value="history"
                 className="rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:shadow-none data-[state=active]:bg-transparent py-4"
               >
                 History
               </TabsTrigger>
             </TabsList>
           </div>
           <TabsContent value="comments" className="p-6 mt-0">
             <div className="space-y-6">
               <CommentThread comments={comments} taskId={currentTask.id} onUpdate={handleCommentsUpdate} />
               <CommentForm taskId={currentTask.id} onCommentAdded={handleCommentsUpdate} />
             </div>
           </TabsContent>
           <TabsContent value="history" className="p-6 mt-0">
             <TaskHistory taskId={currentTask.id} projectId={projectId} />
           </TabsContent>
         </Tabs>
       </div>
       ```

    Delete: the `activeTab` state, the entire old `<div className="border-b border-border">` tabs header block, and the conditional `{activeTab === 'comments' ? ... : ...}` content block.
  </action>
  <verify>
    `grep "activeTab\|<select" apps/web/components/tasks/task-detail-panel.tsx` returns empty (old elements deleted).
    `grep "TabsContent\|SelectTrigger" apps/web/components/tasks/task-detail-panel.tsx` returns matches.
    `npx tsc --noEmit` in apps/web passes.
  </verify>
  <done>Status/Priority/Assignee use Shadcn Select. Comments/History uses Shadcn Tabs. Old raw selects and manual tab buttons deleted. No TypeScript errors.</done>
</task>

<task type="auto">
  <name>Task 2: Replace raw title input, description textarea, and delete confirm with Shadcn Input, Textarea, Button, AlertDialog</name>
  <files>apps/web/components/tasks/task-detail-panel.tsx</files>
  <action>
    Add remaining imports, then replace the inline-edit elements and the delete confirmation.

    1. Add imports:
       ```tsx
       import { Input } from '@/components/ui/input';
       import { Textarea } from '@/components/ui/textarea';
       import { Button } from '@/components/ui/button';
       import {
         AlertDialog, AlertDialogAction, AlertDialogCancel,
         AlertDialogContent, AlertDialogDescription, AlertDialogFooter,
         AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger,
       } from '@/components/ui/alert-dialog';
       ```

    2. Replace the raw `<input type="text">` used for title inline editing:
       Before: `<input type="text" value={editedTitle} onChange={...} onBlur={handleTitleSave} onKeyDown={handleTitleKeyDown} className="w-full text-2xl font-bold border-2 border-blue-500 rounded px-2 py-1 focus:outline-none" autoFocus />`
       After: `<Input value={editedTitle} onChange={(e) => setEditedTitle(e.target.value)} onBlur={handleTitleSave} onKeyDown={handleTitleKeyDown} className="w-full text-2xl font-bold" autoFocus />`
       The inline editing behavior (click-to-edit, onBlur saves, Enter saves, Escape cancels) is UNCHANGED — only the HTML element changes.

    3. Replace the raw `<textarea>` used for description inline editing:
       Before: `<textarea value={editedDescription} onChange={...} className="w-full border-2 border-blue-500 rounded px-3 py-2 focus:outline-none min-h-[120px]" autoFocus />`
       After: `<Textarea value={editedDescription} onChange={(e) => setEditedDescription(e.target.value)} className="min-h-[120px]" autoFocus />`

    4. Replace the two plain `<button>` elements in the description edit controls (Save / Cancel):
       After: `<Button size="sm" onClick={handleDescriptionSave}>Save</Button>`
             `<Button size="sm" variant="outline" onClick={handleDescriptionCancel}>Cancel</Button>`

    5. Replace the `showDeleteConfirm` inline confirm div with AlertDialog. Delete the `showDeleteConfirm` state entirely.
       ```tsx
       <AlertDialog>
         <AlertDialogTrigger asChild>
           <Button variant="destructive" className="w-full">Delete Task</Button>
         </AlertDialogTrigger>
         <AlertDialogContent>
           <AlertDialogHeader>
             <AlertDialogTitle>Delete this task?</AlertDialogTitle>
             <AlertDialogDescription>
               This action cannot be undone. All comments and history for this task will be permanently deleted.
             </AlertDialogDescription>
           </AlertDialogHeader>
           <AlertDialogFooter>
             <AlertDialogCancel>Cancel</AlertDialogCancel>
             <AlertDialogAction
               className="bg-destructive text-destructive-foreground hover:bg-destructive/90"
               onClick={handleDelete}
             >
               Delete Task
             </AlertDialogAction>
           </AlertDialogFooter>
         </AlertDialogContent>
       </AlertDialog>
       ```

    Delete: the `showDeleteConfirm` useState, the entire conditional `{showDeleteConfirm ? (...) : (...)}` block in the delete section, and the two raw `<button>` elements it contained.
  </action>
  <verify>
    `grep "showDeleteConfirm\|border-blue-500" apps/web/components/tasks/task-detail-panel.tsx` returns empty (old patterns deleted).
    `grep "AlertDialogTrigger\|AlertDialogContent" apps/web/components/tasks/task-detail-panel.tsx` returns matches.
    `grep "<input\|<textarea\|<button" apps/web/components/tasks/task-detail-panel.tsx` returns only the label checkbox inputs (for labels list) — no raw modal/edit buttons remain.
    `npx tsc --noEmit` in apps/web passes.
  </verify>
  <done>Title editing uses Input. Description editing uses Textarea + Button. Delete confirmation uses AlertDialog with role="alertdialog". showDeleteConfirm state deleted. No raw form elements remain (except checkbox inputs in the labels list which are intentionally kept). TypeScript compiles cleanly.</done>
</task>

</tasks>

<verification>
1. `grep -E "<select|<input type=\"text\"|<textarea" apps/web/components/tasks/task-detail-panel.tsx` returns only the date input and checkbox inputs (labels list) — no text inputs or selects remain
2. `grep "activeTab\|showDeleteConfirm" apps/web/components/tasks/task-detail-panel.tsx` returns empty
3. `grep "AlertDialogContent\|TabsContent\|SelectTrigger" apps/web/components/tasks/task-detail-panel.tsx` returns matches for all three
4. `npx tsc --noEmit` passes
</verification>

<success_criteria>
TaskDetailPanel uses only Shadcn components for its interactive UI. All native selects, the manual tab implementation, and the inline confirm div pattern are deleted. MIG-03 satisfied for this file.
</success_criteria>

<output>
After completion, create `.planning/phases/12-critical-route-migration/12-03-SUMMARY.md`
</output>
