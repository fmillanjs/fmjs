---
phase: 11-form-components-validation
plan: "03"
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - apps/web/components/teams/team-form.tsx
  - apps/web/components/teams/invite-member-form.tsx
  - apps/web/components/projects/project-form.tsx
  - apps/web/components/tasks/comment-form.tsx
  - apps/web/components/portfolio/contact-form.tsx
autonomous: true
requirements:
  - COMP-03

must_haves:
  truths:
    - "team-form uses FormField pattern with mode: 'onBlur'"
    - "invite-member-form uses Shadcn Select for the role dropdown (not native select)"
    - "project-form uses FormField pattern with Textarea for description field"
    - "comment-form has a visible FormLabel and uses react-hook-form with FormField"
    - "contact-form wraps its existing Input/Label/Textarea with FormField/FormControl"
    - "All 5 forms have role='alert' on server error divs"
  artifacts:
    - path: "apps/web/components/teams/team-form.tsx"
      provides: "Accessible team creation form"
      contains: "Form, FormField, FormItem, FormLabel, FormControl, FormMessage"
    - path: "apps/web/components/teams/invite-member-form.tsx"
      provides: "Accessible member invite form with Shadcn Select for role"
      contains: "Form, FormField, FormItem, FormLabel, FormControl, FormMessage, Select"
    - path: "apps/web/components/projects/project-form.tsx"
      provides: "Accessible project create/edit form with Textarea"
      contains: "Form, FormField, FormItem, FormLabel, FormControl, FormMessage, Textarea"
    - path: "apps/web/components/tasks/comment-form.tsx"
      provides: "Accessible comment form with visible label and react-hook-form"
      contains: "Form, FormField, FormItem, FormLabel, FormControl, FormMessage, Textarea"
    - path: "apps/web/components/portfolio/contact-form.tsx"
      provides: "Accessible contact form with proper ARIA wiring"
      contains: "Form, FormField, FormItem, FormLabel, FormControl, FormMessage"
  key_links:
    - from: "apps/web/components/teams/invite-member-form.tsx"
      to: "apps/web/components/ui/select.tsx"
      via: "FormField render with Shadcn Select for role dropdown"
      pattern: "Select.*onValueChange|SelectTrigger"
    - from: "apps/web/components/tasks/comment-form.tsx"
      to: "react-hook-form"
      via: "Added useForm + zodResolver for content validation"
      pattern: "useForm.*zodResolver"
---

<objective>
Migrate the 5 dashboard and portfolio forms to the Shadcn Form pattern. This includes the only form needing a Shadcn Select migration (invite-member-form role dropdown) and the comment-form which needs react-hook-form added from scratch.

Purpose: Dashboard forms are where authenticated users spend most time — team creation, project management, comments. These forms currently have no ARIA attributes, no accessible selects, and in the case of comment-form, no label at all. These are the forms most likely to fail an axe audit.

Output: 5 form files fully migrated, comment-form gains react-hook-form integration, invite-member-form gains Shadcn Select for the role field.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/11-form-components-validation/11-RESEARCH.md
@.planning/phases/11-form-components-validation/11-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate team-form, project-form, and contact-form</name>
  <files>
    apps/web/components/teams/team-form.tsx
    apps/web/components/projects/project-form.tsx
    apps/web/components/portfolio/contact-form.tsx
  </files>
  <action>
    **team-form.tsx:**
    - One text field (name). Simple migration.
    - Import Form, FormField, FormItem, FormLabel, FormControl, FormMessage, Button
    - Change useForm to `const form = useForm<CreateTeamInput>({ resolver: zodResolver(createTeamSchema), mode: 'onBlur' })`
    - Wrap form with `<Form {...form}>`
    - Replace the name field div with FormField pattern
    - Add role="alert" to the server error div (already has bg-[var(--red-3)] styling — keep styles, add role)
    - Add role="status" to the success message div
    - Replace raw `<button type="submit">` with `<Button type="submit" disabled={isLoading} className="w-full">`

    **project-form.tsx:**
    - Two fields: name (text) and description (textarea).
    - Import Form, FormField, FormItem, FormLabel, FormControl, FormMessage, Button, Textarea
    - Change useForm to `const form = useForm<ProjectFormData>({ resolver: zodResolver(projectSchema), mode: 'onBlur', defaultValues: defaultValues || { name: '', description: '' } })`
    - Wrap form with `<Form {...form}>`
    - Replace name field with FormField + Input
    - Replace description field with FormField + Textarea (use Shadcn Textarea from '@/components/ui/textarea')
    - Add role="alert" to error div
    - Replace raw buttons with Button component (Cancel button: `<Button type="button" variant="outline" onClick={() => router.back()}>`, Submit button: `<Button type="submit" disabled={isSubmitting}>`)

    **contact-form.tsx:**
    This form already uses Shadcn Input, Label, and Textarea — but without the FormField/FormControl wrapper that provides ARIA. Read the file first to understand its current structure.
    - The migration is: wrap existing Label+Input/Textarea pairs with FormField > FormItem > FormLabel > FormControl > Input/Textarea > FormMessage
    - Remove any manual `id` and `htmlFor` attributes — FormItem generates IDs via React.useId() automatically
    - Set mode: 'onBlur' on useForm
    - Add role="alert" to any error state divs
    - Keep all business logic (server action call, success state) unchanged

    **Critical: contact-form already imports Input, Label, Textarea** — do NOT remove those imports. Just add the Form imports. The existing Shadcn components stay; they just get wrapped in FormField/FormControl.
  </action>
  <verify>
    ```bash
    # Check Form imports in all 3 files
    grep -l "from '@/components/ui/form'" \
      apps/web/components/teams/team-form.tsx \
      apps/web/components/projects/project-form.tsx \
      apps/web/components/portfolio/contact-form.tsx

    # Check mode: 'onBlur'
    grep "mode: 'onBlur'" \
      apps/web/components/teams/team-form.tsx \
      apps/web/components/projects/project-form.tsx \
      apps/web/components/portfolio/contact-form.tsx

    # Check no register() calls
    grep "register(" \
      apps/web/components/teams/team-form.tsx \
      apps/web/components/projects/project-form.tsx \
      apps/web/components/portfolio/contact-form.tsx || echo "Clean"

    # TypeScript
    cd apps/web && npx tsc --noEmit 2>&1 | grep -E "team-form|project-form|contact-form" || echo "No TS errors"
    ```
  </verify>
  <done>
    All 3 files use FormField pattern. mode: 'onBlur' active. No register() calls. No TypeScript errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate invite-member-form (Shadcn Select) and comment-form (add react-hook-form)</name>
  <files>
    apps/web/components/teams/invite-member-form.tsx
    apps/web/components/tasks/comment-form.tsx
  </files>
  <action>
    **invite-member-form.tsx:**
    This form has a native `<select>` for role that must become a Shadcn Select. The email field is standard text input.

    1. Import Form, FormField, FormItem, FormLabel, FormControl, FormMessage, Button from their respective ui paths
    2. Import Select, SelectContent, SelectItem, SelectTrigger, SelectValue from '@/components/ui/select'
    3. Change useForm: `const form = useForm<InviteMemberInput>({ resolver: zodResolver(inviteMemberSchema), mode: 'onBlur', defaultValues: { role: UserRole.MEMBER } })`
    4. Email field — standard FormField + Input pattern
    5. Role field — Shadcn Select pattern (NOT spread {...field} on Select root):
       ```tsx
       <FormField
         control={form.control}
         name="role"
         render={({ field }) => (
           <FormItem>
             <FormLabel>Role</FormLabel>
             <Select onValueChange={field.onChange} defaultValue={field.value}>
               <FormControl>
                 <SelectTrigger>
                   <SelectValue placeholder="Select role" />
                 </SelectTrigger>
               </FormControl>
               <SelectContent>
                 <SelectItem value={UserRole.MEMBER}>Member</SelectItem>
                 <SelectItem value={UserRole.MANAGER}>Manager</SelectItem>
                 <SelectItem value={UserRole.ADMIN}>Admin</SelectItem>
               </SelectContent>
             </Select>
             <FormMessage />
           </FormItem>
         )}
       />
       ```
    6. Add role="alert" to server error div, role="status" to success div
    7. Replace raw submit button with Button component

    **comment-form.tsx:**
    This form is the most different — it currently uses raw useState with no react-hook-form and no label.

    Add a complete react-hook-form integration:
    1. Add imports: z from 'zod', useForm from 'react-hook-form', zodResolver from '@hookform/resolvers/zod', Form/FormField/FormItem/FormLabel/FormControl/FormMessage from ui/form, Textarea from ui/textarea, Button from ui/button
    2. Define inline schema at top of file:
       ```tsx
       const commentSchema = z.object({
         content: z.string().min(1, 'Comment cannot be empty').max(1000, 'Comment must be under 1000 characters'),
       })
       type CommentFormData = z.infer<typeof commentSchema>
       ```
    3. Change component state: remove `const [content, setContent] = useState('')` — react-hook-form manages content state
    4. Add useForm: `const form = useForm<CommentFormData>({ resolver: zodResolver(commentSchema), mode: 'onBlur', defaultValues: { content: '' } })`
    5. Change handleSubmit: `const onSubmit = async (data: CommentFormData) => { ... use data.content ... form.reset() }`
    6. Remove the `alert('Failed to add comment')` — replace with `console.error` (Sonner toast is optional improvement but not required)
    7. Wrap with Form, replace the raw textarea with FormField + Textarea pattern, add visible FormLabel "Comment"
    8. Replace raw submit button with Button

    The resulting form needs a label "Comment" visible above the textarea — this is required for WCAG 1.3.1 (Form elements must have labels).
  </action>
  <verify>
    ```bash
    # Check Shadcn Select import in invite-member-form
    grep "from '@/components/ui/select'" apps/web/components/teams/invite-member-form.tsx

    # Check onValueChange pattern (not {...field} spread on Select)
    grep "onValueChange" apps/web/components/teams/invite-member-form.tsx

    # Check comment-form has FormLabel
    grep "FormLabel" apps/web/components/tasks/comment-form.tsx

    # Check comment-form has react-hook-form
    grep "useForm" apps/web/components/tasks/comment-form.tsx

    # Check no register() calls remain
    grep "register(" \
      apps/web/components/teams/invite-member-form.tsx \
      apps/web/components/tasks/comment-form.tsx || echo "Clean"

    # TypeScript
    cd apps/web && npx tsc --noEmit 2>&1 | grep -E "invite-member|comment-form" || echo "No TS errors"
    ```
  </verify>
  <done>
    invite-member-form uses Shadcn Select with onValueChange for the role field. comment-form has FormLabel "Comment", uses react-hook-form with zod schema, and has FormMessage for error display. No register() calls. No TypeScript errors.
  </done>
</task>

</tasks>

<verification>
- [ ] team-form.tsx uses FormField pattern, Button component, role="alert" on error
- [ ] project-form.tsx uses FormField for name (Input) and description (Textarea)
- [ ] contact-form.tsx FormField wraps all existing Shadcn Input/Textarea components with FormControl
- [ ] invite-member-form.tsx uses Shadcn Select with onValueChange (not register) for role field
- [ ] comment-form.tsx has a visible FormLabel "Comment" and uses react-hook-form with zod
- [ ] All 5 files have mode: 'onBlur' in useForm
- [ ] No register() calls remain in any of the 5 files
- [ ] No TypeScript errors in any of the 5 files
</verification>

<success_criteria>
All 5 dashboard/portfolio forms migrated. invite-member-form's native select replaced with accessible Radix Select. comment-form gains proper label and react-hook-form integration. All forms have ARIA-wired error messages via FormMessage.
</success_criteria>

<output>
After completion, create `.planning/phases/11-form-components-validation/11-03-SUMMARY.md`
</output>
