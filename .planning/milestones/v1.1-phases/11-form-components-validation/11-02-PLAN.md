---
phase: 11-form-components-validation
plan: "02"
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - apps/web/components/auth/login-form.tsx
  - apps/web/components/auth/signup-form.tsx
  - apps/web/components/auth/reset-password-request-form.tsx
  - apps/web/components/auth/reset-password-form.tsx
  - apps/web/components/auth/profile-form.tsx
  - apps/web/components/auth/change-password-form.tsx
autonomous: true
requirements:
  - COMP-03

must_haves:
  truths:
    - "Login form fields have aria-invalid set when validation errors exist"
    - "Signup form fields have aria-invalid and aria-describedby wired to error messages"
    - "All 6 auth forms use mode: 'onBlur' — validation fires on field exit, not every keystroke"
    - "Server error divs have role='alert' for screen reader live region announcement"
    - "All 6 auth forms use Shadcn Button component instead of raw button elements"
  artifacts:
    - path: "apps/web/components/auth/login-form.tsx"
      provides: "Accessible login form with FormField pattern"
      contains: "Form, FormField, FormItem, FormLabel, FormControl, FormMessage"
    - path: "apps/web/components/auth/signup-form.tsx"
      provides: "Accessible signup form with FormField pattern"
      contains: "Form, FormField, FormItem, FormLabel, FormControl, FormMessage"
    - path: "apps/web/components/auth/reset-password-request-form.tsx"
      provides: "Accessible password reset request form"
      contains: "Form, FormField, FormItem, FormLabel, FormControl, FormMessage"
    - path: "apps/web/components/auth/reset-password-form.tsx"
      provides: "Accessible password reset confirmation form"
      contains: "Form, FormField, FormItem, FormLabel, FormControl, FormMessage"
    - path: "apps/web/components/auth/profile-form.tsx"
      provides: "Accessible profile edit form"
      contains: "Form, FormField, FormItem, FormLabel, FormControl, FormMessage"
    - path: "apps/web/components/auth/change-password-form.tsx"
      provides: "Accessible change password form"
      contains: "Form, FormField, FormItem, FormLabel, FormControl, FormMessage"
  key_links:
    - from: "apps/web/components/auth/login-form.tsx"
      to: "apps/web/components/ui/form.tsx"
      via: "Form Context provider wrapping inner form element"
      pattern: "<Form \\{\\.\\.\\.form\\}>"
    - from: "apps/web/components/auth/signup-form.tsx"
      to: "apps/web/components/ui/form.tsx"
      via: "Form Context provider wrapping inner form element"
      pattern: "<Form \\{\\.\\.\\.form\\}>"
---

<objective>
Migrate all 6 auth forms from the raw input/label pattern to the Shadcn Form component pattern, enabling automatic aria-invalid and aria-describedby wiring.

Purpose: Auth forms are the entry point of the application. Users with screen readers encounter login and signup first. All 6 files currently use native input elements with no ARIA attributes — FormControl will add aria-invalid and aria-describedby automatically once wrapped in the Form context.

Output: 6 auth form files fully migrated to FormField pattern with mode: 'onBlur', role="alert" on server errors, and Button component replacing raw buttons.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/11-form-components-validation/11-RESEARCH.md
@.planning/phases/11-form-components-validation/11-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate login-form and signup-form to Shadcn Form pattern</name>
  <files>
    apps/web/components/auth/login-form.tsx
    apps/web/components/auth/signup-form.tsx
  </files>
  <action>
    Apply the standard Shadcn Form migration to both files. The pattern is identical for all text/email/password inputs.

    **For login-form.tsx:**
    1. Add imports: Form, FormField, FormItem, FormLabel, FormControl, FormMessage from '@/components/ui/form'; Input from '@/components/ui/input'; Button from '@/components/ui/button'
    2. Change useForm destructuring from `const { register, handleSubmit, formState: { errors } } = useForm` to `const form = useForm<LoginDto>({ resolver: zodResolver(loginSchema), mode: 'onBlur' })`
    3. Remove the `register` variable — it is replaced by FormField render props
    4. Wrap the inner `<form>` with `<Form {...form}>` — the outer div (bg-card shadow-md rounded-lg...) stays as-is
    5. Change `<form onSubmit={handleSubmit(onSubmit)}>` to `<form onSubmit={form.handleSubmit(onSubmit)}>`
    6. Replace each field div with FormField pattern:
       ```tsx
       <FormField
         control={form.control}
         name="email"
         render={({ field }) => (
           <FormItem>
             <FormLabel>Email</FormLabel>
             <FormControl>
               <Input type="email" {...field} disabled={isLoading} />
             </FormControl>
             <FormMessage />
           </FormItem>
         )}
       />
       ```
    7. Add role="alert" to the server error div: `<div role="alert" className="...">`
    8. Replace raw `<button type="submit">` with `<Button type="submit" disabled={isLoading} className="w-full">`. Remove the old focus:ring-2 focus:ring-ring classes — Button already handles these.
    9. Keep the "Forgot password?" Link and "Don't have an account?" paragraph unchanged.

    **For signup-form.tsx:**
    Same transformation. Fields: name (text), email (email), password (password).
    Keep the "Already have an account?" paragraph unchanged.
    Replace the submit button with `<Button type="submit" disabled={isLoading} className="w-full">`.

    **Critical pitfalls to avoid:**
    - Do NOT keep any `{...register('fieldName')}` spread on inputs — FormField provides `field` instead
    - Do NOT omit `<FormMessage />` inside any FormItem — prevents Shadcn aria-describedby bug
    - Do NOT spread `{...field}` and `{...register()}` on the same input
    - The `mode: 'onBlur'` must be in useForm options, not just mentioned in comments
  </action>
  <verify>
    ```bash
    # Check Form imports present in both files
    grep -l "from '@/components/ui/form'" apps/web/components/auth/login-form.tsx apps/web/components/auth/signup-form.tsx

    # Check mode: 'onBlur' in both files
    grep -c "mode: 'onBlur'" apps/web/components/auth/login-form.tsx apps/web/components/auth/signup-form.tsx

    # Check role="alert" for server error
    grep "role=\"alert\"" apps/web/components/auth/login-form.tsx apps/web/components/auth/signup-form.tsx

    # Check no register() calls remain
    grep "register(" apps/web/components/auth/login-form.tsx apps/web/components/auth/signup-form.tsx || echo "Clean — no register() calls"

    # TypeScript check
    cd apps/web && npx tsc --noEmit 2>&1 | grep -E "login-form|signup-form" || echo "No TS errors"
    ```
  </verify>
  <done>
    Both files import Form, FormField, FormControl, FormMessage. mode: 'onBlur' is set. Server error divs have role="alert". No register() calls remain. No TypeScript errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate the 4 remaining auth forms (password reset, profile, change-password)</name>
  <files>
    apps/web/components/auth/reset-password-request-form.tsx
    apps/web/components/auth/reset-password-form.tsx
    apps/web/components/auth/profile-form.tsx
    apps/web/components/auth/change-password-form.tsx
  </files>
  <action>
    Apply the same Shadcn Form migration to the remaining 4 auth forms. Read each file first to understand its current structure before modifying.

    **reset-password-request-form.tsx:**
    - Has one email field
    - Uses server action (requestPasswordReset) instead of signIn — keep that logic unchanged
    - Has successMessage and errorMessage state — add role="alert" to both message divs
    - Apply standard FormField pattern for email field
    - Set mode: 'onBlur'

    **reset-password-form.tsx:**
    - Read file to identify fields (likely password + confirmPassword)
    - Apply FormField for each field
    - Set mode: 'onBlur'
    - Add role="alert" to error div

    **profile-form.tsx:**
    - Read file to identify fields (name, email — email likely read-only, role display)
    - For read-only email field: use FormItem + FormLabel + FormControl wrapping a disabled Input. Still needs FormMessage to prevent aria-describedby bug.
    - Apply FormField for all editable fields
    - Set mode: 'onBlur'

    **change-password-form.tsx:**
    - Read file to identify fields (currentPassword, newPassword, confirmPassword likely)
    - Apply FormField for each password field with type="password"
    - Set mode: 'onBlur'
    - Add role="alert" to error div

    **Pattern for all 4 files:**
    ```tsx
    import { Form, FormField, FormItem, FormLabel, FormControl, FormMessage } from '@/components/ui/form'
    import { Input } from '@/components/ui/input'
    import { Button } from '@/components/ui/button'

    const form = useForm<SchemaType>({
      resolver: zodResolver(schema),
      mode: 'onBlur',
      defaultValues: { ... }
    })

    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
        {errorMessage && <div role="alert" className="...">{errorMessage}</div>}
        {successMessage && <div role="status" className="...">{successMessage}</div>}
        <FormField control={form.control} name="fieldName" render={({ field }) => (
          <FormItem>
            <FormLabel>Field Name</FormLabel>
            <FormControl>
              <Input type="text" {...field} />
            </FormControl>
            <FormMessage />
          </FormItem>
        )} />
        <Button type="submit" disabled={isSubmitting} className="w-full">Submit</Button>
      </form>
    </Form>
    ```

    Note: Use role="status" (not role="alert") for success messages — status is polite (announces when screen reader is idle), alert is assertive (interrupts immediately). Error states use role="alert".
  </action>
  <verify>
    ```bash
    # Check all 4 files import from form.tsx
    for f in reset-password-request-form reset-password-form profile-form change-password-form; do
      grep -c "from '@/components/ui/form'" apps/web/components/auth/${f}.tsx
    done

    # Check mode: 'onBlur' in all 4
    grep -l "mode: 'onBlur'" apps/web/components/auth/reset-password-request-form.tsx apps/web/components/auth/reset-password-form.tsx apps/web/components/auth/profile-form.tsx apps/web/components/auth/change-password-form.tsx

    # Check no register() calls remain
    grep "register(" apps/web/components/auth/reset-password-request-form.tsx apps/web/components/auth/reset-password-form.tsx apps/web/components/auth/profile-form.tsx apps/web/components/auth/change-password-form.tsx || echo "Clean"

    # TypeScript check
    cd apps/web && npx tsc --noEmit 2>&1 | grep -E "reset-password|profile-form|change-password" || echo "No TS errors"
    ```
  </verify>
  <done>
    All 4 files use FormField pattern with mode: 'onBlur'. No register() calls remain. Error divs have role="alert". Success divs have role="status". No TypeScript errors.
  </done>
</task>

</tasks>

<verification>
- [ ] All 6 auth form files import Form, FormField, FormControl, FormMessage from '@/components/ui/form'
- [ ] All 6 forms have mode: 'onBlur' in useForm options
- [ ] No register() calls remain in any auth form file
- [ ] Server error divs have role="alert" in all 6 forms
- [ ] Shadcn Button component used in all 6 forms (not raw button elements)
- [ ] No TypeScript errors: `cd apps/web && npx tsc --noEmit` clean for auth form files
</verification>

<success_criteria>
All 6 auth forms migrated to FormField pattern. Automatic ARIA wiring active (aria-invalid and aria-describedby set by FormControl). Validation fires on blur. Server errors announce to screen readers via role="alert".
</success_criteria>

<output>
After completion, create `.planning/phases/11-form-components-validation/11-02-SUMMARY.md`
</output>
