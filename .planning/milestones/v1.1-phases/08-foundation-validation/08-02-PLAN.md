---
phase: 08-foundation-validation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/08-foundation-validation/WCAG-COLOR-AUDIT.md
  - apps/web/app/globals.css
autonomous: true
requirements: [FOUND-02]

must_haves:
  truths:
    - "All existing color token pairs documented with actual contrast ratios"
    - "WCAG AA compliance status known for every token pair (4.5:1 text, 3:1 UI)"
    - "Any violations identified with specific remediation guidance"
  artifacts:
    - path: ".planning/phases/08-foundation-validation/WCAG-COLOR-AUDIT.md"
      provides: "WCAG AA color audit report"
      contains: "Contrast ratios for all token pairs, violations list, remediation plan"
      min_lines: 100
    - path: "apps/web/app/globals.css"
      provides: "Color token definitions"
      contains: "--color-primary"
  key_links:
    - from: "globals.css color tokens"
      to: "WCAG-COLOR-AUDIT.md validation"
      via: "Manual contrast ratio measurement"
      pattern: "--color-.*: oklch"
---

<objective>
Audit all existing color tokens in globals.css for WCAG AA compliance by measuring actual contrast ratios, identifying violations, and creating remediation plan before any component migration begins.

Purpose: Prevent Phase 07.1-03 failure pattern where systemic design token issues were treated with component-level spot fixes. Foundation must be WCAG AA compliant first.

Output: Complete color audit documenting every token pair's contrast ratio, WCAG compliance status, and remediation plan for violations.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/SUMMARY.md
@.planning/research/PITFALLS.md
@apps/web/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract and catalog all color token pairs</name>
  <files>
    apps/web/app/globals.css
    .planning/phases/08-foundation-validation/WCAG-COLOR-AUDIT.md
  </files>
  <action>
    Read globals.css and identify all color token pairs that will be used together (foreground on background). Create initial audit document structure.

    **1. Identify token pairs from globals.css**:

    Parse the @theme block and .dark class override to extract all color definitions. Map tokens to their usage patterns:

    Light mode pairs to audit:
    - background + foreground (body text)
    - muted + muted-foreground (secondary text)
    - card + card-foreground (card text)
    - primary + primary-foreground (primary buttons)
    - secondary + secondary-foreground (secondary buttons)
    - accent + accent-foreground (accent elements)
    - destructive + destructive-foreground (error buttons)
    - success + success-foreground (success buttons)
    - warning + warning-foreground (warning buttons)
    - background + border (UI components - 3:1 minimum)
    - muted + border (UI components - 3:1 minimum)

    Dark mode pairs to audit (same combinations, different values)

    **2. Convert OKLCH to RGB for contrast measurement**:

    OKLCH values need conversion to RGB for standard contrast tools. Document the conversion:
    - OKLCH format: `oklch(L% C H)` where L=lightness (0-100%), C=chroma, H=hue (0-360)
    - Use WebAIM Contrast Checker (https://webaim.org/resources/contrastchecker/) or similar
    - For each token, extract OKLCH values and convert to hex/RGB

    Example:
    - `--color-primary: oklch(55% 0.2 250)` → convert to RGB → measure against primary-foreground

    **3. Create WCAG-COLOR-AUDIT.md structure**:

    ```markdown
    # WCAG AA Color Audit - Phase 8

    **Audit Date**: 2026-02-16
    **Auditor**: Claude (automated)
    **Standard**: WCAG 2.1 AA
    **Requirements**:
    - Text contrast: 4.5:1 minimum (Level AA)
    - Large text (18pt+): 3:1 minimum
    - UI components: 3:1 minimum

    ## Light Mode Token Pairs

    ### Body Text (4.5:1 required)

    | Foreground Token | Background Token | OKLCH Foreground | OKLCH Background | Calculated Ratio | WCAG AA | Status |
    |------------------|------------------|------------------|------------------|------------------|---------|--------|
    | --color-foreground | --color-background | [values] | [values] | [ratio]:1 | PASS/FAIL | [notes] |
    | --color-muted-foreground | --color-muted | [values] | [values] | [ratio]:1 | PASS/FAIL | [notes] |
    | --color-card-foreground | --color-card | [values] | [values] | [ratio]:1 | PASS/FAIL | [notes] |

    ### Button Text (4.5:1 required)

    | Foreground Token | Background Token | OKLCH Foreground | OKLCH Background | Calculated Ratio | WCAG AA | Status |
    |------------------|------------------|------------------|------------------|------------------|---------|--------|
    | --color-primary-foreground | --color-primary | [values] | [values] | [ratio]:1 | PASS/FAIL | [notes] |
    | --color-secondary-foreground | --color-secondary | [values] | [values] | [ratio]:1 | PASS/FAIL | [notes] |
    [... all button pairs]

    ### UI Components (3:1 required)

    | Foreground Token | Background Token | OKLCH Foreground | OKLCH Background | Calculated Ratio | WCAG AA | Status |
    |------------------|------------------|------------------|------------------|------------------|---------|--------|
    | --color-border | --color-background | [values] | [values] | [ratio]:1 | PASS/FAIL | [notes] |
    [... all UI pairs]

    ## Dark Mode Token Pairs

    [Same structure as light mode]

    ## Summary

    **Light Mode**:
    - Total pairs audited: [N]
    - Passing: [N] ([%]%)
    - Failing: [N] ([%]%)

    **Dark Mode**:
    - Total pairs audited: [N]
    - Passing: [N] ([%]%)
    - Failing: [N] ([%]%)

    ## Violations

    [List each failing pair with current ratio and required ratio]

    ## Remediation Plan

    [For each violation, provide specific OKLCH adjustments needed]
    ```

    Save this structure to WCAG-COLOR-AUDIT.md with placeholder values ready for Task 2 to fill in.
  </action>
  <verify>
    ```bash
    # Verify audit document created
    test -f .planning/phases/08-foundation-validation/WCAG-COLOR-AUDIT.md

    # Verify contains required sections
    grep -q "Light Mode Token Pairs" .planning/phases/08-foundation-validation/WCAG-COLOR-AUDIT.md
    grep -q "Dark Mode Token Pairs" .planning/phases/08-foundation-validation/WCAG-COLOR-AUDIT.md
    grep -q "Remediation Plan" .planning/phases/08-foundation-validation/WCAG-COLOR-AUDIT.md
    ```
  </verify>
  <done>
    WCAG-COLOR-AUDIT.md created with complete table structure for all token pairs in both light and dark modes, ready for contrast ratio measurements.
  </done>
</task>

<task type="auto">
  <name>Task 2: Measure contrast ratios for all token pairs</name>
  <files>
    .planning/phases/08-foundation-validation/WCAG-COLOR-AUDIT.md
    apps/web/app/globals.css
  </files>
  <action>
    Calculate actual contrast ratios for all color token pairs using OKLCH to RGB conversion and contrast measurement.

    **1. Extract OKLCH values from globals.css**:

    Read the current globals.css and extract exact OKLCH values for each token in both light and dark modes.

    **2. Convert OKLCH to RGB for measurement**:

    Use OKLCH → RGB conversion to get values compatible with standard contrast checkers. OKLCH provides better perceptual uniformity but must be converted for WCAG measurement.

    For programmatic conversion, use this approach:
    - OKLCH uses D65 white point, sRGB color space
    - Lightness (L) maps to 0-100% range
    - Chroma (C) is colorfulness intensity
    - Hue (H) is 0-360 degree angle

    **3. Calculate contrast ratios**:

    For each token pair identified in Task 1:
    - Convert both foreground and background OKLCH to RGB
    - Calculate contrast ratio using WCAG formula: (L1 + 0.05) / (L2 + 0.05) where L1 is lighter
    - Document actual ratio (e.g., "6.2:1", "3.8:1", "2.1:1")
    - Mark PASS if meets requirement (4.5:1 for text, 3:1 for UI), FAIL otherwise

    **4. Update WCAG-COLOR-AUDIT.md tables**:

    Fill in all placeholder values with actual measurements:
    - OKLCH values (copy from globals.css)
    - Calculated contrast ratios
    - WCAG AA status (PASS/FAIL based on requirement)
    - Status notes (e.g., "Exceeds requirement", "Borderline", "Fails by X:1")

    **5. Calculate summary statistics**:

    Count passing/failing pairs for both modes and update Summary section with:
    - Total pairs audited
    - Number passing
    - Number failing
    - Percentage compliance

    **6. Document violations**:

    For each FAIL result, add to Violations section:
    - Token pair name
    - Current contrast ratio
    - Required contrast ratio
    - Gap (how far below requirement)
    - Visual severity (text readability vs. UI element visibility)

    Use tools or libraries for accurate conversion and measurement. WebAIM Contrast Checker can verify calculations.
  </action>
  <verify>
    ```bash
    # Verify all tables have real values (not placeholders)
    ! grep -q "\[values\]" .planning/phases/08-foundation-validation/WCAG-COLOR-AUDIT.md
    ! grep -q "\[ratio\]" .planning/phases/08-foundation-validation/WCAG-COLOR-AUDIT.md

    # Verify has summary statistics
    grep -q "Total pairs audited:" .planning/phases/08-foundation-validation/WCAG-COLOR-AUDIT.md
    grep -q "Passing:" .planning/phases/08-foundation-validation/WCAG-COLOR-AUDIT.md

    # Verify contains contrast ratios
    grep -E "[0-9]+\.[0-9]+:1" .planning/phases/08-foundation-validation/WCAG-COLOR-AUDIT.md
    ```
  </verify>
  <done>
    WCAG-COLOR-AUDIT.md contains actual contrast ratios for all token pairs, PASS/FAIL status for each, summary statistics showing compliance percentage, and violations list if any failures exist.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create remediation plan for violations</name>
  <files>
    .planning/phases/08-foundation-validation/WCAG-COLOR-AUDIT.md
  </files>
  <action>
    For any token pairs that FAIL WCAG AA requirements, create specific remediation guidance with exact OKLCH adjustments needed.

    **1. Analyze each violation**:

    For each failing token pair from Task 2:
    - Identify which token needs adjustment (usually foreground for readability)
    - Calculate target OKLCH values to achieve 4.5:1 or 3:1
    - Consider design impact (increasing contrast may affect brand colors)
    - Prioritize by severity (text readability > UI component visibility)

    **2. Remediation strategies**:

    For insufficient text contrast (< 4.5:1):
    - Increase foreground lightness difference from background
    - Example: If `oklch(45% 0 0)` on `oklch(98% 0 0)` = 3.4:1, adjust foreground to `oklch(35% 0 0)` for ~6:1

    For insufficient UI contrast (< 3:1):
    - Adjust border or component colors
    - Example: If border `oklch(89% 0 0)` on background `oklch(98% 0 0)` = 2.1:1, adjust to `oklch(75% 0 0)` for ~3.5:1

    For dark mode violations:
    - Often caused by insufficient foreground brightness
    - Increase lightness value for foreground tokens
    - Decrease lightness value for background tokens

    **3. Document remediation plan in WCAG-COLOR-AUDIT.md**:

    Update Remediation Plan section with:

    ```markdown
    ## Remediation Plan

    [If NO violations:]
    **STATUS**: All token pairs PASS WCAG AA requirements. No remediation needed.

    [If violations exist:]

    ### Priority 1 - Text Contrast Violations (CRITICAL)

    **Token Pair**: [foreground-token] on [background-token]
    **Current Ratio**: [X.X]:1 (WCAG AA requires 4.5:1)
    **Gap**: -[X.X]:1 below requirement

    **Proposed Fix**:
    ```css
    /* Current */
    --color-[token]: oklch([current values]);

    /* Proposed */
    --color-[token]: oklch([adjusted values]); /* Achieves [X.X]:1 ratio */
    ```

    **Impact**: [Describe visual change - e.g., "Slightly darker text, improved readability"]
    **Test**: Apply change, verify with contrast checker, visual review in both modes

    [Repeat for each violation]

    ### Priority 2 - UI Component Violations (HIGH)

    [Same structure as Priority 1]

    ### Validation Steps

    After applying fixes:
    1. Update globals.css with proposed OKLCH values
    2. Hard reload browser (Ctrl+Shift+R)
    3. Re-run contrast measurements
    4. Visual review in both light and dark modes
    5. Re-audit and update this document with new ratios
    ```

    **4. If NO violations** (all pairs pass):

    Document success in Remediation Plan:
    - Confirm all pairs meet WCAG AA
    - Note that foundation is ready for component work
    - Reference this audit as validation checkpoint

    **5. Add implementation guidance**:

    If fixes needed, add section explaining:
    - Which phase should implement fixes (likely Phase 9 Design System Foundation)
    - Testing procedure after fixes applied
    - Regression prevention (re-run audit after any token changes)
  </action>
  <verify>
    ```bash
    # Verify remediation plan exists
    grep -q "## Remediation Plan" .planning/phases/08-foundation-validation/WCAG-COLOR-AUDIT.md

    # Verify has either "No remediation needed" OR proposed fixes
    grep -qE "(No remediation needed|Proposed Fix)" .planning/phases/08-foundation-validation/WCAG-COLOR-AUDIT.md
    ```
  </verify>
  <done>
    WCAG-COLOR-AUDIT.md contains complete remediation plan with specific OKLCH adjustments for any violations, or confirmation that all tokens pass WCAG AA if no violations found.
  </done>
</task>

</tasks>

<verification>
Run all verification commands from tasks. Confirm:
- WCAG-COLOR-AUDIT.md exists with complete contrast ratio measurements
- All token pairs have PASS/FAIL status documented
- Summary statistics calculated
- Remediation plan created (either "no fixes needed" or specific OKLCH adjustments)
</verification>

<success_criteria>
- Every color token pair documented with actual contrast ratio
- WCAG AA compliance status known for all tokens
- Any violations identified with specific remediation guidance
- Foundation ready for Phase 9 component work (tokens validated or fixes planned)
</success_criteria>

<output>
After completion, create `.planning/phases/08-foundation-validation/08-02-SUMMARY.md` using the standard summary template.
</output>
