---
phase: 10-component-migration-portfolio
plan: "02"
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/e2e/portfolio/visual-regression.spec.ts
  - apps/web/e2e/portfolio/accessibility.spec.ts
autonomous: true
requirements:
  - MIG-01

must_haves:
  truths:
    - "@axe-core/playwright is installed as a dev dependency in apps/web"
    - "Visual regression test file captures all 6 portfolio pages in both light and dark modes (12 screenshots total)"
    - "Accessibility test file audits all 6 portfolio pages in both light and dark modes using WCAG 2AA tags"
    - "Dark mode screenshots use class injection (not colorScheme) to activate next-themes class='dark'"
    - "Both test files use storageState with empty cookies to run without authentication"
  artifacts:
    - path: "apps/web/e2e/portfolio/visual-regression.spec.ts"
      provides: "Playwright screenshot tests for 6 portfolio pages x 2 modes"
      min_lines: 40
    - path: "apps/web/e2e/portfolio/accessibility.spec.ts"
      provides: "Axe-core accessibility audit tests for 6 portfolio pages x 2 modes"
      min_lines: 35
  key_links:
    - from: "apps/web/e2e/portfolio/visual-regression.spec.ts"
      to: "@playwright/test"
      via: "toHaveScreenshot() with maxDiffPixelRatio"
      pattern: "toHaveScreenshot"
    - from: "apps/web/e2e/portfolio/accessibility.spec.ts"
      to: "@axe-core/playwright"
      via: "AxeBuilder({ page }).withTags().analyze()"
      pattern: "AxeBuilder"
    - from: "apps/web/e2e/portfolio/visual-regression.spec.ts"
      to: "document.documentElement.classList"
      via: "page.evaluate() to inject dark class"
      pattern: "classList.add.*dark"
---

<objective>
Install @axe-core/playwright and write the visual regression and accessibility test files for all six portfolio pages. This runs in parallel with Plan 01 (no file overlap).

Purpose: Establishes the automated quality gate that will run after migration completes, capturing baselines for visual regression and proving WCAG AA compliance. Writing tests now means they are ready to execute once page migration (Plan 03) is done.
Output: @axe-core/playwright installed, two new Playwright test files covering 6 portfolio pages in both light and dark modes.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-component-migration-portfolio/10-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @axe-core/playwright</name>
  <files>
    apps/web/package.json
  </files>
  <action>
Install @axe-core/playwright as a dev dependency in the web workspace.

Check if a Docker container is already running for the development environment first. Then run:

```bash
npm install --save-dev @axe-core/playwright --workspace=apps/web
```

After installation, verify the package appears in `apps/web/package.json` under `devDependencies`.

Do NOT install globally — must be workspace-scoped to apps/web since that's where the Playwright tests live.
  </action>
  <verify>
```bash
grep "@axe-core/playwright" /home/doctor/fernandomillan/apps/web/package.json
```
  </verify>
  <done>
`@axe-core/playwright` appears in `apps/web/package.json` devDependencies.
  </done>
</task>

<task type="auto">
  <name>Task 2: Write visual regression and accessibility test files</name>
  <files>
    apps/web/e2e/portfolio/visual-regression.spec.ts
    apps/web/e2e/portfolio/accessibility.spec.ts
  </files>
  <action>
**Create `apps/web/e2e/portfolio/visual-regression.spec.ts`:**

```typescript
// Source: https://playwright.dev/docs/test-snapshots
import { test, expect } from '@playwright/test'

// Portfolio is public — no auth needed
test.use({ storageState: { cookies: [], origins: [] } })

const portfolioRoutes = [
  { name: 'homepage', path: '/' },
  { name: 'about', path: '/about' },
  { name: 'projects', path: '/projects' },
  { name: 'teamflow-case-study', path: '/projects/teamflow' },
  { name: 'resume', path: '/resume' },
  { name: 'contact', path: '/contact' },
]

test.describe('Portfolio Visual Regression - Light Mode', () => {
  for (const { name, path } of portfolioRoutes) {
    test(name, async ({ page }) => {
      await page.goto(path)
      await page.waitForLoadState('networkidle')
      await expect(page).toHaveScreenshot(`${name}-light.png`, {
        fullPage: true,
        maxDiffPixelRatio: 0.02,
      })
    })
  }
})

test.describe('Portfolio Visual Regression - Dark Mode', () => {
  for (const { name, path } of portfolioRoutes) {
    test(name, async ({ page }) => {
      await page.goto(path)
      await page.waitForLoadState('networkidle')
      // Inject dark class — app uses next-themes with attribute="class" on <html>
      // DO NOT use colorScheme: 'dark' — that sets prefers-color-scheme media query,
      // NOT the class="dark" attribute that Radix Colors dark mode requires.
      await page.evaluate(() => document.documentElement.classList.add('dark'))
      await page.waitForTimeout(100) // allow CSS transitions
      await expect(page).toHaveScreenshot(`${name}-dark.png`, {
        fullPage: true,
        maxDiffPixelRatio: 0.02,
      })
    })
  }
})
```

**Create `apps/web/e2e/portfolio/accessibility.spec.ts`:**

```typescript
// Source: https://playwright.dev/docs/accessibility-testing
import { test, expect } from '@playwright/test'
import AxeBuilder from '@axe-core/playwright'

// Portfolio is public — no auth needed
test.use({ storageState: { cookies: [], origins: [] } })

const portfolioRoutes = ['/', '/about', '/projects', '/projects/teamflow', '/resume', '/contact']

test.describe('Portfolio Accessibility - WCAG AA', () => {
  for (const path of portfolioRoutes) {
    test(`${path} - light mode`, async ({ page }) => {
      await page.goto(path)
      await page.waitForLoadState('networkidle')
      const results = await new AxeBuilder({ page })
        .withTags(['wcag2a', 'wcag2aa', 'wcag21aa'])
        .analyze()
      expect(results.violations).toEqual([])
    })

    test(`${path} - dark mode`, async ({ page }) => {
      await page.goto(path)
      await page.waitForLoadState('networkidle')
      // Same class injection pattern as visual regression tests
      await page.evaluate(() => document.documentElement.classList.add('dark'))
      await page.waitForTimeout(100)
      const results = await new AxeBuilder({ page })
        .withTags(['wcag2a', 'wcag2aa', 'wcag21aa'])
        .analyze()
      expect(results.violations).toEqual([])
    })
  }
})
```

Both files follow the pattern established in `e2e/portfolio/navigation.spec.ts` (uses `storageState: { cookies: [], origins: [] }` for unauthenticated portfolio access).
  </action>
  <verify>
```bash
# Files exist
ls /home/doctor/fernandomillan/apps/web/e2e/portfolio/

# TypeScript is valid
cd /home/doctor/fernandomillan && npx tsc --noEmit -p apps/web/tsconfig.json 2>&1 | head -20

# Verify dark mode class injection is present (not colorScheme)
grep "classList.add" /home/doctor/fernandomillan/apps/web/e2e/portfolio/visual-regression.spec.ts
grep "classList.add" /home/doctor/fernandomillan/apps/web/e2e/portfolio/accessibility.spec.ts

# Verify axe import in accessibility file
grep "AxeBuilder" /home/doctor/fernandomillan/apps/web/e2e/portfolio/accessibility.spec.ts
```
  </verify>
  <done>
Both `visual-regression.spec.ts` and `accessibility.spec.ts` exist in `apps/web/e2e/portfolio/`. TypeScript compiles without errors. Both files use `classList.add('dark')` for dark mode (not `colorScheme`). `accessibility.spec.ts` imports `AxeBuilder from '@axe-core/playwright'`.
  </done>
</task>

</tasks>

<verification>
1. `@axe-core/playwright` in `apps/web/package.json` devDependencies
2. `apps/web/e2e/portfolio/visual-regression.spec.ts` exists with 12 test cases (6 routes x 2 modes)
3. `apps/web/e2e/portfolio/accessibility.spec.ts` exists with 12 test cases (6 routes x 2 modes)
4. Both files use `page.evaluate(() => document.documentElement.classList.add('dark'))` for dark mode
5. TypeScript compilation passes
</verification>

<success_criteria>
@axe-core/playwright installed. Two test files created covering all 6 portfolio routes in both modes. Tests are syntactically valid TypeScript. Ready to run once page migration (Plan 03) is complete.
</success_criteria>

<output>
After completion, create `.planning/phases/10-component-migration-portfolio/10-02-SUMMARY.md`
</output>
