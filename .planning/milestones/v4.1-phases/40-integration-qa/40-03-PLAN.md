---
phase: 40-integration-qa
plan: 03
type: execute
wave: 3
depends_on: ["40-01", "40-02"]
files_modified: []
autonomous: false
requirements: [QA-01, QA-02, QA-03]

must_haves:
  truths:
    - "Lighthouse CI reports performance score >= 0.90 on /projects/teamflow and /projects/devcollab"
    - "Lighthouse CI reports accessibility score = 1.0 on both case study pages (no violations)"
    - "With prefers-reduced-motion: reduce active, the walkthrough section renders without entrance animations"
    - "All callout overlay circles have aria-label attributes describing the step"
  artifacts:
    - path: "apps/web/.lighthouseci/assertion-results.json"
      provides: "Lighthouse CI run results showing pass/fail per assertion"
      contains: "performance"
  key_links:
    - from: "apps/web/components/portfolio/walkthrough-section.tsx"
      to: "WCAG accessibility"
      via: "aria-label on callout span elements"
      pattern: "aria-label.*Step.*"
---

<objective>
Run Lighthouse CI against the built portfolio and verify all QA gates pass: performance >= 0.90, accessibility = 1.0 (error gate), and reduced-motion compliance.

Purpose: Ensures the new screenshot walkthrough assets do not degrade Lighthouse performance, and that accessibility and reduced-motion requirements (QA-01, QA-02, QA-03) are met before milestone completion.
Output: Lighthouse CI results confirming all gates pass; human visual confirmation of reduced-motion behavior.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/40-integration-qa/40-CONTEXT.md
@.planning/phases/40-integration-qa/40-01-SUMMARY.md
@.planning/phases/40-integration-qa/40-02-SUMMARY.md

# Lighthouse config files
@apps/web/lighthouserc.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify aria-label attributes on callout circles</name>
  <files>apps/web/components/portfolio/walkthrough-section.tsx</files>
  <action>
Audit `apps/web/components/portfolio/walkthrough-section.tsx` to confirm aria-label attributes are present on the overlay callout circles.

From the Phase 39 SUMMARY: "aria-label on overlay circles; aria-hidden=true on legend badges". The component already has `aria-label={`Step ${step.number}: ${step.label}`}` on each callout span.

Verify this pattern exists in the file. If it is present and correct, no changes needed. If it is missing, add `aria-label={`Step ${step.number}: ${step.label}`}` to each callout circle span element (the one with `position: 'absolute'`).

The aria-label format must be: `"Step N: Label Text"` (e.g., "Step 1: Kanban Columns") — per user decision in 40-CONTEXT.md.

After verifying/fixing, grep to confirm:
```bash
grep -n "aria-label" apps/web/components/portfolio/walkthrough-section.tsx
```
  </action>
  <verify>
    <automated>grep -n "aria-label" /home/doctor/fernandomillan/apps/web/components/portfolio/walkthrough-section.tsx</automated>
  </verify>
  <done>Component file contains `aria-label` on overlay callout circle spans. Pattern matches `aria-label={\`Step ${step.number}: ${step.label}\`}`. QA-02 is satisfied at the component level.</done>
</task>

<task type="auto">
  <name>Task 2: Build and run Lighthouse CI locally</name>
  <files></files>
  <action>
Run Lighthouse CI against the local Next.js build to verify QA-01 (performance >= 0.90) and QA-02 (accessibility = 1.0 error gate).

Steps:
1. Build the Next.js app for standalone:
   ```bash
   cd /home/doctor/fernandomillan && npx turbo build --filter=web
   ```

2. Run Lighthouse CI:
   ```bash
   cd /home/doctor/fernandomillan/apps/web && npx lhci autorun --config=lighthouserc.json 2>&1 | tail -60
   ```

3. Check results. Lighthouse CI will output pass/fail per assertion. The relevant assertions:
   - `categories:performance` ["error", minScore: 0.9] — must pass for /projects/teamflow and /projects/devcollab
   - `categories:accessibility` ["error", minScore: 1] — must pass (was previously "warn" — 40-01 upgraded it)

**If performance fails on case study pages (e.g., score 0.85-0.89):**
The most likely cause is screenshot images not using lazy loading. Check that `next/image` is used for all walkthrough screenshots (it is — WalkthroughSection uses `Image` from `next/image`). If score is 0.85+, the performance budget is at risk from raw image size. Do NOT add `priority` prop to walkthrough images (they are below the fold — lazy loading is correct). If score is below 0.85, investigate and document.

**If accessibility fails:**
Check which specific rule failed using: `cat apps/web/.lighthouseci/assertion-results.json | grep -A5 "accessibility"`. Fix the specific violation. Common issues: missing alt text, insufficient color contrast, missing aria attributes.

Document actual Lighthouse scores in the task completion notes.
  </action>
  <verify>
    <automated>cd /home/doctor/fernandomillan/apps/web && cat .lighthouseci/assertion-results.json 2>/dev/null | python3 -c "import sys,json; d=json.load(sys.stdin); results=[r for r in d if 'teamflow' in r.get('url','') or 'devcollab' in r.get('url','')]; [print(r.get('url'), r.get('auditId'), r.get('level'), r.get('actual')) for r in results[:20]]" 2>/dev/null || echo "Run lhci first"</automated>
  </verify>
  <done>Lighthouse CI runs complete. Performance >= 0.90 and accessibility = 1.0 on /projects/teamflow and /projects/devcollab. No "error" level assertion failures remain.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Human visual + reduced-motion verification</name>
  <action>
Start the dev server and visually verify both pages render correctly. Check reduced-motion compliance in browser DevTools.
  </action>
  <verify>
    <automated>MISSING — reduced-motion is a visual browser check, no automated equivalent</automated>
  </verify>
  <done>User confirms: both pages show App Walkthrough with 5 screenshots + callout overlays + legend. Reduced-motion: no entrance animation fires. Console shows no errors.</done>
  <what-built>
    - WalkthroughSection integrated into both case study pages with real screenshot data and callout overlays
    - Lighthouse CI gates: performance >= 0.90, accessibility = 1.0 (error gate)
    - aria-label on all callout circles
  </what-built>
  <how-to-verify>
    **Visual check (start dev server: `cd /home/doctor/fernandomillan/apps/web && npx next dev`):**

    1. Visit http://localhost:3000/projects/teamflow
       - Scroll down past the main content sections
       - Confirm "App Walkthrough" heading appears in matrix-green monospace font
       - Confirm 5 screenshots render with numbered green callout circles overlaid
       - Confirm legend below each screenshot shows numbered badges + labels + explanations

    2. Visit http://localhost:3000/projects/devcollab
       - Same checks: "App Walkthrough" heading, 5 screenshots, callouts, legend

    **Reduced-motion check (QA-03):**

    3. Open DevTools > Rendering tab > check "Emulate CSS media feature prefers-reduced-motion: reduce"
       - Reload http://localhost:3000/projects/teamflow
       - Confirm the walkthrough section appears immediately without any entrance animation (no fade-in, no slide-in)
       - Reload http://localhost:3000/projects/devcollab — same check
       - No animation-related errors in the browser console

    **Accessibility spot-check:**

    4. Hover over any callout circle — confirm browser tooltip shows "Step N: Label" text from aria-label
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
- Lighthouse CI passes: performance >= 0.90 and accessibility = 1.0 on both case study pages
- All callout overlay spans have `aria-label="Step N: Label"` attributes
- Reduced-motion: walkthrough renders without entrance animation when prefers-reduced-motion is reduce
- Human verified: both pages show WalkthroughSection with correct data visually
</verification>

<success_criteria>
- QA-01: Lighthouse performance >= 0.90 on /projects/teamflow and /projects/devcollab (confirmed by lhci run)
- QA-02: Lighthouse accessibility = 1.0 with "error" gate (no violations)
- QA-03: Reduced-motion confirmed by human inspection — no animation when prefers-reduced-motion: reduce
- INTG-01 + INTG-02: Human confirmed both pages show walkthrough sections with correct content
- v4.1 milestone: All 12 requirements complete (SHOT-01 through QA-03)
</success_criteria>

<output>
After completion, create `.planning/phases/40-integration-qa/40-03-SUMMARY.md`
</output>
