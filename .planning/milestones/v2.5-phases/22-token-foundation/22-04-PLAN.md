---
phase: 22-token-foundation
plan: "04"
type: execute
wave: 1
depends_on: ["22-01"]
files_modified:
  - apps/web/app/globals.css
  - .planning/REQUIREMENTS.md
autonomous: true
gap_closure: true
requirements:
  - THEME-01

must_haves:
  truths:
    - "Portfolio routes visually render with a dark background when .matrix-theme CSS rules are active"
    - "Dashboard routes (TeamFlow/DevCollab) are visually unaffected by .matrix-theme CSS rules"
    - "REQUIREMENTS.md THEME-01 traceability accurately reflects Phase 22 delivered both infrastructure (22-01) and visual activation (22-04)"
  artifacts:
    - path: "apps/web/app/globals.css"
      provides: ".matrix-theme CSS selector block with dark-first background and foreground"
      contains: ".matrix-theme"
    - path: ".planning/REQUIREMENTS.md"
      provides: "Updated THEME-01 traceability entry"
      contains: "22-01 + 22-04"
  key_links:
    - from: "apps/web/app/(portfolio)/layout.tsx"
      to: "apps/web/app/globals.css"
      via: ".matrix-theme class on wrapper div — CSS rules now attached"
      pattern: "\\.matrix-theme\\s*\\{"
    - from: "apps/web/app/globals.css"
      to: "apps/web/app/(portfolio)/layout.tsx"
      via: ".matrix-theme sets background-color + color — cascades to all portfolio children"
      pattern: "\\.matrix-theme"
---

<objective>
Activate dark-first visual styling for the portfolio by attaching CSS rules to the .matrix-theme selector that already exists in apps/web/app/(portfolio)/layout.tsx.

Purpose: THEME-01 requires the portfolio to visually render dark-first. The class hook was planted in 22-01 but had zero CSS rules — the portfolio renders via OS preference, not dark-first. This plan closes the gap by wiring CSS to the existing class hook.

Output: A .matrix-theme {} block in globals.css that sets near-black background and light foreground, scoped entirely to portfolio routes via the layout wrapper. Dashboard routes and the Radix Colors cascade are unaffected. REQUIREMENTS.md traceability updated to reflect the split delivery.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/app/globals.css
@apps/web/app/(portfolio)/layout.tsx
@.planning/REQUIREMENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add .matrix-theme CSS rules to globals.css for dark-first portfolio styling</name>
  <files>apps/web/app/globals.css</files>
  <action>
Open apps/web/app/globals.css and add a .matrix-theme selector block after the existing .dark {} block (after line 97, before the @theme inline block). Insert the following CSS — do not modify any existing rules:

```css
/* THEME-01: Dark-first theming for portfolio routes */
/* .matrix-theme is on the wrapper div in apps/web/app/(portfolio)/layout.tsx */
/* Scoped to portfolio routes only — dashboard routes (TeamFlow/DevCollab) are unaffected */
/* Does not touch <html>, .dark, or the Radix Colors cascade */
.matrix-theme {
  background-color: #0a0a0a;
  color: #e8e8e8;
}
```

Constraints:
- Do NOT modify :root, .dark, @theme inline, or any @import lines
- Do NOT use Tailwind utility classes inside this rule — raw CSS only
- Do NOT use var(--slate-*) — Radix dark vars are scoped to .dark, not .matrix-theme
- Do NOT use var(--background) or var(--foreground) — those resolve to light values unless .dark is on html
- Use hex literals: background #0a0a0a (near-black), color #e8e8e8 (near-white, readable at WCAG AA)
- Existing --matrix-green tokens (on :root) remain available inside .matrix-theme children via CSS cascade — no changes needed there
- The rule intentionally does NOT change --background/--foreground tokens — those feed Tailwind utilities and Radix components across the whole app. The raw background-color/color override on .matrix-theme is sufficient to establish the dark-first visual baseline for the layout wrapper and its children
  </action>
  <verify>
Run: grep -n "\.matrix-theme" apps/web/app/globals.css

Expected output shows at least two lines — one for the selector and one containing background-color. Example:
  99: .matrix-theme {
  100:   background-color: #0a0a0a;
  101:   color: #e8e8e8;

Also verify no existing rules were disturbed:
grep -n "\.dark\|:root\|@theme" apps/web/app/globals.css

Should still show .dark at line 95 and @theme inline block intact.
  </verify>
  <done>
The file apps/web/app/globals.css contains a .matrix-theme {} block with background-color: #0a0a0a and color: #e8e8e8. All pre-existing rules (:root, .dark, @theme inline, @keyframes, .cursor-blink, .card-glow-hover, @media prefers-reduced-motion) are unchanged.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update REQUIREMENTS.md THEME-01 traceability to reflect 22-01 + 22-04 delivery</name>
  <files>.planning/REQUIREMENTS.md</files>
  <action>
Open .planning/REQUIREMENTS.md and make two targeted edits:

1. In the Traceability table (around line 70), find the THEME-01 row:
   | THEME-01 | Phase 22 | Complete (22-01) |
   Change it to:
   | THEME-01 | Phase 22 | Complete (22-01 + 22-04) |

2. At the bottom of the file, update the "Last updated" timestamp line to:
   *Last updated: 2026-02-18 — THEME-01 visual activation complete via 22-04 (infrastructure: 22-01)*

Do NOT change any other rows, requirements, or content in the file.
  </action>
  <verify>
Run: grep "THEME-01" .planning/REQUIREMENTS.md

Expected output includes:
  - [x] **THEME-01**: Portfolio site renders in dark-first mode...
  | THEME-01 | Phase 22 | Complete (22-01 + 22-04) |

Both lines should contain THEME-01. The traceability entry must contain "22-04".
  </verify>
  <done>
The REQUIREMENTS.md traceability table row for THEME-01 reads "Complete (22-01 + 22-04)". The last-updated line reflects the 22-04 completion. All other content is unchanged.
  </done>
</task>

</tasks>

<verification>
After both tasks complete, run the following checks:

1. CSS rule present and correctly formed:
   grep -A 3 "\.matrix-theme {" apps/web/app/globals.css
   Expected: background-color: #0a0a0a and color: #e8e8e8 in the block.

2. No .matrix-theme selector existed before (confirm it's new, not a duplicate):
   grep -c "\.matrix-theme" apps/web/app/globals.css
   Expected: 1 (exactly one block; the (portfolio)/layout.tsx className is not in globals.css)

3. Radix cascade untouched:
   grep -n "@import.*radix" apps/web/app/globals.css
   Expected: All 11 @import "@radix-ui/colors/..." lines still present unchanged.

4. REQUIREMENTS.md traceability updated:
   grep "THEME-01" .planning/REQUIREMENTS.md | grep "22-04"
   Expected: One matching line showing "Complete (22-01 + 22-04)".

5. Dashboard routes unaffected (confirm .matrix-theme is NOT in dashboard layouts):
   grep -r "matrix-theme" apps/web/app/\(dashboard\)/ 2>/dev/null || echo "CLEAN — dashboard has no matrix-theme"
   Expected: "CLEAN — dashboard has no matrix-theme"
</verification>

<success_criteria>
- apps/web/app/globals.css contains a .matrix-theme {} CSS block with background-color: #0a0a0a and color: #e8e8e8
- No pre-existing CSS rules in globals.css were modified (verified via grep on :root, .dark, @theme, @keyframes, .cursor-blink, .card-glow-hover)
- .planning/REQUIREMENTS.md THEME-01 traceability row reads "Complete (22-01 + 22-04)"
- Dashboard route directories contain no reference to .matrix-theme
- THEME-01 gap from 22-VERIFICATION.md is closed: portfolio wrapper now has active dark-first CSS rules, not just a dormant class hook
</success_criteria>

<output>
After completion, create .planning/phases/22-token-foundation/22-04-SUMMARY.md
</output>
