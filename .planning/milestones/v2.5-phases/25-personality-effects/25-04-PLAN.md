---
phase: 25-personality-effects
plan: 04
type: execute
wave: 2
depends_on:
  - 25-01
  - 25-02
  - 25-03
files_modified: []
autonomous: false
requirements:
  - FX-01
  - FX-03
  - FX-04

must_haves:
  truths:
    - "All five Phase 25 success criteria are confirmed true by a human observer using a desktop browser with a mouse"
    - "Lighthouse CI reports performance score >= 0.90 on all five portfolio URLs after Phase 25 effects are in place"
    - "No visual regressions on reduced-motion — effects are fully absent when prefers-reduced-motion is active"
  artifacts:
    - path: "apps/web/hooks/use-text-scramble.ts"
      provides: "Scramble hook (from plan 25-01)"
    - path: "apps/web/components/portfolio/scramble-hero.tsx"
      provides: "ScrambleHero component (from plan 25-01)"
    - path: "apps/web/components/portfolio/evervault-card.tsx"
      provides: "EvervaultCard component (from plan 25-02)"
    - path: "apps/web/components/portfolio/dot-grid-spotlight.tsx"
      provides: "DotGridSpotlight component (from plan 25-03)"
  key_links:
    - from: "lhci autorun"
      to: "≥ 0.90 performance score"
      via: "lighthouserc.json thresholds on all 5 portfolio URLs"
      pattern: "performance.*0\\.9"
---

<objective>
Verify all three Phase 25 personality effects work correctly in a running dev server and pass Lighthouse CI performance gate.

Purpose: Phase 25 cannot be considered complete until a human confirms the visual effects work as specified AND Lighthouse CI confirms performance is unaffected. This plan is the quality gate.
Output: Human-verified effects + passing `lhci autorun` run.
</objective>

<execution_context>
@/home/doctor/.claude/get-shit-done/workflows/execute-plan.md
@/home/doctor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/lighthouserc.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Production build + Lighthouse CI gate</name>
  <files></files>
  <action>
Run a production build and Lighthouse CI autorun to confirm Phase 25 effects do not degrade performance below the 0.90 threshold.

```bash
# Step 1: Production build
cd /home/doctor/fernandomillan/apps/web && npx next build 2>&1 | tail -20

# Step 2: Start production server in background
cd /home/doctor/fernandomillan/apps/web && npx next start -p 3000 &
NEXT_PID=$!
sleep 5

# Step 3: Run Lighthouse CI
cd /home/doctor/fernandomillan/apps/web && npx lhci autorun 2>&1 | tail -30

# Step 4: Stop production server
kill $NEXT_PID 2>/dev/null || true
```

If `lhci autorun` fails due to Chromium path (WSL2 known issue from Phase 23-04), use the Playwright Chromium path:

```bash
LHCI_CHROME_PATH="/home/doctor/.cache/ms-playwright/chromium-1208/chrome-linux64/chrome" \
  npx lhci autorun --chrome-flags="--no-sandbox --disable-dev-shm-usage" 2>&1 | tail -30
```

The Lighthouse CI run is automated — do not skip it. If performance score drops below 0.90 on any URL, investigate the cause before proceeding to the checkpoint. The noise decryption effect (FX-03) does not execute during automated Lighthouse runs (no mouse input), so it should not affect scores. The scramble hook (FX-01) fires once on mount — verify it does not cause layout shift (CLS) by checking the Lighthouse report for any CLS > 0.1.
  </action>
  <verify>
```bash
# All 5 URLs must show performance >= 0.90 in the lhci autorun output
# Check the .lighthouseci/ directory for the results JSON
ls /home/doctor/fernandomillan/apps/web/.lighthouseci/*.json 2>/dev/null | head -5
```
  </verify>
  <done>
`lhci autorun` exits with code 0 (all assertions pass). All five portfolio URLs (`/`, `/projects`, `/projects/teamflow`, `/projects/devcollab`, `/contact`) report Lighthouse performance score >= 0.90 in the run output. No build errors.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verification of all three personality effects (SC-1 through SC-5)</name>
  <action>Start the dev server and visually verify all five Phase 25 success criteria as specified in how-to-verify below.</action>
  <verify>All 5 success criteria confirmed by human observation; Task 1 lhci autorun already passed.</verify>
  <done>Human types "approved" after confirming SC-1 (scramble fires once), SC-2 (card noise on hover), SC-3 (spotlight tracks cursor), SC-4 (no spotlight on touch), SC-5 (Lighthouse ≥ 0.90 from Task 1).</done>
  <what-built>
Three personality effects from Phase 25:
- FX-01: Hero name "Fernando Millan" scrambles from ASCII noise to readable text on page load (fires once, never loops)
- FX-03: Hovering over project cards on the home page reveals a radial noise decryption effect (Evervault-style matrix characters under a gradient spotlight)
- FX-04: A green spotlight follows the mouse cursor across all portfolio pages, illuminating a subtle dot-grid background
  </what-built>
  <how-to-verify>
Start the dev server if not already running:
```bash
cd /home/doctor/fernandomillan/apps/web && npx next dev -p 3000
```

Then verify each success criterion:

**SC-1 (FX-01 — hero scramble fires once):**
1. Open http://localhost:3000 in a desktop browser
2. Watch the hero h1 — "Fernando Millan" should scramble from random ASCII characters to readable text
3. The scramble must resolve completely and STOP — it must NOT loop
4. Refresh the page — the scramble fires again once, then stops
5. Navigate to /about and back to / — the scramble fires again (component remounted)
Expected: Scramble fires exactly once per page load, resolves cleanly, never repeats or loops

**SC-2 (FX-03 — card noise decryption on hover):**
1. On http://localhost:3000, hover the mouse over the "TeamFlow" featured project card
2. Random matrix characters should appear inside the card, revealed by a radial gradient spotlight following your cursor
3. Move the mouse within the card — the noise updates and the spotlight follows
4. Move the mouse away from the card — noise disappears completely, no looping
Expected: Noise appears on hover, disappears on leave, spotlight tracks cursor inside card boundary

**SC-3 (FX-04 — spotlight tracks cursor on portfolio pages):**
1. On any portfolio page (http://localhost:3000, /about, /projects, /contact)
2. Move the mouse around the page
3. A subtle green spotlight should illuminate the dot-grid background beneath the cursor
4. The tracking should be smooth with no visible lag
Expected: Green spotlight follows cursor in real time; dot-grid pattern visible in spotlight area

**SC-4 (FX-04 — touch device: spotlight completely absent):**
1. In Chrome DevTools, toggle device toolbar to a mobile device (e.g., iPhone 15 Pro)
2. Navigate to any portfolio page
3. The dot-grid background and spotlight should be completely absent — no visual artifact
Expected: Zero evidence of the spotlight effect on simulated touch device

**SC-5 (Lighthouse ≥ 0.90 — verified by automated Task 1):**
Confirm Task 1 passed — check the lhci autorun output for all 5 URLs reporting ≥ 0.90 performance score.

**Bonus check — reduced motion:**
1. In OS settings or Chrome DevTools (Rendering tab > Emulate CSS media feature: prefers-reduced-motion: reduce)
2. Navigate to http://localhost:3000
3. The hero "Fernando Millan" should render as plain text immediately (no scramble)
4. The dot-grid spotlight should be completely absent
Expected: All three effects disabled cleanly under reduced motion
  </how-to-verify>
  <resume-signal>
Type "approved" if all 5 success criteria pass, or describe which criteria failed and what you observed.
  </resume-signal>
</task>

</tasks>

<verification>
Success criteria met when:
- `lhci autorun` exits 0, all 5 URLs ≥ 0.90 performance score
- Human approval received for all 5 SC
</verification>

<success_criteria>
- Lighthouse CI performance gate passes (≥ 0.90 on all five portfolio URLs)
- All five Phase 25 success criteria confirmed by human visual verification:
  1. Hero name scramble fires once on load, never loops
  2. Project card Evervault noise effect appears on hover, disappears on leave
  3. Green spotlight tracks cursor in real time on portfolio pages
  4. Spotlight completely absent on touch devices (mobile emulation confirms)
  5. Lighthouse CI ≥ 0.90 (confirmed by Task 1 automated run)
</success_criteria>

<output>
After completion, create `.planning/phases/25-personality-effects/25-04-SUMMARY.md` with:
- Lighthouse CI results (scores per URL)
- Which success criteria passed on first attempt
- Any issues found during human verification and how they were resolved
- Phase 25 completion status
</output>
